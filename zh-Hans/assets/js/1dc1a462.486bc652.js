"use strict";(self.webpackChunkmy_wiki=self.webpackChunkmy_wiki||[]).push([[7216],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>k});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var u=a.createContext({}),c=function(e){var n=a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(u.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},s=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,u=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),s=c(t),k=l,h=s["".concat(u,".").concat(k)]||s[k]||d[k]||r;return t?a.createElement(h,i(i({ref:n},p),{},{components:t})):a.createElement(h,i({ref:n},p))}));function k(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,i=new Array(r);i[0]=s;var o={};for(var u in n)hasOwnProperty.call(n,u)&&(o[u]=n[u]);o.originalType=e,o.mdxType="string"==typeof e?e:l,i[1]=o;for(var c=2;c<r;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}s.displayName="MDXCreateElement"},3422:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=t(7462),l=(t(7294),t(3905));const r={},i=void 0,o={unversionedId:"Language/java/\u591a\u7ebf\u7a0b\u8be6\u89e3",id:"Language/java/\u591a\u7ebf\u7a0b\u8be6\u89e3",title:"\u591a\u7ebf\u7a0b\u8be6\u89e3",description:"[TOC]",source:"@site/docs/Language/java/\u591a\u7ebf\u7a0b\u8be6\u89e3.md",sourceDirName:"Language/java",slug:"/Language/java/\u591a\u7ebf\u7a0b\u8be6\u89e3",permalink:"/zh-Hans/docs/Language/java/\u591a\u7ebf\u7a0b\u8be6\u89e3",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Language/java/\u591a\u7ebf\u7a0b\u8be6\u89e3.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Java\u9501\u673a\u5236",permalink:"/zh-Hans/docs/Language/java/Java\u9501\u673a\u5236"},next:{title:"Python",permalink:"/zh-Hans/docs/category/python"}},u={},c=[{value:"\u7ebf\u7a0b\u751f\u547d\u5468\u671f",id:"\u7ebf\u7a0b\u751f\u547d\u5468\u671f",level:2},{value:"\u7ec8\u6b62\u7ebf\u7a0b\u7684\u56db\u79cd\u65b9\u5f0f",id:"\u7ec8\u6b62\u7ebf\u7a0b\u7684\u56db\u79cd\u65b9\u5f0f",level:2},{value:"\u6b63\u5e38\u8fd0\u884c\u7ed3\u675f",id:"\u6b63\u5e38\u8fd0\u884c\u7ed3\u675f",level:3},{value:"\u4f7f\u7528\u9000\u51fa\u6807\u5fd7\u9000\u51fa\u7ebf\u7a0b",id:"\u4f7f\u7528\u9000\u51fa\u6807\u5fd7\u9000\u51fa\u7ebf\u7a0b",level:3},{value:"Interrupt() \u65b9\u6cd5\u7ed3\u675f\u7ebf\u7a0b",id:"interrupt-\u65b9\u6cd5\u7ed3\u675f\u7ebf\u7a0b",level:3},{value:"stop \u65b9\u6cd5\u7ec8\u6b62\u7ebf\u7a0b\uff08\u7ebf\u7a0b\u4e0d\u5b89\u5168\uff09",id:"stop-\u65b9\u6cd5\u7ec8\u6b62\u7ebf\u7a0b\u7ebf\u7a0b\u4e0d\u5b89\u5168",level:3},{value:"wait()\u548cnotify()",id:"wait\u548cnotify",level:2},{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:3},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:3},{value:"sleep()\u548cwait()",id:"sleep\u548cwait",level:2},{value:"start()\u548crun()",id:"start\u548crun",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u4fe1\u53f7",id:"\u4fe1\u53f7",level:2},{value:"\u7ba1\u9053",id:"\u7ba1\u9053",level:2},{value:"\u6d88\u606f\u961f\u5217",id:"\u6d88\u606f\u961f\u5217",level:2},{value:"\u5171\u4eab\u5185\u5b58",id:"\u5171\u4eab\u5185\u5b58",level:2},{value:"\u4fe1\u53f7\u91cf",id:"\u4fe1\u53f7\u91cf",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u539f\u7406",id:"\u539f\u7406",level:2},{value:"\u7ebf\u7a0b\u6c60\u7684\u4f18\u70b9",id:"\u7ebf\u7a0b\u6c60\u7684\u4f18\u70b9",level:3},{value:"\u7ebf\u7a0b\u6c60\u7684\u521b\u5efa",id:"\u7ebf\u7a0b\u6c60\u7684\u521b\u5efa",level:3},{value:"\u4efb\u52a1\u963b\u585e\u961f\u5217BlockingQueue",id:"\u4efb\u52a1\u963b\u585e\u961f\u5217blockingqueue",level:2},{value:"\u5e38\u7528\u7684\u963b\u585e\u961f\u5217\u5177\u4f53\u7c7b",id:"\u5e38\u7528\u7684\u963b\u585e\u961f\u5217\u5177\u4f53\u7c7b",level:3},{value:"\u65e0\u754c\u961f\u5217",id:"\u65e0\u754c\u961f\u5217",level:3},{value:"\u6709\u754c\u961f\u5217",id:"\u6709\u754c\u961f\u5217",level:3},{value:"\u540c\u6b65\u79fb\u4ea4",id:"\u540c\u6b65\u79fb\u4ea4",level:3},{value:"BlockingQueue\u7684\u6dfb\u52a0\u548c\u5220\u9664\u65b9\u6cd5",id:"blockingqueue\u7684\u6dfb\u52a0\u548c\u5220\u9664\u65b9\u6cd5",level:3},{value:"ArrayBlockingQueue\u5e95\u5c42\u5b9e\u73b0",id:"arrayblockingqueue\u5e95\u5c42\u5b9e\u73b0",level:3},{value:"ArrayBlockingQueue\u5e26\u6709\u7684\u5c5e\u6027",id:"arrayblockingqueue\u5e26\u6709\u7684\u5c5e\u6027",level:4},{value:"ArrayBlockingQueue\u6570\u636e\u7684\u6dfb\u52a0(add,offer,put)",id:"arrayblockingqueue\u6570\u636e\u7684\u6dfb\u52a0addofferput",level:4},{value:"ArrayBlockingQueue\u6570\u636e\u7684\u5220\u9664(poll\u3001take\u3001remove)",id:"arrayblockingqueue\u6570\u636e\u7684\u5220\u9664polltakeremove",level:4},{value:"LinkedBlockingQueue\u5e95\u5c42\u5b9e\u73b0",id:"linkedblockingqueue\u5e95\u5c42\u5b9e\u73b0",level:3},{value:"LinkedBlockingQueue\u5e26\u6709\u7684\u5c5e\u6027",id:"linkedblockingqueue\u5e26\u6709\u7684\u5c5e\u6027",level:4},{value:"LinkedBlockingQueue\u6570\u636e\u7684\u6dfb\u52a0\uff08add\u3001offer\u3001put\uff09",id:"linkedblockingqueue\u6570\u636e\u7684\u6dfb\u52a0addofferput",level:4},{value:"LinkedBlockingQueue\u6570\u636e\u7684\u5220\u9664\uff08poll\u3001take\u3001remove\uff09",id:"linkedblockingqueue\u6570\u636e\u7684\u5220\u9664polltakeremove",level:4},{value:"\u4efb\u52a1\u62d2\u7edd\u7c7b\u578b",id:"\u4efb\u52a1\u62d2\u7edd\u7c7b\u578b",level:2},{value:"Executor\u6846\u67b6\u7684\u4e24\u7ea7\u8c03\u5ea6\u6a21\u578b",id:"executor\u6846\u67b6\u7684\u4e24\u7ea7\u8c03\u5ea6\u6a21\u578b",level:2},{value:"Executors\u5de5\u5382",id:"executors\u5de5\u5382",level:2},{value:"newSingleThreadExecutor\uff1a\u5355\u7ebf\u7a0b\u7ebf\u7a0b\u6c60",id:"newsinglethreadexecutor\u5355\u7ebf\u7a0b\u7ebf\u7a0b\u6c60",level:3},{value:"newScheduledThreadPool\uff1a\u5b9a\u957f\u7ebf\u7a0b\u6c60\uff0c\u652f\u6301\u5b9a\u65f6\u53ca\u5468\u671f\u6027\u4efb\u52a1\u6267\u884c",id:"newscheduledthreadpool\u5b9a\u957f\u7ebf\u7a0b\u6c60\u652f\u6301\u5b9a\u65f6\u53ca\u5468\u671f\u6027\u4efb\u52a1\u6267\u884c",level:3},{value:"newFixedThreadExecutor\uff1a\u56fa\u5b9a\u5927\u5c0f\u7ebf\u7a0b\u6c60",id:"newfixedthreadexecutor\u56fa\u5b9a\u5927\u5c0f\u7ebf\u7a0b\u6c60",level:3},{value:"newCachedThreadPool:\u65e0\u754c\u7ebf\u7a0b\u6c60",id:"newcachedthreadpool\u65e0\u754c\u7ebf\u7a0b\u6c60",level:3},{value:"newWorkStealingPool:\u62e5\u6709\u591a\u4e2a\u4efb\u52a1\u961f\u5217\uff08\u4ee5\u4fbf\u51cf\u5c11\u8fde\u63a5\u6570\uff09\u7684\u7ebf\u7a0b\u6c60",id:"newworkstealingpool\u62e5\u6709\u591a\u4e2a\u4efb\u52a1\u961f\u5217\u4ee5\u4fbf\u51cf\u5c11\u8fde\u63a5\u6570\u7684\u7ebf\u7a0b\u6c60",level:3},{value:"\u81ea\u5e26\u7ebf\u7a0b\u6c60\u7684\u5751",id:"\u81ea\u5e26\u7ebf\u7a0b\u6c60\u7684\u5751",level:2},{value:"\u4e09\u8005\u4e4b\u95f4\u7684\u5173\u7cfb",id:"\u4e09\u8005\u4e4b\u95f4\u7684\u5173\u7cfb",level:2},{value:"Callable\u4e0eRunnable\u7684\u533a\u522b",id:"callable\u4e0erunnable\u7684\u533a\u522b",level:2},{value:"Future",id:"future",level:2},{value:"FutureTask\u5b9e\u73b0\u4e86Future\u63a5\u53e3",id:"futuretask\u5b9e\u73b0\u4e86future\u63a5\u53e3",level:2},{value:"Callable\u4e0eFutureTask",id:"callable\u4e0efuturetask",level:2},{value:"Callable\u4e0eFuture",id:"callable\u4e0efuture",level:2},{value:"\u4e92\u65a5\u540c\u6b65\u9501\uff08\u60b2\u89c2\u9501\uff09",id:"\u4e92\u65a5\u540c\u6b65\u9501\u60b2\u89c2\u9501",level:2},{value:"\u975e\u963b\u585e\u540c\u6b65\u9501",id:"\u975e\u963b\u585e\u540c\u6b65\u9501",level:2},{value:"\u65e0\u540c\u6b65\u65b9\u6848",id:"\u65e0\u540c\u6b65\u65b9\u6848",level:2},{value:"Volatile\u539f\u7406",id:"volatile\u539f\u7406",level:2},{value:"Volatile\u9002\u7528\u573a\u666f",id:"volatile\u9002\u7528\u573a\u666f",level:2},{value:"\u72b6\u6001\u6807\u5fd7",id:"\u72b6\u6001\u6807\u5fd7",level:3},{value:"\u4e00\u6b21\u6027\u5b89\u5168\u53d1\u5e03\uff08one-time safe publication\uff09",id:"\u4e00\u6b21\u6027\u5b89\u5168\u53d1\u5e03one-time-safe-publication",level:3},{value:"\u72ec\u7acb\u89c2\u5bdf\uff08independent observation\uff09",id:"\u72ec\u7acb\u89c2\u5bdfindependent-observation",level:3},{value:"\u201cvolatile bean\u201d \u6a21\u5f0f",id:"volatile-bean-\u6a21\u5f0f",level:3},{value:"\u5f00\u9500\u8f83\u4f4e\u7684\u201c\u8bfb\uff0d\u5199\u9501\u201d\u7b56\u7565",id:"\u5f00\u9500\u8f83\u4f4e\u7684\u8bfb\u5199\u9501\u7b56\u7565",level:3},{value:"ThreadLocal\u539f\u7406",id:"threadlocal\u539f\u7406",level:2},{value:"ThreadLocal\u51fa\u73b0OOM",id:"threadlocal\u51fa\u73b0oom",level:2},{value:"ThreadLocal\u5168\u90e8\u65b9\u6cd5\u548c\u5185\u90e8\u7c7b",id:"threadlocal\u5168\u90e8\u65b9\u6cd5\u548c\u5185\u90e8\u7c7b",level:2},{value:"ThreadLocal\u6e90\u7801\u5206\u6790",id:"threadlocal\u6e90\u7801\u5206\u6790",level:2},{value:"\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u5728Thread\u4e2d\u7684\u4f4d\u7f6e",id:"\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u5728thread\u4e2d\u7684\u4f4d\u7f6e",level:3},{value:"Thread\u4e0eThreadLocalMap\u7684\u5173\u7cfb",id:"thread\u4e0ethreadlocalmap\u7684\u5173\u7cfb",level:3},{value:"ThreadLocalMap\u4e0eWeakReference",id:"threadlocalmap\u4e0eweakreference",level:3},{value:"ThreadLocalMap\u7684\u6784\u9020\u51fd\u6570",id:"threadlocalmap\u7684\u6784\u9020\u51fd\u6570",level:3},{value:"ThreadLocal\u4e2d\u7684set\u65b9\u6cd5",id:"threadlocal\u4e2d\u7684set\u65b9\u6cd5",level:2},{value:"\u4e3a\u4ec0\u4e48\u8981\u7528ThreadLocalMap\u6765\u4fdd\u5b58\u7ebf\u7a0b\u5c40\u90e8\u5bf9\u8c61",id:"\u4e3a\u4ec0\u4e48\u8981\u7528threadlocalmap\u6765\u4fdd\u5b58\u7ebf\u7a0b\u5c40\u90e8\u5bf9\u8c61",level:3},{value:"ThreadLocal\u7684get\u65b9\u6cd5",id:"threadlocal\u7684get\u65b9\u6cd5",level:2},{value:"ThreadLocal\u7684\u5185\u5b58\u56de\u6536",id:"threadlocal\u7684\u5185\u5b58\u56de\u6536",level:2},{value:"\u5728ThreadLocal\u5c42\u9762\u7684\u5185\u5b58\u56de\u6536",id:"\u5728threadlocal\u5c42\u9762\u7684\u5185\u5b58\u56de\u6536",level:3},{value:"ThreadLocalMap \u5c42\u9762\u7684\u5185\u5b58\u56de\u6536",id:"threadlocalmap-\u5c42\u9762\u7684\u5185\u5b58\u56de\u6536",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3-1",level:2},{value:"Synchronized\u4e0eVolatile\u7684\u533a\u522b",id:"synchronized\u4e0evolatile\u7684\u533a\u522b",level:2},{value:"Synchronized\u4e0eVolatile\u4e09\u5927\u6027\u8d28\u603b\u7ed3",id:"synchronized\u4e0evolatile\u4e09\u5927\u6027\u8d28\u603b\u7ed3",level:2},{value:"\u539f\u5b50\u6027",id:"\u539f\u5b50\u6027",level:3},{value:"\u6709\u5e8f\u6027",id:"\u6709\u5e8f\u6027",level:3},{value:"\u53ef\u89c1\u6027",id:"\u53ef\u89c1\u6027",level:3}],p={toc:c};function d(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"[TOC]"),(0,l.kt)("h1",{id:"\u7ebf\u7a0b\u7a0b\u5e8f\u8fdb\u7a0b\u7684\u57fa\u672c\u6982\u5ff5"},"\u7ebf\u7a0b\u3001\u7a0b\u5e8f\u3001\u8fdb\u7a0b\u7684\u57fa\u672c\u6982\u5ff5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\uff1a\u4e0e\u8fdb\u7a0b\u76f8\u4f3c\uff0c\u4f46\u7ebf\u7a0b\u662f\u4e00\u4e2a\u6bd4\u8fdb\u7a0b\u66f4\u5c0f\u7684\u6267\u884c\u5355\u4f4d\u3002\u4e00\u4e2a\u8fdb\u7a0b\u5728\u5176\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4ea7\u751f\u591a\u4e2a\u7ebf\u7a0b\u3002\u4e0e\u8fdb\u7a0b\u4e0d\u540c\u7684\u662f\u540c\u7c7b\u7684\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u548c\u4e00\u7ec4\u7cfb\u7edf\u8d44\u6e90\uff0c\u6240\u4ee5\u7cfb\u7edf\u5728\u4ea7\u751f\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6216\u662f\u5728\u5404\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u4f5c\u5207\u6362\u5de5\u4f5c\u65f6\uff0c\u8d1f\u62c5\u8981\u6bd4\u8fdb\u7a0b\u5c0f\u5f97\u591a\uff0c\u4e5f\u6b63\u56e0\u4e3a\u5982\u6b64\uff0c\u7ebf\u7a0b\u4e5f\u88ab\u79f0\u4e3a\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u7a0b\u5e8f\uff1a\u662f\u542b\u6709\u6307\u4ee4\u548c\u6570\u636e\u7684\u6587\u4ef6\uff0c\u88ab\u5b58\u50a8\u5728\u78c1\u76d8\u6216\u5176\u4ed6\u7684\u6570\u636e\u5b58\u50a8\u8bbe\u5907\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\u7a0b\u5e8f\u662f\u9759\u6001\u7684\u4ee3\u7801\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\uff1a\u662f\u7a0b\u5e8f\u7684\u4e00\u6b21\u6267\u884c\u8fc7\u7a0b\uff0c\u662f\u7cfb\u7edf\u8fd0\u884c\u7a0b\u5e8f\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u56e0\u6b64\u8fdb\u7a0b\u662f\u52a8\u6001\u7684\u3002\u7cfb\u7edf\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\u5373\u662f\u4e00\u4e2a\u8fdb\u7a0b\u4ece\u521b\u5efa\uff0c\u8fd0\u884c\u5230\u6d88\u4ea1\u7684\u8fc7\u7a0b\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u5c31\u662f\u4e00\u4e2a\u6267\u884c\u4e2d\u7684\u7a0b\u5e8f\uff0c\u5b83\u5728\u8ba1\u7b97\u673a\u4e2d\u4e00\u4e2a\u6307\u4ee4\u63a5\u7740\u4e00\u4e2a\u6307\u4ee4\u5730\u6267\u884c\u7740\uff0c\u540c\u65f6\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u8fd8\u5360\u6709\u67d0\u4e9b\u7cfb\u7edf\u8d44\u6e90\u5982 CPU \u65f6\u95f4\uff0c\u5185\u5b58\u7a7a\u95f4\uff0c\u6587\u4ef6\uff0c\u6587\u4ef6\uff0c\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7684\u4f7f\u7528\u6743\u7b49\u7b49\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5f53\u7a0b\u5e8f\u5728\u6267\u884c\u65f6\uff0c\u5c06\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8f7d\u5165\u5185\u5b58\u4e2d\u3002 \u7ebf\u7a0b\u662f\u8fdb\u7a0b\u5212\u5206\u6210\u7684\u66f4\u5c0f\u7684\u8fd0\u884c\u5355\u4f4d\u3002\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u6700\u5927\u7684\u4e0d\u540c\u5728\u4e8e\u57fa\u672c\u4e0a\u5404\u8fdb\u7a0b\u662f\u72ec\u7acb\u7684\uff0c\u800c\u5404\u7ebf\u7a0b\u5219\u4e0d\u4e00\u5b9a\uff0c\u56e0\u4e3a\u540c\u4e00\u8fdb\u7a0b\u4e2d\u7684\u7ebf\u7a0b\u6781\u6709\u53ef\u80fd\u4f1a\u76f8\u4e92\u5f71\u54cd\u3002\u4ece\u53e6\u4e00\u89d2\u5ea6\u6765\u8bf4\uff0c\u8fdb\u7a0b\u5c5e\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u8303\u7574\uff0c\u4e3b\u8981\u662f\u540c\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u4e00\u4e2a\u4ee5\u4e0a\u7684\u7a0b\u5e8f\uff0c\u800c\u7ebf\u7a0b\u5219\u662f\u5728\u540c\u4e00\u7a0b\u5e8f\u5185\u51e0\u4e4e\u540c\u65f6\u6267\u884c\u4e00\u4e2a\u4ee5\u4e0a\u7684\u7a0b\u5e8f\u6bb5\u3002")),(0,l.kt)("h1",{id:"\u7ebf\u7a0b\u7684\u57fa\u672c\u72b6\u6001"},"\u7ebf\u7a0b\u7684\u57fa\u672c\u72b6\u6001"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u65b0\u5efa\u72b6\u6001(New)\uff1a\u65b0\u521b\u5efa\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u8c61\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5c31\u7eea\u72b6\u6001(Runnable)\uff1a\u7ebf\u7a0b\u5bf9\u8c61\u521b\u5efa\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528\u4e86\u8be5\u5bf9\u8c61\u7684start()\u65b9\u6cd5\u3002\u8be5\u72b6\u6001\u7684\u7ebf\u7a0b\u4f4d\u4e8e\n\u201c\u53ef\u8fd0\u884c\u7ebf\u7a0b\u6c60\u201d\u4e2d\uff0c\u53d8\u5f97\u53ef\u8fd0\u884c\uff0c\u53ea\u7b49\u5f85\u83b7\u53d6CPU\u7684\u4f7f\u7528\u6743\u3002\u5373\u5728\u5c31\u7eea\u72b6\u6001\u7684\u8fdb\u7a0b\u9664CPU\u4e4b\u5916\uff0c\u5176\n\u5b83\u7684\u8fd0\u884c\u6240\u9700\u8d44\u6e90\u90fd\u5df2\u5168\u90e8\u83b7\u5f97\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u8fd0\u884c\u72b6\u6001(Running)\uff1a\u5c31\u7eea\u72b6\u6001\u7684\u7ebf\u7a0b\u83b7\u53d6\u4e86CPU\uff0c\u6267\u884c\u7a0b\u5e8f\u4ee3\u7801\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u963b\u585e\u72b6\u6001(Blocked)\uff1a\u963b\u585e\u72b6\u6001\u662f\u7ebf\u7a0b\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u653e\u5f03CPU\u4f7f\u7528\u6743\uff0c\u6682\u65f6\u505c\u6b62\u8fd0\u884c\u3002\u76f4\u5230\u7ebf\u7a0b\u8fdb\u5165\n\u5c31\u7eea\u72b6\u6001\uff0c\u624d\u6709\u673a\u4f1a\u8f6c\u5230\u8fd0\u884c\u72b6\u6001\u3002\n\u963b\u585e\u7684\u60c5\u51b5\u5206\u4e09\u79cd\uff1a"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u7b49\u5f85\u963b\u585e\uff1a\u8fd0\u884c\u7684\u7ebf\u7a0b\u6267\u884cwait()\u65b9\u6cd5\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u91ca\u653e\u5360\u7528\u7684\u6240\u6709\u8d44\u6e90\uff0cJVM\u4f1a\u628a\u8be5\u7ebf\u7a0b\u653e\u5165\u201c\u7b49\u5f85\u6c60\u201d\u4e2d\u3002\u8fdb\u5165\u8fd9\u4e2a\u72b6\u6001\u540e\uff0c\u662f\u4e0d\u80fd\u81ea\u52a8\u5524\u9192\u7684\uff0c\u5fc5\u987b\u4f9d\u9760\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528notify()\u6216notifyAll()\u65b9\u6cd5\u624d\u80fd\u88ab\u5524\u9192\uff0c")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u540c\u6b65\u963b\u585e\uff1a\u8fd0\u884c\u7684\u7ebf\u7a0b\u5728\u83b7\u53d6\u5bf9\u8c61\u7684\u540c\u6b65\u9501\u65f6\uff0c\u82e5\u8be5\u540c\u6b65\u9501\u88ab\u522b\u7684\u7ebf\u7a0b\u5360\u7528\uff0c\u5219JVM\u4f1a\u628a\u8be5\u7ebf\u7a0b\u653e\u5165\u201c\u9501\u6c60\u201d\u4e2d\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5176\u4ed6\u963b\u585e\uff1a\u8fd0\u884c\u7684\u7ebf\u7a0b\u6267\u884csleep()\u6216join()\u65b9\u6cd5\uff0c\u6216\u8005\u53d1\u51fa\u4e86I/O\u8bf7\u6c42\u65f6\uff0cJVM\u4f1a\u628a\u8be5\u7ebf\u7a0b\u7f6e\u4e3a\u963b\u585e\u72b6\u6001\u3002\u5f53sleep()\u72b6\u6001\u8d85\u65f6\u3001join()\u7b49\u5f85\u7ebf\u7a0b\u7ec8\u6b62\u6216\u8005\u8d85\u65f6\u3001\u6216\u8005I/O\u5904\u7406\u5b8c\u6bd5\u65f6\uff0c\u7ebf\u7a0b\u91cd\u65b0\u8f6c\u5165\u5c31\u7eea\u72b6\u6001\u3002"))))),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},"\u6b7b\u4ea1\u72b6\u6001(Dead)\uff1a\u7ebf\u7a0b\u6267\u884c\u5b8c\u4e86\u6216\u8005\u56e0\u5f02\u5e38\u9000\u51fa\u4e86run()\u65b9\u6cd5\uff0c\u8be5\u7ebf\u7a0b\u7ed3\u675f\u751f\u547d\u5468\u671f\u3002")),(0,l.kt)("p",null,"Java \u7ebf\u7a0b\u5728\u8fd0\u884c\u7684\u751f\u547d\u5468\u671f\u4e2d\u7684\u6307\u5b9a\u65f6\u523b\u53ea\u53ef\u80fd\u5904\u4e8e\u4e0b\u9762 6 \u79cd\u4e0d\u540c\u72b6\u6001\u7684\u5176\u4e2d\u4e00\u4e2a\u72b6\u6001\u3002\u7ebf\u7a0b\u5728\u751f\u547d\u5468\u671f\u4e2d\u5e76\u4e0d\u662f\u56fa\u5b9a\u5904\u4e8e\u67d0\u4e00\u4e2a\u72b6\u6001\u800c\u662f\u968f\u7740\u4ee3\u7801\u7684\u6267\u884c\u5728\u4e0d\u540c\u72b6\u6001\u4e4b\u95f4\u5207\u6362\u3002Java \u7ebf\u7a0b\u72b6\u6001\u53d8\u8fc1\u5982\u4e0b\u56fe\u6240\u793a\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220321163552828.png?raw=true",alt:"image-20220321163552828"})),(0,l.kt)("h2",{id:"\u7ebf\u7a0b\u751f\u547d\u5468\u671f"},"\u7ebf\u7a0b\u751f\u547d\u5468\u671f"),(0,l.kt)("p",null,'\u5f53\u7ebf\u7a0b\u88ab\u521b\u5efa\u5e76\u542f\u52a8\u4ee5\u540e\uff0c\u5b83\u65e2\u4e0d\u662f\u4e00\u542f\u52a8\u5c31\u8fdb\u5165\u4e86\u6267\u884c\u72b6\u6001\uff0c\u4e5f\u4e0d\u662f\u4e00\u76f4\u5904\u4e8e\u6267\u884c\u72b6\u6001\u3002\u5728\u7ebf\u7a0b\u7684\u751f\n\u547d\u5468\u671f\u4e2d\uff0c\u5b83\u8981\u7ecf\u8fc7\u65b0\u5efa(New)\u3001\u5c31\u7eea\uff08Runnable\uff09\u3001\u8fd0\u884c\uff08Running\uff09\u3001\u963b\u585e(Blocked)\u548c\u6b7b\u4ea1\n(Dead)5 \u79cd\u72b6\u6001\u3002\u5c24\u5176\u662f\u5f53\u7ebf\u7a0b\u542f\u52a8\u4ee5\u540e\uff0c\u5b83\u4e0d\u53ef\u80fd\u4e00\u76f4"\u9738\u5360"\u7740 CPU \u72ec\u81ea\u8fd0\u884c\uff0c\u6240\u4ee5 CPU \u9700\u8981\u5728\u591a\n\u6761\u7ebf\u7a0b\u4e4b\u95f4\u5207\u6362\uff0c\u4e8e\u662f\u7ebf\u7a0b\u72b6\u6001\u4e5f\u4f1a\u591a\u6b21\u5728\u8fd0\u884c\u3001\u963b\u585e\u4e4b\u95f4\u5207\u6362'),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u65b0\u5efa\u72b6\u6001\uff08NEW\uff09"),"\n\u5f53\u7a0b\u5e8f\u4f7f\u7528 new \u5173\u952e\u5b57\u521b\u5efa\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u4e4b\u540e\uff0c\u8be5\u7ebf\u7a0b\u5c31\u5904\u4e8e\u65b0\u5efa\u72b6\u6001\uff0c\u6b64\u65f6\u4ec5\u7531 JVM \u4e3a\u5176\u5206\u914d\u5185\u5b58\uff0c\n\u5e76\u521d\u59cb\u5316\u5176\u6210\u5458\u53d8\u91cf\u7684\u503c"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u5c31\u7eea\u72b6\u6001\uff08RUNNABLE\uff09\uff1a"),"\n\u5f53\u7ebf\u7a0b\u5bf9\u8c61\u8c03\u7528\u4e86 start()\u65b9\u6cd5\u4e4b\u540e\uff0c\u8be5\u7ebf\u7a0b\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u3002Java \u865a\u62df\u673a\u4f1a\u4e3a\u5176\u521b\u5efa\u65b9\u6cd5\u8c03\u7528\u6808\u548c\u7a0b\u5e8f\u8ba1\n\u6570\u5668\uff0c\u7b49\u5f85\u8c03\u5ea6\u8fd0\u884c\u3002"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u963b\u585e\u72b6\u6001\uff08BLOCKED\uff09\uff1a"),"\n\u963b\u585e\u72b6\u6001\u662f\u6307\u7ebf\u7a0b\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u653e\u5f03\u4e86 cpu \u4f7f\u7528\u6743\uff0c\u4e5f\u5373\u8ba9\u51fa\u4e86 cpu timeslice\uff0c\u6682\u65f6\u505c\u6b62\u8fd0\u884c\u3002\u76f4\u5230\u7ebf\n\u7a0b\u8fdb\u5165\u53ef\u8fd0\u884c(runnable)\u72b6\u6001\uff0c\u624d\u6709\u673a\u4f1a\u518d\u6b21\u83b7\u5f97 cpu timeslice \u8f6c\u5230\u8fd0\u884c(running)\u72b6\n\u6001\u3002\u963b\u585e\u7684\u60c5\u51b5\u5206\u4e09\u79cd\uff1a",(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u7b49\u5f85\u963b\u585e\uff08o.wait->\u7b49\u5f85\u5bf9\u5217\uff09\uff1a"),"\n\u8fd0\u884c(running)\u7684\u7ebf\u7a0b\u6267\u884c o.wait()\u65b9\u6cd5\uff0cJVM \u4f1a\u628a\u8be5\u7ebf\u7a0b\u653e\u5165\u7b49\u5f85\u961f\u5217(waitting queue)\u4e2d\u3002"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u540c\u6b65\u963b\u585e(lock->\u9501\u6c60)"),"\n\u8fd0\u884c(running)\u7684\u7ebf\u7a0b\u5728\u83b7\u53d6\u5bf9\u8c61\u7684\u540c\u6b65\u9501\u65f6\uff0c\u82e5\u8be5\u540c\u6b65\u9501\u88ab\u522b\u7684\u7ebf\u7a0b\u5360\u7528\uff0c\u5219 JVM \u4f1a\u628a\u8be5\u7ebf\u7a0b\u653e\u5165\u9501\u6c60\n(lock pool)\u4e2d\u3002"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u5176\u4ed6\u963b\u585e(sleep/join)"),"\n\u8fd0\u884c(running)\u7684\u7ebf\u7a0b\u6267\u884c Thread.sleep(long ms)\u6216 t.join()\u65b9\u6cd5\uff0c\u6216\u8005\u53d1\u51fa\u4e86 I/O \u8bf7\u6c42\u65f6\uff0cJVM \u4f1a\u628a\u8be5\n\u7ebf\u7a0b\u7f6e\u4e3a\u963b\u585e\u72b6\u6001\u3002\u5f53 sleep()\u72b6\u6001\u8d85\u65f6\u3001join()\u7b49\u5f85\u7ebf\u7a0b\u7ec8\u6b62\u6216\u8005\u8d85\u65f6\u3001\u6216\u8005 I/O\u5904\u7406\u5b8c\u6bd5\u65f6\uff0c\u7ebf\u7a0b\u91cd\u65b0\n\u8f6c\u5165\u53ef\u8fd0\u884c(runnable)\u72b6\u6001\u3002"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u7ebf\u7a0b\u6b7b\u4ea1\uff08DEAD\uff09"),"\n\u7ebf\u7a0b\u4f1a\u4ee5\u4e0b\u9762\u4e09\u79cd\u65b9\u5f0f\u7ed3\u675f\uff0c\u7ed3\u675f\u540e\u5c31\u662f\u6b7b\u4ea1\u72b6\u6001\u3002",(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u6b63\u5e38\u7ed3\u675f\uff1arun()\u6216call()\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\uff0c\u7ebf\u7a0b\u6b63\u5e38\u7ed3\u675f"),(0,l.kt)("li",{parentName:"ol"},"\u5f02\u5e38\u7ed3\u675f\uff1a\u7ebf\u7a0b\u629b\u51fa\u4e00\u4e2a\u672a\u6355\u83b7\u7684\u5f02\u5e38\u6216\u9519\u8bef"),(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528stop\uff1a\u76f4\u63a5\u8c03\u7528\u7ebf\u7a0b\u7684stop()\u65b9\u6cd5\u6765\u7ed3\u675f\u8fd9\u4e00\u7ebf\u7a0b\uff0c\u6b64\u65b9\u6cd5\u5bb9\u6613\u5bfc\u81f4\u6b7b\u9501\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528")))),(0,l.kt)("h2",{id:"\u7ec8\u6b62\u7ebf\u7a0b\u7684\u56db\u79cd\u65b9\u5f0f"},"\u7ec8\u6b62\u7ebf\u7a0b\u7684\u56db\u79cd\u65b9\u5f0f"),(0,l.kt)("h3",{id:"\u6b63\u5e38\u8fd0\u884c\u7ed3\u675f"},"\u6b63\u5e38\u8fd0\u884c\u7ed3\u675f"),(0,l.kt)("p",null,"\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\uff0c\u7ebf\u7a0b\u81ea\u52a8\u7ed3\u675f\u3002"),(0,l.kt)("h3",{id:"\u4f7f\u7528\u9000\u51fa\u6807\u5fd7\u9000\u51fa\u7ebf\u7a0b"},"\u4f7f\u7528\u9000\u51fa\u6807\u5fd7\u9000\u51fa\u7ebf\u7a0b"),(0,l.kt)("p",null,"\u4e00\u822c run()\u65b9\u6cd5\u6267\u884c\u5b8c\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u6b63\u5e38\u7ed3\u675f\uff0c\u7136\u800c\uff0c\u5e38\u5e38\u6709\u4e9b\u7ebf\u7a0b\u9700\u8981\u957f\u65f6\u95f4\u7684\u8fd0\u884c\uff0c\u53ea\u6709\u5728\u5916\u90e8\u67d0\u4e9b\u6761\u4ef6\u6ee1\u8db3\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u5173\u95ed\u8fd9\u4e9b\u7ebf\u7a0b\u3002\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u63a7\u5236\u5faa\u73af\uff0c\u4f8b\u5982\uff1a\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\u5c31\u662f\u8bbe\u4e00\u4e2a boolean \u7c7b\u578b\u7684\u6807\u5fd7\uff0c\u5e76\u901a\u8fc7\u8bbe\u7f6e\u8fd9\u4e2a\u6807\u5fd7\u4e3a true \u6216 false \u6765\u63a7\u5236 while\u5faa\u73af\u662f\u5426\u9000\u51fa\uff0c\u4ee3\u7801\u793a\u4f8b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class ThreadSafe extends Thread {\n    public volatile boolean exit = false;\n        public void run() { while (!exit){\n        //do something\n        }\n    }\n}\n")),(0,l.kt)("p",null,"\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9000\u51fa\u6807\u5fd7 exit\uff0c\u5f53 exit \u4e3a true \u65f6\uff0cwhile \u5faa\u73af\u9000\u51fa\uff0cexit \u7684\u9ed8\u8ba4\u503c\u4e3a false.\u5728\u5b9a\u4e49 exit\u65f6\uff0c\u4f7f\u7528\u4e86\u4e00\u4e2a Java \u5173\u952e\u5b57 volatile\uff0c\u8fd9\u4e2a\u5173\u952e\u5b57\u7684\u76ee\u7684\u662f\u4f7f exit \u540c\u6b65\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6765\u4fee\u6539 exit \u7684\u503c\u3002"),(0,l.kt)("h3",{id:"interrupt-\u65b9\u6cd5\u7ed3\u675f\u7ebf\u7a0b"},"Interrupt() \u65b9\u6cd5\u7ed3\u675f\u7ebf\u7a0b"),(0,l.kt)("p",null,"\u4f7f\u7528 interrupt()\u65b9\u6cd5\u6765\u4e2d\u65ad\u7ebf\u7a0b\u6709\u4e24\u79cd\u60c5\u51b5\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff1a\u5982\u4f7f\u7528\u4e86 sleep,\u540c\u6b65\u9501\u7684 wait,socket \u4e2d\u7684 receiver,accept \u7b49\u65b9\u6cd5\u65f6\uff0c\u4f1a\u4f7f\u7ebf\u7a0b\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002\u5f53\u8c03\u7528\u7ebf\u7a0b\u7684 interrupt()\u65b9\u6cd5\u65f6\uff0c\u4f1a\u629b\u51fa InterruptException \u5f02\u5e38\u3002\u963b\u585e\u4e2d\u7684\u90a3\u4e2a\u65b9\u6cd5\u629b\u51fa\u8fd9\u4e2a\u5f02\u5e38\uff0c\u901a\u8fc7\u4ee3\u7801\u6355\u83b7\u8be5\u5f02\u5e38\uff0c\u7136\u540e break \u8df3\u51fa\u5faa\u73af\u72b6\u6001\uff0c\u4ece\u800c\u8ba9\u6211\u4eec\u6709\u673a\u4f1a\u7ed3\u675f\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u3002\u901a\u5e38\u5f88\u591a\u4eba\u8ba4\u4e3a\u53ea\u8981\u8c03\u7528 interrupt \u65b9\u6cd5\u7ebf\u7a0b\u5c31\u4f1a\u7ed3\u675f\uff0c\u5b9e\u9645\u4e0a\u662f\u9519\u7684\uff0c \u4e00\u5b9a\u8981\u5148\u6355\u83b7 InterruptedException \u5f02\u5e38\u4e4b\u540e\u901a\u8fc7 break \u6765\u8df3\u51fa\u5faa\u73af\uff0c\u624d\u80fd\u6b63\u5e38\u7ed3\u675f run \u65b9\u6cd5\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b\u672a\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff1a\u4f7f\u7528 isInterrupted()\u5224\u65ad\u7ebf\u7a0b\u7684\u4e2d\u65ad\u6807\u5fd7\u6765\u9000\u51fa\u5faa\u73af\u3002\u5f53\u4f7f\u7528interrupt()\u65b9\u6cd5\u65f6\uff0c\u4e2d\u65ad\u6807\u5fd7\u5c31\u4f1a\u7f6e true\uff0c\u548c\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u6807\u5fd7\u6765\u63a7\u5236\u5faa\u73af\u662f\u4e00\u6837\u7684\u9053\u7406\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class ThreadSafe extends Thread {\n    public void run() {\n        while (!isInterrupted()){ //\u975e\u963b\u585e\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u5224\u65ad\u4e2d\u65ad\u6807\u5fd7\u6765\u9000\u51fa\n            try{\n                Thread.sleep(5*1000);//\u963b\u585e\u8fc7\u7a0b\u6355\u83b7\u4e2d\u65ad\u5f02\u5e38\u6765\u9000\u51fa\n            }catch(InterruptedException e){\n                e.printStackTrace();\n                break;//\u6355\u83b7\u5230\u5f02\u5e38\u4e4b\u540e\uff0c\u6267\u884c break \u8df3\u51fa\u5faa\u73af\n            }\n        }\n    }\n}\n")),(0,l.kt)("h3",{id:"stop-\u65b9\u6cd5\u7ec8\u6b62\u7ebf\u7a0b\u7ebf\u7a0b\u4e0d\u5b89\u5168"},"stop \u65b9\u6cd5\u7ec8\u6b62\u7ebf\u7a0b\uff08\u7ebf\u7a0b\u4e0d\u5b89\u5168\uff09"),(0,l.kt)("p",null,"\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 thread.stop()\u6765\u5f3a\u884c\u7ec8\u6b62\u7ebf\u7a0b\uff0c\u4f46\u662f stop \u65b9\u6cd5\u662f\u5f88\u5371\u9669\u7684\uff0c\u5c31\u8c61\u7a81\u7136\u5173\u95ed\u8ba1\u7b97\u673a\u7535\u6e90\uff0c\u800c\u4e0d\u662f\u6309\u6b63\u5e38\u7a0b\u5e8f\u5173\u673a\u4e00\u6837\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e0d\u53ef\u9884\u6599\u7684\u7ed3\u679c\uff0c\u4e0d\u5b89\u5168\u4e3b\u8981\u662f\uff1athread.stop()\u8c03\u7528\u4e4b\u540e\uff0c\u521b\u5efa\u5b50\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u5c31\u4f1a\u629b\u51fa ThreadDeatherror \u7684\u9519\u8bef\uff0c\u5e76\u4e14\u4f1a\u91ca\u653e\u5b50\u7ebf\u7a0b\u6240\u6301\u6709\u7684\u6240\u6709\u9501\u3002\u4e00\u822c\u4efb\u4f55\u8fdb\u884c\u52a0\u9501\u7684\u4ee3\u7801\u5757\uff0c\u90fd\u662f\u4e3a\u4e86\u4fdd\u62a4\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c\u5982\u679c\u5728\u8c03\u7528thread.stop()\u540e\u5bfc\u81f4\u4e86\u8be5\u7ebf\u7a0b\u6240\u6301\u6709\u7684\u6240\u6709\u9501\u7684\u7a81\u7136\u91ca\u653e(\u4e0d\u53ef\u63a7\u5236)\uff0c\u90a3\u4e48\u88ab\u4fdd\u62a4\u6570\u636e\u5c31\u6709\u53ef\u80fd\u5448\u73b0\u4e0d\u4e00\u81f4\u6027\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5728\u4f7f\u7528\u8fd9\u4e9b\u88ab\u7834\u574f\u7684\u6570\u636e\u65f6\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4\u4e00\u4e9b\u5f88\u5947\u602a\u7684\u5e94\u7528\u7a0b\u5e8f\u9519\u8bef\u3002\u56e0\u6b64\uff0c\u5e76\u4e0d\u63a8\u8350\u4f7f\u7528 stop \u65b9\u6cd5\u6765\u7ec8\u6b62\u7ebf\u7a0b\u3002"),(0,l.kt)("h2",{id:"wait\u548cnotify"},"wait()\u548cnotify()"),(0,l.kt)("h3",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"wait( )\uff0cnotify( )\uff0cnotifyAll( )\u90fd\u4e0d\u5c5e\u4e8eThread\u7c7b\uff0c\u800c\u662f\u5c5e\u4e8eObject\u57fa\u7840\u7c7b\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709wait( )\uff0cnotify( )\uff0cnotifyAll( ) \u7684\u529f\u80fd\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709\u9501\uff0c\u9501\u662f\u6bcf\u4e2a\u5bf9\u8c61\u7684\u57fa\u7840\uff0c\u5f53\u7136\u64cd\u4f5c\u9501\u7684\u65b9\u6cd5\u4e5f\u662f\u6700\u57fa\u7840\u4e86\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u5f53\u9700\u8981\u8c03\u7528\u4ee5\u4e0a\u7684\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u5bf9\u7ade\u4e89\u8d44\u6e90\u8fdb\u884c\u52a0\u9501\uff0c\u5982\u679c\u4e0d\u52a0\u9501\u7684\u8bdd\uff0c\u5219\u4f1a\u62a5IllegalMonitorStateException \u5f02\u5e38"),(0,l.kt)("li",{parentName:"ol"},"\u5f53\u60f3\u8981\u8c03\u7528wait( )\u8fdb\u884c\u7ebf\u7a0b\u7b49\u5f85\u65f6\uff0c\u5fc5\u987b\u8981\u53d6\u5f97\u8fd9\u4e2a\u9501\u5bf9\u8c61\u7684\u63a7\u5236\u6743\uff08\u5bf9\u8c61\u76d1\u89c6\u5668\uff09\uff0c\u4e00\u822c\u662f\u653e\u5230\nsynchronized(obj)\u4ee3\u7801\u4e2d\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u5728while\u5faa\u73af\u91cc\u800c\u4e0d\u662fif\u8bed\u53e5\u4e0b\u4f7f\u7528wait\uff0c\u8fd9\u6837\uff0c\u4f1a\u5728\u7ebf\u7a0b\u6682\u505c\u6062\u590d\u540e\u90fd\u68c0\u67e5wait\u7684\u6761\u4ef6\uff0c\u5e76\u5728\u6761\u4ef6\u5b9e\u9645\u4e0a\u5e76\u672a\u6539\u53d8\u7684\u60c5\u51b5\u4e0b\u5904\u7406\u5524\u9192\u901a\u77e5"),(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528obj.wait( )\u91ca\u653e\u4e86obj\u7684\u9501\uff0c\u5426\u5219\u5176\u4ed6\u7ebf\u7a0b\u4e5f\u65e0\u6cd5\u83b7\u5f97obj\u7684\u9501\uff0c\u4e5f\u5c31\u65e0\u6cd5\u5728synchronized(obj){obj.notify() } \u4ee3\u7801\u6bb5\u5185\u5524\u9192A\u3002"),(0,l.kt)("li",{parentName:"ol"},"notify( )\u65b9\u6cd5\u53ea\u4f1a\u901a\u77e5\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u7b2c\u4e00\u4e2a\u76f8\u5173\u7ebf\u7a0b\uff08\u4e0d\u4f1a\u901a\u77e5\u4f18\u5148\u7ea7\u6bd4\u8f83\u9ad8\u7684\u7ebf\u7a0b\uff09"),(0,l.kt)("li",{parentName:"ol"},"notifyAll( )\u901a\u77e5\u6240\u6709\u7b49\u5f85\u8be5\u7ade\u4e89\u8d44\u6e90\u7684\u7ebf\u7a0b\uff08\u4e5f\u4e0d\u4f1a\u6309\u7167\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7\u6765\u6267\u884c\uff09"),(0,l.kt)("li",{parentName:"ol"},"\u5047\u8bbe\u6709\u4e09\u4e2a\u7ebf\u7a0b\u6267\u884c\u4e86obj.wait( )\uff0c\u90a3\u4e48obj.notifyAll( )\u5219\u80fd\u5168\u90e8\u5524\u9192tread1\uff0cthread2\uff0cthread3\uff0c\u4f46\u662f\u8981\u7ee7\u7eed\u6267\u884cobj.wait\uff08\uff09\u7684\u4e0b\u4e00\u6761\u8bed\u53e5\uff0c\u5fc5\u987b\u83b7\u5f97obj\u9501\uff0c\u56e0\u6b64\uff0ctread1\uff0cthread2\uff0cthread3\u53ea\u6709\u4e00\u4e2a\u6709\u673a\u4f1a\u83b7\u5f97\u9501\u7ee7\u7eed\u6267\u884c\uff0c\u4f8b\u5982tread1\uff0c\u5176\u4f59\u7684\u9700\u8981\u7b49\u5f85thread1\u91ca\u653eobj\u9501\u4e4b\u540e\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u5f53\u8c03\u7528obj.notify/notifyAll\u540e\uff0c\u8c03\u7528\u7ebf\u7a0b\u4f9d\u65e7\u6301\u6709obj\u9501\uff0c\u56e0\u6b64\uff0cthread1\uff0cthread2\uff0cthread3\u867d\u88ab\u5524\u9192\uff0c\u4f46\u662f\u4ecd\u65e0\u6cd5\u83b7\u5f97obj\u9501\u3002\u76f4\u5230\u8c03\u7528\u7ebf\u7a0b\u9000\u51fasynchronized\u5757\uff0c\u91ca\u653eobj\u9501\u540e\uff0cthread1\uff0cthread2\uff0cthread3\u4e2d\u7684\u4e00\u4e2a\u624d\u6709\u673a\u4f1a\u83b7\u5f97\u9501\u7ee7\u7eed\u6267\u884c\u3002")),(0,l.kt)("h3",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class WaitNotifyTest {\n    // \u5728\u591a\u7ebf\u7a0b\u95f4\u5171\u4eab\u7684\u5bf9\u8c61\u4e0a\u4f7f\u7528wait\n    private String[] shareObj = {"true"};\n\n    public static void main(String[] args) {\n        WaitNotifyTest test = new WaitNotifyTest();\n        ThreadWait threadWait1 = test.new ThreadWait("wait thread1");\n        threadWait1.setPriority(2);\n        ThreadWait threadWait2 = test.new ThreadWait("wait thread2");\n        threadWait2.setPriority(3);\n        ThreadWait threadWait3 = test.new ThreadWait("wait thread3");\n        threadWait3.setPriority(4);\n        ThreadNotify threadNotify = test.new ThreadNotify("notify thread");\n        threadNotify.start();\n        threadWait1.start();\n        threadWait2.start();\n        threadWait3.start();\n    }\n\n    class ThreadWait extends Thread {\n        public ThreadWait(String name) {\n            super(name);\n        }\n\n        public void run() {\n            synchronized (shareObj) {\n                while ("true".equals(shareObj[0])) {\n                    System.out.println("\u7ebf\u7a0b" + this.getName() + "\u5f00\u59cb\u7b49\u5f85");\n                    long startTime = System.currentTimeMillis();\n                    try {\n                        shareObj.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    long endTime = System.currentTimeMillis();\n                    System.out.println("\u7ebf\u7a0b" + this.getName()\n                            + "\u7b49\u5f85\u65f6\u95f4\u4e3a\uff1a" + (endTime - startTime));\n                }\n            }\n            System.out.println("\u7ebf\u7a0b" + getName() + "\u7b49\u5f85\u7ed3\u675f");\n        }\n    }\n\n    class ThreadNotify extends Thread {\n        public ThreadNotify(String name) {\n            super(name);\n        }\n\n        public void run() {\n            try {\n// \u7ed9\u7b49\u5f85\u7ebf\u7a0b\u7b49\u5f85\u65f6\u95f4\n                sleep(3000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            synchronized (shareObj) {\n                System.out.println("\u7ebf\u7a0b" + this.getName() + "\u5f00\u59cb\u51c6\u5907\u901a\u77e5");\n                shareObj[0] = "false";\n                shareObj.notifyAll();\n                System.out.println("\u7ebf\u7a0b" + this.getName() + "\u901a\u77e5\u7ed3\u675f");\n            }\n            System.out.println("\u7ebf\u7a0b" + this.getName() + "\u8fd0\u884c\u7ed3\u675f");\n        }\n    }\n}\n')),(0,l.kt)("p",null,"\u8f93\u51fa\u7ed3\u679c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"\u7ebf\u7a0bwait thread1\u5f00\u59cb\u7b49\u5f85\n\u7ebf\u7a0bwait thread3\u5f00\u59cb\u7b49\u5f85\n\u7ebf\u7a0bwait thread2\u5f00\u59cb\u7b49\u5f85\n\u7ebf\u7a0bnotify thread\u5f00\u59cb\u51c6\u5907\u901a\u77e5\n\u7ebf\u7a0bnotify thread\u901a\u77e5\u7ed3\u675f\n\u7ebf\u7a0bnotify thread\u8fd0\u884c\u7ed3\u675f\n\u7ebf\u7a0bwait thread2\u7b49\u5f85\u65f6\u95f4\u4e3a\uff1a3014\n\u7ebf\u7a0bwait thread2\u7b49\u5f85\u7ed3\u675f\n\u7ebf\u7a0bwait thread3\u7b49\u5f85\u65f6\u95f4\u4e3a\uff1a3014\n\u7ebf\u7a0bwait thread3\u7b49\u5f85\u7ed3\u675f\n\u7ebf\u7a0bwait thread1\u7b49\u5f85\u65f6\u95f4\u4e3a\uff1a3014\n\u7ebf\u7a0bwait thread1\u7b49\u5f85\u7ed3\u675f\n")),(0,l.kt)("h2",{id:"sleep\u548cwait"},"sleep()\u548cwait()"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5bf9\u4e8e sleep()\u65b9\u6cd5\uff0c\u6211\u4eec\u9996\u5148\u8981\u77e5\u9053\u8be5\u65b9\u6cd5\u662f\u5c5e\u4e8e Thread \u7c7b\u4e2d\u7684\u3002\u800c wait()\u65b9\u6cd5\uff0c\u5219\u662f\u5c5e\u4e8e Object\u7c7b\u4e2d\u7684\u3002"),(0,l.kt)("li",{parentName:"ol"},"sleep()\u65b9\u6cd5\u5bfc\u81f4\u4e86\u7a0b\u5e8f\u6682\u505c\u6267\u884c\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u8ba9\u51fa cpu \u8be5\u5176\u4ed6\u7ebf\u7a0b\uff0c\u4f46\u662f\u4ed6\u7684\u76d1\u63a7\u72b6\u6001\u4f9d\u7136\u4fdd\u6301\u8005\uff0c\u5f53\u6307\u5b9a\u7684\u65f6\u95f4\u5230\u4e86\u53c8\u4f1a\u81ea\u52a8\u6062\u590d\u8fd0\u884c\u72b6\u6001\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u5728\u8c03\u7528 sleep()\u65b9\u6cd5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7ebf\u7a0b\u4e0d\u4f1a\u91ca\u653e\u5bf9\u8c61\u9501\u3002\u800c\u5f53\u8c03\u7528 wait()\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u4f1a\u653e\u5f03\u5bf9\u8c61\u9501\uff0c\u8fdb\u5165\u7b49\u5f85\u6b64\u5bf9\u8c61\u7684\u7b49\u5f85\u9501\u5b9a\u6c60\uff0c\u53ea\u6709\u9488\u5bf9\u6b64\u5bf9\u8c61\u8c03\u7528 notify()\u65b9\u6cd5\u540e\u672c\u7ebf\u7a0b\u624d\u8fdb\u5165\u5bf9\u8c61\u9501\u5b9a\u6c60\u51c6\u5907\u83b7\u53d6\u5bf9\u8c61\u9501\u8fdb\u5165\u8fd0\u884c\u72b6\u6001\u3002")),(0,l.kt)("h2",{id:"start\u548crun"},"start()\u548crun()"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"start\uff08\uff09\u65b9\u6cd5\u6765\u542f\u52a8\u7ebf\u7a0b\uff0c\u771f\u6b63\u5b9e\u73b0\u4e86\u591a\u7ebf\u7a0b\u8fd0\u884c\u3002\u8fd9\u65f6\u65e0\u9700\u7b49\u5f85 run \u65b9\u6cd5\u4f53\u4ee3\u7801\u6267\u884c\u5b8c\u6bd5\uff0c\u53ef\n\u4ee5\u76f4\u63a5\u7ee7\u7eed\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u901a\u8fc7\u8c03\u7528 Thread \u7c7b\u7684 start()\u65b9\u6cd5\u6765\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\uff0c \u8fd9\u65f6\u6b64\u7ebf\u7a0b\u662f\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\uff0c \u5e76\u6ca1\u6709\u8fd0\u884c\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u65b9\u6cd5 run()\u79f0\u4e3a\u7ebf\u7a0b\u4f53\uff0c\u5b83\u5305\u542b\u4e86\u8981\u6267\u884c\u7684\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u5185\u5bb9\uff0c\u7ebf\u7a0b\u5c31\u8fdb\u5165\u4e86\u8fd0\u884c\u72b6\u6001\uff0c\u5f00\u59cb\u8fd0\u884c\nrun \u51fd\u6570\u5f53\u4e2d\u7684\u4ee3\u7801\u3002 Run \u65b9\u6cd5\u8fd0\u884c\u7ed3\u675f\uff0c \u6b64\u7ebf\u7a0b\u7ec8\u6b62\u3002\u7136\u540e CPU \u518d\u8c03\u5ea6\u5176\u5b83\u7ebf\u7a0b\u3002")),(0,l.kt)("h1",{id:"linux\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f"},"Linux\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f"),(0,l.kt)("h2",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u901a\u4fe1\u65b9\u6cd5"),(0,l.kt)("th",{parentName:"tr",align:null},"\u65e0\u6cd5\u4ecb\u4e8e\u5185\u6838\u6001\u4e0e\u7528\u6237\u6001\u7684\u539f\u56e0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u7ba1\u9053\uff08\u4e0d\u5305\u62ec\u547d\u540d\u7ba1\u9053\uff09"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5c40\u9650\u4e8e\u7236\u5b50\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u6d88\u606f\u961f\u5217"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5728\u786c\u3001\u8f6f\u4e2d\u65ad\u4e2d\u65e0\u6cd5\u963b\u585e\u5730\u63a5\u53d7\u6570\u636e")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u4fe1\u53f7\u91cf"),(0,l.kt)("td",{parentName:"tr",align:null},"\u65e0\u6cd5\u4ecb\u4e8e\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u4f7f\u7528")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u5185\u5b58\u5171\u4eab"),(0,l.kt)("td",{parentName:"tr",align:null},"\u9700\u8981\u4fe1\u53f7\u91cf\u8f85\u52a9\uff0c\u800c\u4fe1\u53f7\u91cf\u6709\u65e0\u6cd5\u4f7f\u7528")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u5957\u63a5\u5b57"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5728\u786c\u3001\u8f6f\u4e2d\u65ad\u4e2d\u65e0\u6cd5\u963b\u585e\u5730\u63a5\u53d7\u6570\u636e")))),(0,l.kt)("h2",{id:"\u4fe1\u53f7"},"\u4fe1\u53f7"),(0,l.kt)("p",null,"\u4fe1\u53f7\u53c8\u79f0\u8f6f\u7ec8\u7aef\uff0c\u901a\u77e5\u7a0b\u5e8f\u53d1\u751f\u5f02\u6b65\u4e8b\u4ef6\uff0c\u7a0b\u5e8f\u6267\u884c\u4e2d\u968f\u65f6\u88ab\u5404\u79cd\u4fe1\u53f7\u4e2d\u65ad\uff0c\u8fdb\u7a0b\u53ef\u4ee5\u5ffd\u7565\u8be5\u4fe1\u53f7\uff0c\u4e5f\u53ef\u4ee5\u4e2d\u65ad\u5f53\u524d\u7a0b\u5e8f\u8f6c\u800c\u53bb\u5904\u7406\u4fe1\u53f7\uff0c\u5f15\u8d77\u4fe1\u53f7\u539f\u56e0\uff1a\n1).\u7a0b\u5e8f\u4e2d\u6267\u884c\u9519\u8bef\u7801\uff1b\n2).\u5176\u4ed6\u8fdb\u7a0b\u53d1\u9001\u6765\u7684\uff1b\n3).\u7528\u6237\u901a\u8fc7\u63a7\u5236\u7ec8\u7aef\u53d1\u9001\u6765\uff1b\n4).\u5b50\u8fdb\u7a0b\u7ed3\u675f\u65f6\u5411\u7236\u8fdb\u7a0b\u53d1\u9001SIGCLD\uff1b\n5).\u5b9a\u65f6\u5668\u751f\u4ea7\u7684SIGALRM\uff1b"),(0,l.kt)("h2",{id:"\u7ba1\u9053"},"\u7ba1\u9053"),(0,l.kt)("p",null,"\u200b\t\t\u7ba1\u9053\u7684\u4f18\u70b9\u662f\u4e0d\u9700\u8981\u52a0\u9501\uff0c\u7f3a\u70b9\u662f\u9ed8\u8ba4\u7f13\u51b2\u533a\u592a\u5c0f\uff0c\u53ea\u67094K\uff0c\u540c\u65f6\u53ea\u9002\u5408\u7236\u5b50\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u800c\u4e14\u4e00\u4e2a\u7ba1\u9053\u53ea\u9002\u5408\u5355\u5411\u901a\u4fe1\uff0c\u5982\u679c\u8981\u53cc\u5411\u901a\u4fe1\u9700\u8981\u5efa\u7acb\u4e24\u4e2a\u3002\u800c\u4e14\u4e0d\u9002\u5408\u591a\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u6d88\u606f\u4f1a\u4e71\uff0c\u5b83\u7684\u53d1\u9001\u63a5\u6536\u673a\u5236\u662f\u7528read/write\u8fd9\u79cd\u9002\u7528\u6d41\u7684\uff0c\u7f3a\u70b9\u662f\u6570\u636e\u672c\u8eab\u6ca1\u6709\u8fb9\u754c\uff0c\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u81ea\u5df1\u89e3\u91ca\uff0c\u800c\u4e00\u822c\u6d88\u606f\u5927\u591a\u662f\u4e00\u4e2a\u56fa\u5b9a\u957f\u7684\u6d88\u606f\u5934\uff0c\u548c\u4e00\u4e2a\u53d8\u957f\u7684\u6d88\u606f\u4f53\uff0c\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u4ece\u7ba1\u9053read\u5230\u6d88\u606f\u5934\u540e\uff0c\u6d88\u606f\u4f53\u53ef\u80fd\u88ab\u522b\u7684\u5b50\u8fdb\u7a0b\u63a5\u6536\u5230\u3002"),(0,l.kt)("p",null,"\u5355\u5411\uff0c\u4e00\u6bb5\u8f93\u5165\uff0c\u53e6\u4e00\u7aef\u8f93\u51fa\uff0c\u5148\u8fdb\u5148\u51faFIFO\u3002\u7ba1\u9053\u4e5f\u662f\u6587\u4ef6\u3002\u7ba1\u9053\u5927\u5c0f4096\u5b57\u8282\u3002"),(0,l.kt)("p",null,"\u7279\u70b9\uff1a\u7ba1\u9053\u6ee1\u65f6\uff0c\u5199\u963b\u585e\uff1b\u7a7a\u65f6\uff0c\u8bfb\u963b\u585e\u3002"),(0,l.kt)("p",null,"\u5206\u7c7b\uff1a\u666e\u901a\u7ba1\u9053\uff08\u4ec5\u7236\u5b50\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff09\u4f4d\u4e8e\u5185\u5b58\uff1b\u547d\u540d\u7ba1\u9053\u4f4d\u4e8e\u6587\u4ef6\u7cfb\u7edf\uff0c\u6ca1\u6709\u4eb2\u7f18\u5173\u7cfb\u7ba1\u9053\u53ea\u8981\u77e5\u9053\u7ba1\u9053\u540d\u4e5f\u53ef\u4ee5\u901a\u8baf\u3002"),(0,l.kt)("p",null,"\u200b\t\t\u7ba1\u9053\u662f\u7531\u5185\u6838\u7ba1\u7406\u7684\u4e00\u4e2a\u7f13\u51b2\u533a(buffer)\uff0c\u76f8\u5f53\u4e8e\u6211\u4eec\u653e\u5165\u5185\u5b58\u4e2d\u7684\u4e00\u4e2a\u7eb8\u6761\u3002\u7ba1\u9053\u7684\u4e00\u7aef\u8fde\u63a5\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u51fa\u3002\u8fd9\u4e2a\u8fdb\u7a0b\u4f1a\u5411\u7ba1\u9053\u4e2d\u653e\u5165\u4fe1\u606f\u3002\u7ba1\u9053\u7684\u53e6\u4e00\u7aef\u8fde\u63a5\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u5165\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u53d6\u51fa\u88ab\u653e\u5165\u7ba1\u9053\u7684\u4fe1\u606f\u3002\u4e00\u4e2a\u7f13\u51b2\u533a\u4e0d\u9700\u8981\u5f88\u5927\uff0c\u5b83\u88ab\u8bbe\u8ba1\u6210\u4e3a\u73af\u5f62\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4ee5\u4fbf\u7ba1\u9053\u53ef\u4ee5\u88ab\u5faa\u73af\u5229\u7528\u3002\u5f53\u7ba1\u9053\u4e2d\u6ca1\u6709\u4fe1\u606f\u7684\u8bdd\uff0c\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u7684\u8fdb\u7a0b\u4f1a\u7b49\u5f85\uff0c\u76f4\u5230\u53e6\u4e00\u7aef\u7684\u8fdb\u7a0b\u653e\u5165\u4fe1\u606f\u3002\u5f53\u7ba1\u9053\u88ab\u653e\u6ee1\u4fe1\u606f\u7684\u65f6\u5019\uff0c\u5c1d\u8bd5\u653e\u5165\u4fe1\u606f\u7684\u8fdb\u7a0b\u4f1a\u7b49\u5f85\uff0c\u76f4\u5230\u53e6\u4e00\u7aef\u7684\u8fdb\u7a0b\u53d6\u51fa\u4fe1\u606f\u3002\u5f53\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u7ec8\u7ed3\u7684\u65f6\u5019\uff0c\u7ba1\u9053\u4e5f\u81ea\u52a8\u6d88\u5931\u3002"),(0,l.kt)("h2",{id:"\u6d88\u606f\u961f\u5217"},"\u6d88\u606f\u961f\u5217"),(0,l.kt)("p",null,"\u200b\t\t\u6d88\u606f\u961f\u5217\u4e5f\u4e0d\u8981\u52a0\u9501\uff0c\u9ed8\u8ba4\u7f13\u51b2\u533a\u548c\u5355\u6d88\u606f\u4e0a\u9650\u90fd\u8981\u5927\u4e00\u4e9b\uff0c\u662f64K\uff0c\u5b83\u5e76\u4e0d\u5c40\u9650\u4e8e\u7236\u5b50\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u53ea\u8981\u4e00\u4e2a\u76f8\u540c\u7684key\uff0c\u5c31\u53ef\u4ee5\u8ba9\u4e0d\u540c\u7684\u8fdb\u7a0b\u5b9a\u4f4d\u5230\u540c\u4e00\u4e2a\u6d88\u606f\u961f\u5217\u4e0a\uff0c\u5b83\u4e5f\u53ef\u4ee5\u7528\u6765\u7ed9\u53cc\u5411\u901a\u4fe1\uff0c\u4e0d\u8fc7\u7a0d\u5fae\u52a0\u4e2a\u6807\u8bc6\uff0c\u53ef\u4ee5\u901a\u8fc7\u6d88\u606f\u4e2d\u7684type\u8fdb\u884c\u533a\u5206\uff0c\u6bd4\u5982\u4e00\u4e2a\u4efb\u52a1\u5206\u6d3e\u8fdb\u7a0b\uff0c\u521b\u5efa\u4e86\u82e5\u5e72\u4e2a\u6267\u884c\u5b50\u8fdb\u7a0b\uff0c\u4e0d\u7ba1\u662f\u7236\u8fdb\u7a0b\u53d1\u9001\u5206\u6d3e\u4efb\u52a1\u7684\u6d88\u606f\uff0c\u8fd8\u662f\u5b50\u8fdb\u7a0b\u53d1\u9001\u4efb\u52a1\u6267\u884c\u7684\u6d88\u606f\uff0c\u90fd\u5c06type\u8bbe\u7f6e\u4e3a\u76ee\u6807\u8fdb\u7a0b\u7684pid\uff0c\u56e0\u4e3amsgrcv\u53ef\u4ee5\u6307\u5b9a\u53ea\u63a5\u6536\u6d88\u606f\u7c7b\u578b\u4e3atype\u7684\u6d88\u606f\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u5b50\u8fdb\u7a0b\u53ea\u63a5\u6536\u81ea\u5df1\u7684\u4efb\u52a1\uff0c\u7236\u8fdb\u7a0b\u53ea\u63a5\u6536\u4efb\u52a1\u7ed3\u679c\u3002"),(0,l.kt)("p",null,"\u6d88\u606f\u961f\u5217\u662f\u5148\u8fdb\u5148\u51faFIFO\u539f\u5219\n\u6d88\u606f\u7ed3\u6784\u6a21\u677f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"struct msgbuf\n{\n    long int mtype;//\u6d88\u606f\u7c7b\u578b\n    char mtext[1];//\u6d88\u606f\u5185\u5bb9\n}\n")),(0,l.kt)("h2",{id:"\u5171\u4eab\u5185\u5b58"},"\u5171\u4eab\u5185\u5b58"),(0,l.kt)("p",null,"\u5171\u4eab\u5185\u5b58\u7684\u51e0\u4e4e\u53ef\u4ee5\u8ba4\u4e3a\u6ca1\u6709\u4e0a\u9650\uff0c\u5b83\u4e5f\u662f\u4e0d\u5c40\u9650\u4e0e\u7236\u5b50\u8fdb\u7a0b\uff0c\u91c7\u7528\u8ddf\u6d88\u606f\u961f\u5217\u7c7b\u4f3c\u7684\u5b9a\u4f4d\u65b9\u5f0f\uff0c\u56e0\u4e3a\u5185\u5b58\u662f\u5171\u4eab\u7684\uff0c\u4e0d\u5b58\u5728\u4efb\u4f55\u5355\u5411\u7684\u9650\u5236\uff0c\u6700\u5927\u7684\u95ee\u9898\u5c31\u662f\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u81ea\u5df1\u505a\u4e92\u65a5\uff0c\u6709\u5982\u4e0b\u51e0\u79cd\u65b9\u6848:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u53ea\u9002\u7528\u4e24\u4e2a\u8fdb\u7a0b\u5171\u4eab\uff0c\u5728\u5185\u5b58\u4e2d\u653e\u4e00\u4e2a\u6807\u5fd7\u4f4d\uff0c\u4e00\u5b9a\u8981\u58f0\u660e\u4e3avolatile\uff0c\u5927\u5bb6\u57fa\u4e8e\u6807\u5fd7\u4f4d\u6765\u4e92\u65a5\uff0c\u4f8b\u5982\u4e3a0\u65f6\u7b2c\u4e00\u4e2a\u53ef\u4ee5\u5199\uff0c\u7b2c\u4e8c\u4e2a\u5c31\u7b49\u5f85\uff0c\u4e3a1\u65f6\u7b2c\u4e00\u4e2a\u7b49\u5f85\uff0c\u7b2c\u4e8c\u4e2a\u53ef\u4ee5\u5199/\u8bfb"),(0,l.kt)("li",{parentName:"ol"},"\u4e5f\u53ea\u9002\u7528\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u662f\u7528\u4fe1\u53f7\uff0c\u5927\u5bb6\u7b49\u5f85\u4e0d\u540c\u7684\u4fe1\u53f7\uff0c\u7b2c\u4e00\u4e2a\u5199\u5b8c\u4e86\u53d1\u9001\u4fe1\u53f72\uff0c\u7b49\u5f85\u4fe1\u53f71\uff0c\u7b2c\u4e8c\u4e2a\u7b49\u5f85\u4fe1\u53f72\uff0c\u6536\u5230\u540e\u8bfb\u53d6/\u5199\u5165\u5b8c\uff0c\u53d1\u9001\u4fe1\u53f71\uff0c\u5b83\u4e0d\u662f\u7528\u66f4\u591a\u8fdb\u7a0b\u662f\u56e0\u4e3a\u867d\u7136\u7236\u8fdb\u7a0b\u53ef\u4ee5\u5411\u4e0d\u540c\u5b50\u8fdb\u7a0b\u5206\u522b\u53d1\u9001\u4fe1\u53f7\uff0c\u4f46\u662f\u5b50\u8fdb\u7a0b\u6536\u5230\u4fe1\u53f7\u4f1a\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\uff0c\u4ea7\u751f\u4e0d\u540c\u5b50\u8fdb\u7a0b\u95f4\u7684\u7ade\u6001\u6761\u4ef6\uff0c\u5982\u679c\u7528\u591a\u5757\u5171\u4eab\u5185\u5b58\uff0c\u53c8\u5b58\u5728\u5b50\u8fdb\u7a0b\u53d1\u9001\u7ed3\u679c\u901a\u77e5\u4fe1\u53f7\u65f6\uff0c\u7236\u8fdb\u7a0b\u6536\u5230\u4fe1\u53f7\u540e\uff0c\u4e0d\u77e5\u9053\u662f\u8c01\u53d1\u9001\uff0c\u4e5f\u610f\u5473\u7740\u4e0d\u77e5\u9053\u8be5\u8bbf\u95ee\u54ea\u5757\u5171\u4eab\u5185\u5b58\uff0c\u5373\u4f7f\u5b50\u8fdb\u7a0b\u53d1\u9001\u4e0d\u540c\u7684\u7ed3\u679c\u901a\u77e5\u4fe1\u53f7\uff0c\u56e0\u4e3a\u7b49\u5f85\u4fe1\u53f7\u7684\u4e00\u5b9a\u662f\u963b\u585e\u7684\uff0c\u5982\u679c\u67d0\u4e2a\u5b50\u8fdb\u7a0b\u610f\u5916\u7ec8\u6b62\uff0c\u7236\u8fdb\u7a0b\u5c06\u6c38\u8fdc\u963b\u585e\u4e0b\u53bb\uff0c\u800c\u4e0d\u80fd\u8d85\u65f6\u5904\u7406"),(0,l.kt)("li",{parentName:"ol"},"\u91c7\u7528\u4fe1\u53f7\u91cf\u6216\u8005msgctl\u81ea\u5df1\u7684\u52a0\u9501\u3001\u89e3\u9501\u529f\u80fd\uff0c\u4e0d\u8fc7\u540e\u8005\u53ea\u9002\u7528\u4e8elinux")),(0,l.kt)("h2",{id:"\u4fe1\u53f7\u91cf"},"\u4fe1\u53f7\u91cf"),(0,l.kt)("p",null,"\u4fe1\u53f7\u91cf\u662f\u4e00\u79cd\u7528\u4e8e\u63d0\u4f9b\u4e0d\u540c\u8fdb\u7a0b\u95f4\u6216\u4e00\u4e2a\u8fdb\u7a0b\u95f4\u7684\u4e0d\u540c\u7ebf\u7a0b\u95f4\u7ebf\u7a0b\u540c\u6b65\u624b\u6bb5\u7684\u539f\u8bed\uff0csystemV\u4fe1\u53f7\u91cf\u5728\u5185\u6838\u4e2d\u7ef4\u62a4\n\u4e8c\u503c\u4fe1\u53f7\u91cf \uff1a \u5176\u503c\u53ea\u67090\u30011 \u4e24\u79cd\u9009\u62e9\uff0c0\u8868\u793a\u8d44\u6e90\u88ab\u9501\uff0c1\u8868\u793a\u8d44\u6e90\u53ef\u7528\uff1b\n\u8ba1\u6570\u4fe1\u53f7\u91cf\uff1a\u5176\u503c\u57280 \u548c\u67d0\u4e2a\u9650\u5b9a\u503c\u4e4b\u95f4\uff0c\u4e0d\u9650\u5b9a\u8d44\u6e90\u6570\u53ea\u57280 1 \u4e4b\u95f4\uff1b\n\u8ba1\u6570\u4fe1\u53f7\u91cf\u96c6 \uff1a\u591a\u4e2a\u4fe1\u53f7\u91cf\u7684\u96c6\u5408\u7ec4\u6210\u4fe1\u53f7\u91cf\u96c6"),(0,l.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,l.kt)("p",null,"\u7ba1\u9053\u662f\u6700\u5f31\u7684\uff0c\u53ea\u9002\u5408\u6709\u9650\u573a\u666f\uff1b"),(0,l.kt)("p",null,"\u6d88\u606f\u961f\u5217\u80fd\u9002\u5408\u5927\u90e8\u5206\u573a\u666f\uff0c\u7f3a\u70b9\u662f\u9ed8\u8ba4\u7f13\u51b2\u4e5f\u6bd4\u8f83\u5c0f\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u53ef\u4ee5\u8c03\u6574\uff0c\u524d\u63d0\u662f\u4f60\u6709\u7ba1\u7406\u5458\u6743\u9650\uff1b"),(0,l.kt)("p",null,"\u5171\u4eab\u5185\u5b58\u662f\u6700\u5f3a\u5927\u7684\uff0c\u53ea\u662f\u8981\u505a\u4e92\u65a5\uff1b"),(0,l.kt)("h1",{id:"\u7ebf\u7a0b\u6c60\u7684\u539f\u7406\u53ca\u521b\u5efa\u65b9\u5f0f"},"\u7ebf\u7a0b\u6c60\u7684\u539f\u7406\u53ca\u521b\u5efa\u65b9\u5f0f"),(0,l.kt)("h2",{id:"\u539f\u7406"},"\u539f\u7406"),(0,l.kt)("h3",{id:"\u7ebf\u7a0b\u6c60\u7684\u4f18\u70b9"},"\u7ebf\u7a0b\u6c60\u7684\u4f18\u70b9"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b\u662f\u7a00\u7f3a\u8d44\u6e90\uff0c\u4f7f\u7528\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u51cf\u5c11\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u7684\u6b21\u6570\uff0c\u6bcf\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528"),(0,l.kt)("li",{parentName:"ol"},"\u53ef\u4ee5\u6839\u636e\u7cfb\u7edf\u7684\u627f\u53d7\u80fd\u529b\uff0c\u8c03\u6574\u7ebf\u7a0b\u4e2d\u5de5\u4f5c\u7ebf\u7a0b\u7684\u6570\u91cf\uff0c\u9632\u6b62\u56e0\u4e3a\u6d88\u8017\u8fc7\u591a\u5185\u5b58\u5bfc\u81f4\u670d\u52a1\u5668\u5d29\u6e83"),(0,l.kt)("li",{parentName:"ol"},"\u63d0\u9ad8\u54cd\u5e94\u901f\u5ea6\u3002\u5f53\u4efb\u52a1\u5230\u8fbe\u65f6\uff0c\u4efb\u52a1\u53ef\u4ee5\u4e0d\u9700\u8981\u7b49\u5230\u7ebf\u7a0b\u521b\u5efa\u5c31\u80fd\u7acb\u5373\u6267\u884c\u3002")),(0,l.kt)("h3",{id:"\u7ebf\u7a0b\u6c60\u7684\u521b\u5efa"},"\u7ebf\u7a0b\u6c60\u7684\u521b\u5efa"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,\n                            long keepAliveTime,\n                            TimeUnit unit,\n                            BlockingQueue<Runnable> workQueue,\n                            RejectedExecutionHandler handler)\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"corePoolSize\uff1a\u7ebf\u7a0b\u6c60\u6838\u5fc3\u7ebf\u7a0b\u6570,\u5728\u6ca1\u6709\u8bbe\u7f6e allowCoreThreadTimeOut \u4e3a true \u7684\u60c5\u51b5\u4e0b\uff0c\u6838\u5fc3\u7ebf\u7a0b\u4f1a\u5728\u7ebf\n\u7a0b\u6c60\u4e2d\u4e00\u76f4\u5b58\u6d3b\uff0c\u5373\u4f7f\u5904\u4e8e\u95f2\u7f6e\u72b6\u6001\u3002"),(0,l.kt)("li",{parentName:"ul"},"maximumPoolSize\uff1a\u7ebf\u7a0b\u6c60\u6700\u5927\u7ebf\u7a0b\u6570\u91cf\u5f53\u6d3b\u52a8\u7ebf\u7a0b(\u6838\u5fc3\u7ebf\u7a0b+\u975e\u6838\u5fc3\u7ebf\u7a0b)\u8fbe\u5230\u8fd9\u4e2a\u6570\u503c\u540e\uff0c\u540e\u7eed\u4efb\u52a1\u5c06\n\u4f1a\u6839\u636e RejectedExecutionHandler \u6765\u8fdb\u884c\u62d2\u7edd\u7b56\u7565\u5904\u7406\u3002"),(0,l.kt)("li",{parentName:"ul"},"keepAliverTime\uff1a\u5f53\u6d3b\u8dc3\u7ebf\u7a0b\u6570\u5927\u4e8e\u6838\u5fc3\u7ebf\u7a0b\u6570\u65f6\uff0c\u7a7a\u95f2\u7684\u591a\u4f59\u7ebf\u7a0b\u6700\u5927\u5b58\u6d3b\u65f6\u95f4,\u8d85\u8fc7\u8be5\u65f6\u957f\uff0c\u975e\u6838\u5fc3\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u56de\u6536\u3002\u82e5\u7ebf\u7a0b\u6c60\u901a\u8bbe\u7f6e\u6838\u5fc3\u7ebf\u7a0b\u4e5f\u5141\u8bb8 timeOut\uff0c\u5373 allowCoreThreadTimeOut \u4e3a true\uff0c\u5219\u8be5\u65f6\u957f\u540c\u6837\u4f1a\u4f5c\u7528\u4e8e\u6838\u5fc3\u7ebf\u7a0b\uff0c\u5728\u8d85\u8fc7aliveTime \u65f6\uff0c\u6838\u5fc3\u7ebf\u7a0b\u4e5f\u4f1a\u88ab\u56de\u6536\uff0cAsyncTask \u914d\u7f6e\u7684\u7ebf\u7a0b\u6c60\u5c31\u662f\u8fd9\u6837\u8bbe\u7f6e\u7684"),(0,l.kt)("li",{parentName:"ul"},"unit\uff1a\u5b58\u6d3b\u65f6\u95f4\u7684\u5355\u4f4d"),(0,l.kt)("li",{parentName:"ul"},"workQueue\uff1a\u5b58\u653e\u4efb\u52a1\u7684\u961f\u5217\uff0c\u901a\u8fc7\u7ebf\u7a0b\u6c60\u7684 execute() \u65b9\u6cd5\u63d0\u4ea4\u7684 Runnable \u5bf9\u8c61\u4f1a\u5b58\u50a8\u5728\u8be5\u961f\u5217\u4e2d"),(0,l.kt)("li",{parentName:"ul"},"handler\uff1a\u8d85\u51fa\u7ebf\u7a0b\u8303\u56f4\u548c\u961f\u5217\u5bb9\u91cf\u7684\u4efb\u52a1\u7684\u5904\u7406\u7a0b\u5e8f")),(0,l.kt)("h2",{id:"\u4efb\u52a1\u963b\u585e\u961f\u5217blockingqueue"},"\u4efb\u52a1\u963b\u585e\u961f\u5217BlockingQueue"),(0,l.kt)("p",null,"\u4efb\u52a1\u961f\u5217 workQueue \u662f\u7528\u4e8e\u5b58\u653e\u4e0d\u80fd\u88ab\u53ca\u65f6\u5904\u7406\u6389\u7684\u4efb\u52a1\u7684\u4e00\u4e2a\u961f\u5217\uff0c\u5b83\u662f \u4e00\u4e2a BlockingQueue \u7c7b\u578b\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5173\u4e8e BlockingQueue\uff0c\u867d\u7136\u5b83\u662f Queue \u7684\u5b50\u63a5\u53e3\uff0c\u4f46\u662f\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u5e76\u4e0d\u662f\u5bb9\u5668\uff0c\u800c\u662f\u4f5c\u4e3a\u7ebf\u7a0b\u540c\u6b65\u7684\u5de5\u5177\uff0c\u4ed6\u6709\u4e00\u4e2a\u7279\u5f81\uff0c\u5f53\u751f\u4ea7\u8005\u8bd5\u56fe\u5411 BlockingQueue \u653e\u5165(put)\u5143\u7d20\uff0c\u5982\u679c\u961f\u5217\u5df2\u6ee1\uff0c\u5219\u8be5\u7ebf\u7a0b\u88ab\u963b\u585e\uff1b\u5f53\u6d88\u8d39\u8005\u8bd5\u56fe\u4ece BlockingQueue \u53d6\u51fa(take)\u5143\u7d20\uff0c\u5982\u679c\u961f\u5217\u5df2\u7a7a\uff0c\u5219\u8be5\u7ebf\u7a0b\u88ab\u963b\u585e\u3002")),(0,l.kt)("h3",{id:"\u5e38\u7528\u7684\u963b\u585e\u961f\u5217\u5177\u4f53\u7c7b"},"\u5e38\u7528\u7684\u963b\u585e\u961f\u5217\u5177\u4f53\u7c7b"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"ArrayBlockingQueue"),(0,l.kt)("li",{parentName:"ol"},"LinkedBlockingQueue"),(0,l.kt)("li",{parentName:"ol"},"PriorityBlockingQueue"),(0,l.kt)("li",{parentName:"ol"},"LinkedBlockingDeque")),(0,l.kt)("h3",{id:"\u65e0\u754c\u961f\u5217"},"\u65e0\u754c\u961f\u5217"),(0,l.kt)("p",null,"\u961f\u5217\u5927\u5c0f\u65e0\u9650\u5236\uff0c\u5e38\u7528\u7684\u4e3a\u65e0\u754c\u7684LinkedBlockingQueue\uff0c\u4f7f\u7528\u8be5\u961f\u5217\u505a\u4e3a\u963b\u585e\u961f\u5217\u65f6\u8981\u5c24\u5176\u5f53\u5fc3\uff0c\u5f53\u4efb\u52a1\u8017\u65f6\u8f83\u957f\u65f6\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf\u65b0\u4efb\u52a1\u5728\u961f\u5217\u4e2d\u5806\u79ef\u6700\u7ec8\u5bfc\u81f4OOM\u3002"),(0,l.kt)("h3",{id:"\u6709\u754c\u961f\u5217"},"\u6709\u754c\u961f\u5217"),(0,l.kt)("p",null,"\u5e38\u7528\u7684\u6709\u4e24\u7c7b\uff0c\u4e00\u7c7b\u662f\u9075\u5faaFIFO\u539f\u5219\u7684\u961f\u5217\u5982ArrayBlockingQueue\u4e0e\u6709\u754c\u7684LinkedBlockingQueue\uff0c\u53e6\u4e00\u7c7b\u662f\u4f18\u5148\u7ea7\u961f\u5217\u5982PriorityBlockingQueue\u3002PriorityBlockingQueue\u4e2d\u7684\u4f18\u5148\u7ea7\u7531\u4efb\u52a1\u7684Comparator\u51b3\u5b9a\u3002\n\u4f7f\u7528\u6709\u754c\u961f\u5217\u65f6\u961f\u5217\u5927\u5c0f\u9700\u548c\u7ebf\u7a0b\u6c60\u5927\u5c0f\u4e92\u76f8\u914d\u5408\uff0c\u7ebf\u7a0b\u6c60\u8f83\u5c0f\u6709\u754c\u961f\u5217\u8f83\u5927\u65f6\u53ef\u51cf\u5c11\u5185\u5b58\u6d88\u8017\uff0c\u964d\u4f4ecpu\u4f7f\u7528\u7387\u548c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a\u9650\u5236\u7cfb\u7edf\u541e\u5410\u91cf\u3002"),(0,l.kt)("h3",{id:"\u540c\u6b65\u79fb\u4ea4"},"\u540c\u6b65\u79fb\u4ea4"),(0,l.kt)("p",null,"\u5982\u679c\u4e0d\u5e0c\u671b\u4efb\u52a1\u5728\u961f\u5217\u4e2d\u7b49\u5f85\u800c\u662f\u5e0c\u671b\u5c06\u4efb\u52a1\u76f4\u63a5\u79fb\u4ea4\u7ed9\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u53ef\u4f7f\u7528SynchronousQueue\u4f5c\u4e3a\u7b49\u5f85\u961f\u5217\u3002SynchronousQueue\u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u961f\u5217\uff0c\u800c\u662f\u4e00\u79cd\u7ebf\u7a0b\u4e4b\u95f4\u79fb\u4ea4\u7684\u673a\u5236\u3002\u8981\u5c06\u4e00\u4e2a\u5143\u7d20\u653e\u5165\nSynchronousQueue\u4e2d\uff0c\u5fc5\u987b\u6709\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u63a5\u6536\u8fd9\u4e2a\u5143\u7d20\u3002\u53ea\u6709\u5728\u4f7f\u7528\u65e0\u754c\u7ebf\u7a0b\u6c60\u6216\u8005\u6709\u9971\u548c\u7b56\u7565\u65f6\u624d\u5efa\u8bae\u4f7f\u7528\u8be5\u961f\u5217\u3002"),(0,l.kt)("h3",{id:"blockingqueue\u7684\u6dfb\u52a0\u548c\u5220\u9664\u65b9\u6cd5"},"BlockingQueue\u7684\u6dfb\u52a0\u548c\u5220\u9664\u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6dfb\u52a0\u65b9\u6cd5\uff1a")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"add\uff1a\u6dfb\u52a0\u5143\u7d20\u5230\u961f\u5217\u91cc\uff0c\u6dfb\u52a0\u6210\u529f\u8fd4\u56detrue\uff0c\u7531\u4e8e\u5bb9\u91cf\u6ee1\u4e86\u6dfb\u52a0\u5931\u8d25\u4f1a\u629b\u51faIllegalStateException\u5f02\u5e38"),(0,l.kt)("li",{parentName:"ol"},"offer\uff1a\u6dfb\u52a0\u5143\u7d20\u5230\u961f\u5217\u91cc\uff0c\u6dfb\u52a0\u6210\u529f\u8fd4\u56detrue\uff0c\u6dfb\u52a0\u5931\u8d25\u8fd4\u56defalse"),(0,l.kt)("li",{parentName:"ol"},"put\uff1a\u6dfb\u52a0\u5143\u7d20\u5230\u961f\u5217\u91cc\uff0c\u5982\u679c\u5bb9\u91cf\u6ee1\u4e86\u4f1a\u963b\u585e\u76f4\u5230\u5bb9\u91cf\u4e0d\u6ee1")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5220\u9664\u65b9\u6cd5\uff1a")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"poll\uff1a\u5220\u9664\u961f\u5217\u5934\u90e8\u5143\u7d20\uff0c\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c\u8fd4\u56denull\u3002\u5426\u5219\u8fd4\u56de\u5143\u7d20\u3002"),(0,l.kt)("li",{parentName:"ol"},"remove\uff1a\u57fa\u4e8e\u5bf9\u8c61\u627e\u5230\u5bf9\u5e94\u7684\u5143\u7d20\uff0c\u5e76\u5220\u9664\u3002\u5220\u9664\u6210\u529f\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse"),(0,l.kt)("li",{parentName:"ol"},"take\uff1a\u5220\u9664\u961f\u5217\u5934\u90e8\u5143\u7d20\uff0c\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c\u4e00\u76f4\u963b\u585e\u5230\u961f\u5217\u6709\u5143\u7d20\u5e76\u5220\u9664")),(0,l.kt)("h3",{id:"arrayblockingqueue\u5e95\u5c42\u5b9e\u73b0"},"ArrayBlockingQueue\u5e95\u5c42\u5b9e\u73b0"),(0,l.kt)("p",null,"ArrayBlockingQueue\u7684\u539f\u7406\u5c31\u662f\u4f7f\u7528\u4e00\u4e2a\u53ef\u91cd\u5165\u9501\u548c\u8fd9\u4e2a\u9501\u751f\u6210\u7684\u4e24\u4e2a\u6761\u4ef6\u5bf9\u8c61\u8fdb\u884c\u5e76\u53d1\u63a7\u5236(classictwo-condition algorithm)\u3002\nArrayBlockingQueue\u662f\u4e00\u4e2a\u5e26\u6709\u957f\u5ea6\u7684\u963b\u585e\u961f\u5217\uff0c\u521d\u59cb\u5316\u7684\u65f6\u5019\u5fc5\u987b\u8981\u6307\u5b9a\u961f\u5217\u957f\u5ea6\uff0c\u4e14\u6307\u5b9a\u957f\u5ea6\u4e4b\u540e\u4e0d\u5141\u8bb8\u8fdb\u884c\u4fee\u6539\u3002"),(0,l.kt)("h4",{id:"arrayblockingqueue\u5e26\u6709\u7684\u5c5e\u6027"},"ArrayBlockingQueue\u5e26\u6709\u7684\u5c5e\u6027"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u5b58\u50a8\u961f\u5217\u5143\u7d20\u7684\u6570\u7ec4\uff0c\u662f\u4e2a\u5faa\u73af\u6570\u7ec4\nfinal Object[] items;\n\n//\u62ff\u6570\u636e\u7684\u7d22\u5f15\uff0c\u7528\u4e8etake,poll,peek,remove\u65b9\u6cd5\nint takeIndex;\n\n// \u653e\u6570\u636e\u7684\u7d22\u5f15\uff0c\u7528\u4e8eput\uff0coffer\uff0cadd\u65b9\u6cd5\nint putIndex;\n\n// \u5143\u7d20\u4e2a\u6570\nint count;\n\n// \u53ef\u91cd\u5165\u9501\nfinal ReentrantLock lock;\n\n// notEmpty\u6761\u4ef6\u5bf9\u8c61\uff0c\u7531lock\u521b\u5efa\nprivate final Condition notEmpty;\n\n// notFull\u6761\u4ef6\u5bf9\u8c61\uff0c\u7531lock\u521b\u5efa\nprivate final Condition notFull;\n")),(0,l.kt)("h4",{id:"arrayblockingqueue\u6570\u636e\u7684\u6dfb\u52a0addofferput"},"ArrayBlockingQueue\u6570\u636e\u7684\u6dfb\u52a0(add,offer,put)"),(0,l.kt)("p",null,"add\u65b9\u6cd5\u5185\u90e8\u8c03\u7528offer\u65b9\u6cd5\uff0c\u5982\u679c\u961f\u5217\u6ee1\u4e86\uff0c\u629b\u51faIllegalStateException\u5f02\u5e38\uff0c\u5426\u5219\u8fd4\u56detrue"),(0,l.kt)("p",null,"offer\u65b9\u6cd5\u5982\u679c\u961f\u5217\u6ee1\u4e86\uff0c\u8fd4\u56defalse\uff0c\u5426\u5219\u8fd4\u56detrue"),(0,l.kt)("p",null,"add\u65b9\u6cd5\u548coffer\u65b9\u6cd5\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0cput\u65b9\u6cd5\u5982\u679c\u961f\u5217\u6ee1\u4e86\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u76f4\u5230\u6709\u7ebf\u7a0b\u6d88\u8d39\u4e86\u961f\u5217\u91cc\u7684\u6570\u636e\u624d\u6709\u53ef\u80fd\u88ab\u5524\u9192\u3002"),(0,l.kt)("p",null,"\u8fd93\u4e2a\u65b9\u6cd5\u5185\u90e8\u90fd\u4f1a\u4f7f\u7528\u53ef\u91cd\u5165\u9501\u4fdd\u8bc1\u539f\u5b50\u6027\u3002"),(0,l.kt)("p",null,"add\u65b9\u6cd5:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public boolean add(E e) {\n    if (offer(e))\n        return true;\n    else\n        throw new IllegalStateException("Queue full");\n}\n')),(0,l.kt)("p",null,"offer\u65b9\u6cd5:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public boolean offer(E e) {\n    checkNotNull(e); // \u4e0d\u5141\u8bb8\u5143\u7d20\u4e3a\u7a7a\n    final ReentrantLock lock = this.lock;\n    lock.lock(); // \u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528offer\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        if (count == items.length) // \u5982\u679c\u961f\u5217\u5df2\u6ee1\n            return false; // \u76f4\u63a5\u8fd4\u56defalse\uff0c\u6dfb\u52a0\u5931\u8d25\n        else {\n            insert(e); // \u6570\u7ec4\u6ca1\u6ee1\u7684\u8bdd\u8c03\u7528insert\u65b9\u6cd5\n            return true; // \u8fd4\u56detrue\uff0c\u6dfb\u52a0\u6210\u529f\n        }\n    } finally {\n        lock.unlock(); // \u91ca\u653e\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528offer\u65b9\u6cd5\n    }\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"private void insert(E x) {\n    items[putIndex] = x; // \u5143\u7d20\u6dfb\u52a0\u5230\u6570\u7ec4\u91cc\n    putIndex = inc(putIndex); // \u653e\u6570\u636e\u7d22\u5f15+1\uff0c\u5f53\u7d22\u5f15\u6ee1\u4e86\u53d8\u62100\n    ++count; // \u5143\u7d20\u4e2a\u6570+1\n    notEmpty.signal(); // \u4f7f\u7528\u6761\u4ef6\u5bf9\u8c61notEmpty\u901a\u77e5\uff0c\u6bd4\u5982\u4f7f\u7528take\u65b9\u6cd5\u7684\u65f6\u5019\u961f\u5217\u91cc\u6ca1\u6709\u6570\u636e\uff0c\u88ab\u963b\u585e\u3002\u8fd9\u4e2a\u65f6\u5019\u961f\u5217insert\u4e86\u4e00\u6761\u6570\u636e\uff0c\u9700\u8981\u8c03\u7528signal\u8fdb\u884c\u901a\u77e5\n}\n")),(0,l.kt)("p",null,"put\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public void put(E e) throws InterruptedException {\n    checkNotNull(e); // \u4e0d\u5141\u8bb8\u5143\u7d20\u4e3a\u7a7a\n    final ReentrantLock lock = this.lock;\n    lock.lockInterruptibly(); // \u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528put\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        while (count == items.length) // \u5982\u679c\u961f\u5217\u6ee1\u4e86\uff0c\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u5e76\u52a0\u5165\u5230\u6761\u4ef6\u5bf9\u8c61\n        notFull\u7684\u7b49\u5f85\u961f\u5217\u91cc\n        notFull.await(); // \u7ebf\u7a0b\u963b\u585e\u5e76\u88ab\u6302\u8d77\uff0c\u540c\u65f6\u91ca\u653e\u9501\n        insert(e); // \u8c03\u7528insert\u65b9\u6cd5\n    } finally {\n        lock.unlock(); // \u91ca\u653e\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528put\u65b9\u6cd5\n    }\n}\n")),(0,l.kt)("h4",{id:"arrayblockingqueue\u6570\u636e\u7684\u5220\u9664polltakeremove"},"ArrayBlockingQueue\u6570\u636e\u7684\u5220\u9664(poll\u3001take\u3001remove)"),(0,l.kt)("p",null,"poll\u65b9\u6cd5\u5bf9\u4e8e\u961f\u5217\u4e3a\u7a7a\u7684\u60c5\u51b5\uff0c\u8fd4\u56denull\uff0c\u5426\u5219\u8fd4\u56de\u961f\u5217\u5934\u90e8\u5143\u7d20\u3002"),(0,l.kt)("p",null,"remove\u65b9\u6cd5\u53d6\u7684\u5143\u7d20\u662f\u57fa\u4e8e\u5bf9\u8c61\u7684\u4e0b\u6807\u503c\uff0c\u5220\u9664\u6210\u529f\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse\u3002"),(0,l.kt)("p",null,"poll\u65b9\u6cd5\u548cremove\u65b9\u6cd5\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\u3002"),(0,l.kt)("p",null,"take\u65b9\u6cd5\u5bf9\u4e8e\u961f\u5217\u4e3a\u7a7a\u7684\u60c5\u51b5\uff0c\u4f1a\u963b\u585e\u5e76\u6302\u8d77\u5f53\u524d\u7ebf\u7a0b\uff0c\u76f4\u5230\u6709\u6570\u636e\u52a0\u5165\u5230\u961f\u5217\u4e2d\u3002"),(0,l.kt)("p",null,"\u8fd93\u4e2a\u65b9\u6cd5\u5185\u90e8\u90fd\u4f1a\u8c03\u7528notFull.signal\u65b9\u6cd5\u901a\u77e5\u6b63\u5728\u7b49\u5f85\u961f\u5217\u6ee1\u60c5\u51b5\u4e0b\u7684\u963b\u585e\u7ebf\u7a0b\u3002"),(0,l.kt)("p",null,"poll\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public E poll() {\n    final ReentrantLock lock = this.lock;\n    lock.lock(); // \u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528poll\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        return (count == 0) ? null : extract(); // \u5982\u679c\u961f\u5217\u91cc\u6ca1\u5143\u7d20\u4e86\uff0c\u8fd4\u56denull\uff0c\u5426\u5219\u8c03\u7528extract\u65b9\u6cd5\n    } finally {\n        lock.unlock(); // \u91ca\u653e\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528poll\u65b9\u6cd5\n    }\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"private E extract() {\n    final Object[] items = this.items;\n    E x = this.<E>cast(items[takeIndex]); // \u5f97\u5230\u53d6\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\n    items[takeIndex] = null; // \u5bf9\u5e94\u53d6\u7d22\u5f15\u4e0a\u7684\u6570\u636e\u6e05\u7a7a\n    takeIndex = inc(takeIndex); // \u53d6\u6570\u636e\u7d22\u5f15+1\uff0c\u5f53\u7d22\u5f15\u6ee1\u4e86\u53d8\u62100\n    --count; // \u5143\u7d20\u4e2a\u6570-1\n    notFull.signal(); // \u4f7f\u7528\u6761\u4ef6\u5bf9\u8c61notFull\u901a\u77e5\uff0c\u6bd4\u5982\u4f7f\u7528put\u65b9\u6cd5\u653e\u6570\u636e\u7684\u65f6\u5019\u961f\u5217\u5df2\u6ee1\uff0c\u88ab\u963b\u585e\u3002\u8fd9\u4e2a\u65f6\u5019\u6d88\u8d39\u4e86\u4e00\u6761\u6570\u636e\uff0c\u961f\u5217\u6ca1\u6ee1\u4e86\uff0c\u5c31\u9700\u8981\u8c03\u7528signal\u8fdb\u884c\u901a\u77e5\n    return x; // \u8fd4\u56de\u5143\u7d20\n}\n")),(0,l.kt)("p",null,"take\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public E take() throws InterruptedException {\n    final ReentrantLock lock = this.lock;\n    lock.lockInterruptibly(); // \u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528take\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        while (count == 0) // \u5982\u679c\u961f\u5217\u7a7a\uff0c\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u5e76\u52a0\u5165\u5230\u6761\u4ef6\u5bf9\u8c61notEmpty\u7684\u7b49\u5f85\u961f\n        \u5217\u91cc\n        notEmpty.await(); // \u7ebf\u7a0b\u963b\u585e\u5e76\u88ab\u6302\u8d77\uff0c\u540c\u65f6\u91ca\u653e\u9501\n        return extract(); // \u8c03\u7528extract\u65b9\u6cd5\n    } finally {\n        lock.unlock(); // \u91ca\u653e\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528take\u65b9\u6cd5\n    }\n}\n")),(0,l.kt)("p",null,"remove\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public boolean remove(Object o) {\n    if (o == null) return false;\n    final Object[] items = this.items;\n    final ReentrantLock lock = this.lock;\n    lock.lock();// \u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528remove\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        //\u961f\u5217\u4e0d\u4e3a\u7a7a\u65f6\u8fdb\u884c\u79fb\u9664\n        if (count > 0) {\n             //\u5f15\u7528\u4e0b\u6b21\u5143\u7d20\u5165\u5217\u4f4d\u7f6e\u7684\u7d22\u5f15\n            final int putIndex = this.putIndex;\n            //\u5f15\u7528\u4e0b\u6b21\u5143\u7d20\u51fa\u5217\u4f4d\u7f6e\u7684\u7d22\u5f15\n            int i = takeIndex;\n            /**\u4ece\u51fa\u5217\u4f4d\u7f6e\u5f00\u59cb\u5faa\u73af\u67e5\u627e\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\uff0c\n                \u76f4\u5230\u627e\u5230\u4e86\u8981\u5220\u9664\u7684\u5143\u7d20\u7684\u7d22\u5f15\uff0c\u6267\u884c\n                removeAt(i)\u6839\u636e\u5143\u7d20\u7d22\u5f15\u5220\u9664\u5143\u7d20\u7684\u65b9\u6cd5\uff0c\n                \u6700\u540e\u8fd4\u56detrue\u8868\u793a\u5220\u9664\u6210\u529f\uff0c\u5426\u5219\u8fd4\u56defalse\u5220\u9664\u5931\u8d25*/\n            do {// \u904d\u5386\u5143\u7d20\n                if (o.equals(items[i])) {// \u4e24\u4e2a\u5bf9\u8c61\u76f8\u7b49\u7684\u8bdd\n                    removeAt(i);// \u8c03\u7528removeAt\u65b9\u6cd5\n                    return true;// \u5220\u9664\u6210\u529f\uff0c\u8fd4\u56detrue\n                }\n                if (++i == items.length)\n                    i = 0;\n            } while (i != putIndex);\n        }\n        return false;// \u5220\u9664\u5931\u8d25\uff0c\u8fd4\u56defalse\n    } finally {\n        lock.unlock();// \u91ca\u653e\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528remove\u65b9\u6cd5\n    }\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u6839\u636e\u7d22\u5f15\u5220\u9664\u961f\u5217\u4e2d\u7684\u5143\u7d20\nvoid removeAt(final int removeIndex) {\n    final Object[] items = this.items;\n     //\u5982\u679c\u8981\u5220\u9664\u7684\u5143\u7d20\u5c31\u662f\u961f\u5217\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u76f4\u63a5\u79fb\u9664\uff0c\u5e76\u4e14\u5c06\u51fa\u5217\u7d22\u5f15+1\uff0c\u961f\u5217\u957f\u5ea6-1\n    if (removeIndex == takeIndex) {\n        // removing front item; just advance\n        items[takeIndex] = null;\n        if (++takeIndex == items.length)\n            takeIndex = 0;\n        count--;\n        if (itrs != null)\n            itrs.elementDequeued();\n    } else {\n         //\u5f15\u7528\u4e0b\u6b21\u5143\u7d20\u5165\u5217\u4f4d\u7f6e\u7684\u7d22\u5f15\n        final int putIndex = this.putIndex;\n         /**\u904d\u5386\u6570\u7ec4\uff0c\u5220\u9664\u5143\u7d20\uff0c\u5e76\u5c06\u5220\u9664\u7684\u5143\u7d20\u7559\u4e0b\u7684\u7a7a\u4f4d\u586b\u5145\u6ee1*/\n        for (int i = removeIndex;;) {\n            //\u7d22\u5f15\u5f52\u96f6\n            int next = i + 1;\n            if (next == items.length)\n                next = 0;\n              //\u4e2d\u95f4\u7684\u5143\u7d20\n            if (next != putIndex) {\n                items[i] = items[next];\n                i = next;\n            } else {//\u904d\u5386\u5230\u4e86\u6700\u540e\u4e00\u4e2a\u5143\u7d20\n                items[i] = null;\n                //\u4e0b\u6b21\u5165\u5217\u7684\u7d22\u5f15\u91cd\u7f6e\uff0c\u5e76\u8df3\u51fa\u5faa\u73af\n                this.putIndex = i;\n                break;\n            }\n        }\n        count--;\n        if (itrs != null)\n            itrs.removedAt(removeIndex);\n    }\n    notFull.signal();\n}\n")),(0,l.kt)("h3",{id:"linkedblockingqueue\u5e95\u5c42\u5b9e\u73b0"},"LinkedBlockingQueue\u5e95\u5c42\u5b9e\u73b0"),(0,l.kt)("p",null,"LinkedBlockingQueue\u662f\u4e00\u4e2a\u4f7f\u7528\u94fe\u8868\u5b8c\u6210\u961f\u5217\u64cd\u4f5c\u7684\u963b\u585e\u961f\u5217\u3002\u94fe\u8868\u662f\u5355\u5411\u94fe\u8868\uff0c\u800c\u4e0d\u662f\u53cc\u5411\u94fe\u8868\u3002\u5185\u90e8\u4f7f\u7528\u653e\u9501\u548c\u62ff\u9501\uff0c\u8fd9\u4e24\u4e2a\u9501\u5b9e\u73b0\u963b\u585e\u3002"),(0,l.kt)("h4",{id:"linkedblockingqueue\u5e26\u6709\u7684\u5c5e\u6027"},"LinkedBlockingQueue\u5e26\u6709\u7684\u5c5e\u6027"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"// \u5bb9\u91cf\u5927\u5c0f\nprivate final int capacity;\n// \u5143\u7d20\u4e2a\u6570\uff0c\u56e0\u4e3a\u67092\u4e2a\u9501\uff0c\u5b58\u5728\u7ade\u6001\u6761\u4ef6\uff0c\u4f7f\u7528AtomicInteger\nprivate final AtomicInteger count = new AtomicInteger(0);\n// \u5934\u7ed3\u70b9\nprivate transient Node<E> head;\n// \u5c3e\u8282\u70b9\nprivate transient Node<E> last;\n// \u62ff\u9501\nprivate final ReentrantLock takeLock = new ReentrantLock();\n// \u62ff\u9501\u7684\u6761\u4ef6\u5bf9\u8c61\nprivate final Condition notEmpty = takeLock.newCondition();\n// \u653e\u9501\nprivate final ReentrantLock putLock = new ReentrantLock();\n// \u653e\u9501\u7684\u6761\u4ef6\u5bf9\u8c61\nprivate final Condition notFull = putLock.newCondition();\n")),(0,l.kt)("p",null,"ArrayBlockingQueue\u53ea\u67091\u4e2a\u9501\uff0c\u6dfb\u52a0\u6570\u636e\u548c\u5220\u9664\u6570\u636e\u7684\u65f6\u5019\u53ea\u80fd\u67091\u4e2a\u88ab\u6267\u884c\uff0c\u4e0d\u5141\u8bb8\u5e76\u884c\u6267\u884c\u3002"),(0,l.kt)("p",null,"\u800cLinkedBlockingQueue\u67092\u4e2a\u9501\uff0c\u653e\u9501\u548c\u62ff\u9501\uff0c\u6dfb\u52a0\u6570\u636e\u548c\u5220\u9664\u6570\u636e\u662f\u53ef\u4ee5\u5e76\u884c\u8fdb\u884c\u7684\uff0c\u5f53\u7136\u6dfb\u52a0\u6570\u636e\u548c\u5220\u9664\u6570\u636e\u7684\u65f6\u5019\u53ea\u80fd\u67091\u4e2a\u7ebf\u7a0b\u5404\u81ea\u6267\u884c\u3002"),(0,l.kt)("h4",{id:"linkedblockingqueue\u6570\u636e\u7684\u6dfb\u52a0addofferput"},"LinkedBlockingQueue\u6570\u636e\u7684\u6dfb\u52a0\uff08add\u3001offer\u3001put\uff09"),(0,l.kt)("p",null,"add\u65b9\u6cd5\u5185\u90e8\u8c03\u7528offer\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public boolean offer(E e) {\n    if (e == null) throw new NullPointerException(); // \u4e0d\u5141\u8bb8\u7a7a\u5143\u7d20\n    final AtomicInteger count = this.count;\n    if (count.get() == capacity) // \u5982\u679c\u5bb9\u91cf\u6ee1\u4e86\uff0c\u8fd4\u56defalse\n        return false;\n    int c = -1;\n    Node<E> node = new Node(e); // \u5bb9\u91cf\u6ca1\u6ee1\uff0c\u4ee5\u65b0\u5143\u7d20\u6784\u9020\u8282\u70b9\n    final ReentrantLock putLock = this.putLock;\n    putLock.lock(); // \u653e\u9501\u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528offer\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        if (count.get() < capacity) { \n            enqueue(node); // \u8282\u70b9\u6dfb\u52a0\u5230\u94fe\u8868\u5c3e\u90e8\n            c = count.getAndIncrement(); // \u5143\u7d20\u4e2a\u6570+1\n            if (c + 1 < capacity) // \u5982\u679c\u5bb9\u91cf\u8fd8\u6ca1\u6ee1\n            // \u5728\u653e\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notFull\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u8868\u793a\u53ef\u4ee5\u518d\u6b21\u5f80\u961f\u5217\u91cc\u9762\u52a0\u6570\u636e\u4e86\uff0c\u961f\u5217\u8fd8\u6ca1\u6ee1\n                notFull.signal(); \n        }\n    } finally {\n        putLock.unlock(); // \u91ca\u653e\u653e\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528offer\u65b9\u6cd5\n    }\n// \u7531\u4e8e\u5b58\u5728\u653e\u9501\u548c\u62ff\u9501\uff0c\u8fd9\u91cc\u53ef\u80fd\u62ff\u9501\u4e00\u76f4\u5728\u6d88\u8d39\u6570\u636e\uff0ccount\u4f1a\u53d8\u5316\u3002\u8fd9\u91cc\u7684if\u6761\u4ef6\u8868\u793a\u5982\u679c\u961f\u5217\u4e2d\u8fd8\u67091\u6761\u6570\u636e\n    if (c == 0) \n        // \u5728\u62ff\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notEmpty\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u76841\u4e2a\u7ebf\u7a0b\uff0c\u8868\u793a\u961f\u5217\u91cc\u8fd8\u67091\u6761\u6570\u636e\uff0c\u53ef\u4ee5\u8fdb\u884c\u6d88\u8d39\n        signalNotEmpty(); \n    return c >= 0; // \u6dfb\u52a0\u6210\u529f\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse\n}\n")),(0,l.kt)("p",null,"put\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public void put(E e) throws InterruptedException {\n    if (e == null) throw new NullPointerException(); // \u4e0d\u5141\u8bb8\u7a7a\u5143\u7d20\n    int c = -1;\n    Node<E> node = new Node(e); // \u4ee5\u65b0\u5143\u7d20\u6784\u9020\u8282\u70b9\n    final ReentrantLock putLock = this.putLock;\n    final AtomicInteger count = this.count;\n    putLock.lockInterruptibly(); // \u653e\u9501\u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528put\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        while (count.get() == capacity) { // \u5982\u679c\u5bb9\u91cf\u6ee1\u4e86\n            notFull.await(); // \u963b\u585e\u5e76\u6302\u8d77\u5f53\u524d\u7ebf\u7a0b\n        }\n        enqueue(node); // \u8282\u70b9\u6dfb\u52a0\u5230\u94fe\u8868\u5c3e\u90e8\n        c = count.getAndIncrement(); // \u5143\u7d20\u4e2a\u6570+1\n        if (c + 1 < capacity) // \u5982\u679c\u5bb9\u91cf\u8fd8\u6ca1\u6ee1\n            notFull.signal(); // \u5728\u653e\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notFull\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u8868\u793a\u53ef\u4ee5\u518d\u6b21\u5f80\u961f\u5217\u91cc\u9762\u52a0\u6570\u636e\u4e86\uff0c\u961f\u5217\u8fd8\u6ca1\u6ee1\n    } finally {\n        putLock.unlock(); // \u91ca\u653e\u653e\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528put\u65b9\u6cd5\n    }\n    if (c == 0) // \u7531\u4e8e\u5b58\u5728\u653e\u9501\u548c\u62ff\u9501\uff0c\u8fd9\u91cc\u53ef\u80fd\u62ff\u9501\u4e00\u76f4\u5728\u6d88\u8d39\u6570\u636e\uff0ccount\u4f1a\u53d8\u5316\u3002\u8fd9\u91cc\u7684if\u6761\u4ef6 \u8868\u793a\u5982\u679c\u961f\u5217\u4e2d\u8fd8\u67091\u6761\u6570\u636e\n        // \u5728\u62ff\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notEmpty\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u76841\u4e2a\u7ebf\u7a0b\uff0c\u8868\u793a\u961f\u5217\u91cc\u8fd8\u67091\u6761\u6570\u636e\uff0c\u53ef\u4ee5\u8fdb\u884c\u6d88\u8d39\n        signalNotEmpty();\n}\n")),(0,l.kt)("p",null,"\u200b\t\tLinkedBlockingQueue\u7684\u6dfb\u52a0\u6570\u636e\u65b9\u6cd5add\uff0cput\uff0coffer\u8ddfArrayBlockingQueue\u4e00\u6837\uff0c\u4e0d\u540c\u7684\u662f\u5b83\u4eec\u7684\u5e95\u5c42\u5b9e\u73b0\u4e0d\u4e00\u6837\u3002\n\u200b\t\tArrayBlockingQueue\u4e2d\u653e\u5165\u6570\u636e\u963b\u585e\u7684\u65f6\u5019\uff0c\u9700\u8981\u6d88\u8d39\u6570\u636e\u624d\u80fd\u5524\u9192\u3002\u800cLinkedBlockingQueue\u4e2d\u653e\u5165\u6570\u636e\u963b\u585e\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u5b83\u5185\u90e8\u67092\u4e2a\u9501\uff0c\u53ef\u4ee5\u5e76\u884c\u6267\u884c\u653e\u5165\u6570\u636e\u548c\u6d88\u8d39\u6570\u636e\uff0c\u4e0d\u4ec5\u5728\u6d88\u8d39\u6570\u636e\u7684\u65f6\u5019\u8fdb\u884c\u5524\u9192\u63d2\u5165\u963b\u585e\u7684\u7ebf\u7a0b\uff0c\u540c\u65f6\u5728\u63d2\u5165\u7684\u65f6\u5019\u5982\u679c\u5bb9\u91cf\u8fd8\u6ca1\u6ee1\uff0c\u4e5f\u4f1a\u5524\u9192\u63d2\u5165\u963b\u585e\u7684\u7ebf\u7a0b\u3002"),(0,l.kt)("h4",{id:"linkedblockingqueue\u6570\u636e\u7684\u5220\u9664polltakeremove"},"LinkedBlockingQueue\u6570\u636e\u7684\u5220\u9664\uff08poll\u3001take\u3001remove\uff09"),(0,l.kt)("p",null,"poll\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"}," public E poll() {\n     final AtomicInteger count = this.count;\n     if (count.get() == 0) // \u5982\u679c\u5143\u7d20\u4e2a\u6570\u4e3a0\n         return null; // \u8fd4\u56denull\n     E x = null;\n     int c = -1;\n     final ReentrantLock takeLock = this.takeLock;\n     takeLock.lock(); // \u62ff\u9501\u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528poll\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n     try {\n         if (count.get() > 0) { // \u5224\u65ad\u961f\u5217\u91cc\u662f\u5426\u8fd8\u6709\u6570\u636e\n             x = dequeue(); // \u5220\u9664\u5934\u7ed3\u70b9\n             c = count.getAndDecrement(); // \u5143\u7d20\u4e2a\u6570-1\n             if (c > 1) // \u5982\u679c\u961f\u5217\u91cc\u8fd8\u6709\u5143\u7d20\n                 notEmpty.signal(); // \u5728\u62ff\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notEmpty\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u8868\u793a\u961f\u5217\u91cc\u8fd8\u6709\u6570\u636e\uff0c\u53ef\u4ee5\u518d\u6b21\u6d88\u8d39\n         }\n     } finally {\n         takeLock.unlock(); // \u91ca\u653e\u62ff\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528poll\u65b9\u6cd5\n     }\n     if (c == capacity) // \u7531\u4e8e\u5b58\u5728\u653e\u9501\u548c\u62ff\u9501\uff0c\u8fd9\u91cc\u53ef\u80fd\u653e\u9501\u4e00\u76f4\u5728\u6dfb\u52a0\u6570\u636e\uff0ccount\u4f1a\u53d8\u5316\u3002\u8fd9\u91cc \u7684if\u6761\u4ef6\u8868\u793a\u5982\u679c\u961f\u5217\u4e2d\u8fd8\u53ef\u4ee5\u518d\u63d2\u5165\u6570\u636e\n         signalNotFull(); // \u5728\u653e\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notFull\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u76841\u4e2a\u7ebf\u7a0b\uff0c\u8868\u793a\u961f\u5217\u91cc\u8fd8\u80fd\u518d\u6b21\u6dfb\u52a0\u6570\u636e\n     return x;\n }\n")),(0,l.kt)("p",null,"take\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public E take() throws InterruptedException {\n    E x;\n    int c = -1;\n    final AtomicInteger count = this.count;\n    final ReentrantLock takeLock = this.takeLock;\n    takeLock.lockInterruptibly(); // \u62ff\u9501\u52a0\u9501\uff0c\u4fdd\u8bc1\u8c03\u7528take\u65b9\u6cd5\u7684\u65f6\u5019\u53ea\u67091\u4e2a\u7ebf\u7a0b\n    try {\n        while (count.get() == 0) { // \u5982\u679c\u961f\u5217\u91cc\u5df2\u7ecf\u6ca1\u6709\u5143\u7d20\u4e86\n            notEmpty.await(); // \u963b\u585e\u5e76\u6302\u8d77\u5f53\u524d\u7ebf\u7a0b\n        }\n        x = dequeue(); // \u5220\u9664\u5934\u7ed3\u70b9\n        c = count.getAndDecrement(); // \u5143\u7d20\u4e2a\u6570-1\n        if (c > 1) // \u5982\u679c\u961f\u5217\u91cc\u8fd8\u6709\u5143\u7d20\n            notEmpty.signal(); // \u5728\u62ff\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notEmpty\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u8868\u793a\u961f\u5217\u91cc\u8fd8\u6709\u6570\u636e\uff0c\u53ef\u4ee5\u518d\u6b21\u6d88\u8d39\n    } finally {\n        takeLock.unlock(); // \u91ca\u653e\u62ff\u9501\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8c03\u7528take\u65b9\u6cd5\n    }\n    if (c == capacity) // \u7531\u4e8e\u5b58\u5728\u653e\u9501\u548c\u62ff\u9501\uff0c\u8fd9\u91cc\u53ef\u80fd\u653e\u9501\u4e00\u76f4\u5728\u6dfb\u52a0\u6570\u636e\uff0ccount\u4f1a\u53d8\u5316\u3002\u8fd9\u91cc \u7684if\u6761\u4ef6\u8868\u793a\u5982\u679c\u961f\u5217\u4e2d\u8fd8\u53ef\u4ee5\u518d\u63d2\u5165\u6570\u636e\n        signalNotFull(); // \u5728\u653e\u9501\u7684\u6761\u4ef6\u5bf9\u8c61notFull\u4e0a\u5524\u9192\u6b63\u5728\u7b49\u5f85\u76841\u4e2a\u7ebf\u7a0b\uff0c\u8868\u793a\u961f\u5217\u91cc\u8fd8\u80fd\u518d\u6b21\u6dfb\u52a0\u6570\u636e\n    return x;\n}\n")),(0,l.kt)("p",null,"remove\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public boolean remove(Object o) {\n    if (o == null) return false;\n    fullyLock(); // remove\u64cd\u4f5c\u8981\u79fb\u52a8\u7684\u4f4d\u7f6e\u4e0d\u56fa\u5b9a\uff0c2\u4e2a\u9501\u90fd\u9700\u8981\u52a0\u9501\n    try {\n        for (Node<E> trail = head, p = trail.next; // \u4ece\u94fe\u8868\u5934\u7ed3\u70b9\u5f00\u59cb\u904d\u5386\n             p != null;\n             trail = p, p = p.next) {\n            if (o.equals(p.item)) { // \u5224\u65ad\u662f\u5426\u627e\u5230\u5bf9\u8c61\n                unlink(p, trail); // \u4fee\u6539\u8282\u70b9\u7684\u94fe\u63a5\u4fe1\u606f\uff0c\u540c\u65f6\u8c03\u7528notFull\u7684signal\u65b9\u6cd5\n                return true;\n            }\n        }\n        return false;\n    } finally {\n        fullyUnlock(); // 2\u4e2a\u9501\u89e3\u9501\n    }\n}\n")),(0,l.kt)("p",null,"LinkedBlockingQueue\u7684take\u65b9\u6cd5\u5bf9\u4e8e\u6ca1\u6570\u636e\u7684\u60c5\u51b5\u4e0b\u4f1a\u963b\u585e\uff0cpoll\u65b9\u6cd5\u5220\u9664\u94fe\u8868\u5934\u7ed3\u70b9\uff0cremove\u65b9\u6cd5\u5220\u9664\u6307\u5b9a\u7684\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u9700\u8981\u6ce8\u610f\u7684\u662fremove\u65b9\u6cd5\u7531\u4e8e\u8981\u5220\u9664\u7684\u6570\u636e\u7684\u4f4d\u7f6e\u4e0d\u786e\u5b9a\uff0c\u9700\u89812\u4e2a\u9501\u540c\u65f6\u52a0\u9501\u3002"),(0,l.kt)("h2",{id:"\u4efb\u52a1\u62d2\u7edd\u7c7b\u578b"},"\u4efb\u52a1\u62d2\u7edd\u7c7b\u578b"),(0,l.kt)("p",null,"ThreadPoolExecutor.AbortPolicy:(\u629b\u51fa\u5f02\u5e38)"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5f53\u7ebf\u7a0b\u6c60\u4e2d\u7684\u6570\u91cf\u7b49\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570\u65f6\u629b java.util.concurrent.RejectedExecutionException \u5f02\u5e38\uff0c\u6d89\u53ca\u5230\u8be5\u5f02\u5e38\u7684\u4efb\u52a1\u4e5f\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u7ebf\u7a0b\u6c60\u9ed8\u8ba4\u7684\u62d2\u7edd\u7b56\u7565\u5c31\u662f\u8be5\u7b56\u7565\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n    throw new RejectedExecutionException("Task " + r.toString() +" rejected from " +\n                                            e.toString());\n}\n')),(0,l.kt)("p",null,"ThreadPoolExecutor.DiscardPolicy():(\u9ed8\u9ed8\u4e22\u5f03)"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5f53\u7ebf\u7a0b\u6c60\u4e2d\u7684\u6570\u91cf\u7b49\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570\u65f6,\u9ed8\u9ed8\u4e22\u5f03\u4e0d\u80fd\u6267\u884c\u7684\u65b0\u52a0\u4efb\u52a1\uff0c\u4e0d\u62a5\u4efb\u4f55\u5f02\u5e38\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n}\n")),(0,l.kt)("p",null,"ThreadPoolExecutor.CallerRunsPolicy():\uff08\u91cd\u8bd5\u673a\u5236\uff09"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5f53\u7ebf\u7a0b\u6c60\u4e2d\u7684\u6570\u91cf\u7b49\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570\u65f6\uff0c\u91cd\u8bd5\u6dfb\u52a0\u5f53\u524d\u7684\u4efb\u52a1\uff1b\u5b83\u4f1a\u81ea\u52a8\u91cd\u590d\u8c03\u7528execute()\u65b9\u6cd5\u3002\u6362\u8a00\u4e4b\u5c06\u4efb\u52a1\u56de\u9000\u7ed9\u8c03\u7528\u8005\u6765\u76f4\u63a5\u8fd0\u884c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n    if (!e.isShutdown()) {\n         r.run();\n    }\n}\n")),(0,l.kt)("p",null,"ThreadPoolExecutor.DiscardOldestPolicy():\uff08\u629b\u5f03\u8001\u4efb\u52a1\uff09"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5f53\u7ebf\u7a0b\u6c60\u4e2d\u7684\u6570\u91cf\u7b49\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570\u65f6,\u629b\u5f03\u7ebf\u7a0b\u6c60\u4e2d\u5de5\u4f5c\u961f\u5217\u5934\u90e8\u7684\u4efb\u52a1(\u5373\u7b49\u5f85\u65f6\u95f4\u6700\u4e45\u7684\u4efb\u52a1)\uff0c\u5e76\u6267\u884c\u65b0\u4f20\u5165\u7684\u4efb\u52a1\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n    if (!e.isShutdown()) {\n        e.getQueue().poll();\n        e.execute(r);\n    }\n}\n")),(0,l.kt)("h2",{id:"executor\u6846\u67b6\u7684\u4e24\u7ea7\u8c03\u5ea6\u6a21\u578b"},"Executor\u6846\u67b6\u7684\u4e24\u7ea7\u8c03\u5ea6\u6a21\u578b"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220321170220124.png?raw=true",alt:"image-20220321170220124"})),(0,l.kt)("p",null,"\u200b\t\tJAVA\u7ebf\u7a0b\u65e2\u662f\u5de5\u4f5c\u5355\u5143\uff0c\u4e5f\u662f\u6267\u884c\u673a\u5236\u3002\u800c\u5728Executor\u6846\u67b6\u4e2d\uff0c\u6211\u4eec\u5c06\u5de5\u4f5c\u5355\u5143\u4e0e\u6267\u884c\u673a\u5236\u5206\u79bb\u5f00\u6765\u3002Runnable\u548cCallable\u662f\u5de5\u4f5c\u5355\u5143\uff08\u4e5f\u5c31\u662f\u4fd7\u79f0\u7684\u4efb\u52a1\uff09\uff0c\u800c\u6267\u884c\u673a\u5236\u7531Executor\u6765\u63d0\u4f9b\u3002\u8fd9\u6837\u4e00\u6765Executor\u662f\u57fa\u4e8e\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u5f0f\u7684\uff0c\u63d0\u4ea4\u4efb\u52a1\u7684\u64cd\u4f5c\u76f8\u5f53\u4e8e\u751f\u6210\u8005\uff0c\u6267\u884c\u4efb\u52a1\u7684\u7ebf\u7a0b\u76f8\u5f53\u4e8e\u6d88\u8d39\u8005\u3002"),(0,l.kt)("p",null,"1.Executor\u662f\u5f02\u6b65\u4efb\u52a1\u6267\u884c\u6846\u67b6\u7684\u57fa\u7840\uff0c\u8be5\u6846\u67b6\u80fd\u591f\u652f\u6301\u591a\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u4efb\u52a1\u6267\u884c\u7b56\u7565,Executor\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6267\u884c\u65b9\u6cd5\uff0c\u4efb\u52a1\u65f6Runnable\u7c7b\u578b\uff0c\u4e0d\u652f\u6301Callable\u7c7b\u578b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface Executor{\n    void execute(Runnable command);\n}\n")),(0,l.kt)("p",null,"2.ExecutorService\u63a5\u53e3\u5b9e\u73b0\u4e86Executor\u63a5\u53e3\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86\u5173\u95ed\u7ebf\u7a0b\u6c60\u548csubmit\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface ExecutorService extends Executor{\n    List<Runnable> shutdownNow();\n    boolean isTerminated();\n    <T> Future<T> SUBMIT(Callable<T> task);\n}\n")),(0,l.kt)("p",null,"\u53e6\u5916ExecutorService\u63a5\u53e3\u6709\u4e24\u4e2a\u91cd\u8981\u7684\u5b9e\u73b0\u7c7b\uff1a"),(0,l.kt)("p",null,"ThreadPoolExecutor\u4e0eScheduledThreadPoolExecutor\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ThreadPoolExecutor\u662f\u7ebf\u7a0b\u6c60\u7684\u6838\u5fc3\u5b9e\u73b0\u7c7b\uff0c\u7528\u6765\u6267\u884c\u88ab\u63d0\u4ea4\u7684\u4efb\u52a1"),(0,l.kt)("li",{parentName:"ul"},"ScheduledThreadPoolExecutor\u662f\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u53ef\u4ee5\u5728\u7ed9\u5b9a\u7684\u5ef6\u8fdf\u540e\u8fd0\u884c\u4efb\u52a1\uff0c\u6216\u8005\u5b9a\u671f\u6267\u884c\u547d\u4ee4")),(0,l.kt)("h2",{id:"executors\u5de5\u5382"},"Executors\u5de5\u5382"),(0,l.kt)("p",null,"\u63a8\u8350\u4f7f\u7528Exectuors\u5de5\u5382\u65b9\u6cd5\u6765\u521b\u5efa\u7ebf\u7a0b\u6c60\uff0cExecutors\u53ef\u4ee5\u521b\u5efa3\u79cd\u7c7b\u578bThreadPoolExecutorSingleThreadExecutor\u3001FixedThreadExecutor\u548cCachedThreadPool\u3002"),(0,l.kt)("h3",{id:"newsinglethreadexecutor\u5355\u7ebf\u7a0b\u7ebf\u7a0b\u6c60"},"newSingleThreadExecutor\uff1a\u5355\u7ebf\u7a0b\u7ebf\u7a0b\u6c60"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"ExecutorService threadPool = Executors.newSingleThreadExecutor();\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public static ExecutorService newSingleThreadExecutor() {\n    return new FinalizableDelegatedExecutorService(new ThreadPoolExecutor(1, 1,\n        0L, TimeUnit.MILLISECONDS,new LinkedBlockingQueue<Runnable>()));\n}\n")),(0,l.kt)("p",null,"\u4ece\u6e90\u7801\u6765\u770b\u53ef\u4ee5\u77e5\u9053\uff0c\u5355\u7ebf\u7a0b\u7ebf\u7a0b\u6c60\u7684\u521b\u5efa\u4e5f\u662f\u901a\u8fc7ThreadPoolExecutor\uff0c\u91cc\u9762\u7684\u6838\u5fc3\u7ebf\u7a0b\u6570\u548c\u7ebf\u7a0b\u6570\u90fd\u662f1\uff0c\u5e76\u4e14\u5de5\u4f5c\u961f\u5217\u4f7f\u7528\u7684\u662f\u65e0\u754c\u961f\u5217\u3002\u7531\u4e8e\u662f\u5355\u7ebf\u7a0b\u5de5\u4f5c\uff0c\u6bcf\u6b21\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u4efb\u52a1\uff0c\u6240\u4ee5\u540e\u9762\u6240\u6709\u7684\u4efb\u52a1\u90fd\u88ab\u963b\u585e\u5728\u5de5\u4f5c\u961f\u5217\u4e2d\uff0c\u53ea\u80fd\u4e00\u4e2a\u4e2a\u4efb\u52a1\u6267\u884c"),(0,l.kt)("h3",{id:"newscheduledthreadpool\u5b9a\u957f\u7ebf\u7a0b\u6c60\u652f\u6301\u5b9a\u65f6\u53ca\u5468\u671f\u6027\u4efb\u52a1\u6267\u884c"},"newScheduledThreadPool\uff1a\u5b9a\u957f\u7ebf\u7a0b\u6c60\uff0c\u652f\u6301\u5b9a\u65f6\u53ca\u5468\u671f\u6027\u4efb\u52a1\u6267\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"ExecutorService threadPool = Executors.newScheduledThreadPool(5);\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public ScheduledThreadPoolExecutor(int corePoolSize) {\n    super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,\n          new DelayedWorkQueue());\n}\n")),(0,l.kt)("p",null,"ScheduledThreadPoolExecutor\u7684\u7236\u7c7b\u5373ThreadPoolExecutor\uff0c\u56e0\u6b64\u8fd9\u91cc\u5404\u53c2\u6570\u542b\u4e49\u548c\u4e0a\u9762\u4e00\u6837\u3002\u503c\u5f97\u5173\u5fc3\u7684\u662fDelayedWorkQueue\u8fd9\u4e2a\u963b\u585e\u5bf9\u5217\uff0c\u5728\u4e0a\u9762\u6ca1\u6709\u4ecb\u7ecd\uff0c\u5b83\u4f5c\u4e3a\u9759\u6001\u5185\u90e8\u7c7b\u5c31\u5728ScheduledThreadPoolExecutor\u4e2d\u8fdb\u884c\u4e86\u5b9e\u73b0\u3002"),(0,l.kt)("p",null,"DelayedWorkQueue\u662f\u4e00\u4e2a\u65e0\u754c\u961f\u5217\uff0c\u5b83\u80fd\u6309\u4e00\u5b9a\u7684\u987a\u5e8f\u5bf9\u5de5\u4f5c\u961f\u5217\u4e2d\u7684\u5143\u7d20\u8fdb\u884c\u6392\u5217\u3002\u56e0\u6b64\u8fd9\u91cc\n\u8bbe\u7f6e\u7684\u6700\u5927\u7ebf\u7a0b\u6570 Integer.MAX_VALUE\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u3002"),(0,l.kt)("h3",{id:"newfixedthreadexecutor\u56fa\u5b9a\u5927\u5c0f\u7ebf\u7a0b\u6c60"},"newFixedThreadExecutor\uff1a\u56fa\u5b9a\u5927\u5c0f\u7ebf\u7a0b\u6c60"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"ExecutorService threadPool = Executors.newFixedThreadPool(5);\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads,0L, TimeUnit.MILLISECONDS,new                                              LinkedBlockingQueue<Runnable>());\n}\n")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u4e0e\u5355\u7ebf\u7a0b\u7c7b\u4f3c\uff0c\u53ea\u662f\u521b\u5efa\u4e86\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\u6570\u91cf\u3002"),(0,l.kt)("h3",{id:"newcachedthreadpool\u65e0\u754c\u7ebf\u7a0b\u6c60"},"newCachedThreadPool:\u65e0\u754c\u7ebf\u7a0b\u6c60"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"ExecutorService threadPool = Executors.newCachedThreadPool();\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public static ExecutorService newCachedThreadPool () {\n            return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                    60L, TimeUnit.SECONDS,\n                    new SynchronousQueue<Runnable>());\n        }\n")),(0,l.kt)("p",null,"\u65e0\u754c\u7ebf\u7a0b\u6c60\u610f\u5473\u7740\u6ca1\u6709\u5de5\u4f5c\u961f\u5217\uff0c\u4efb\u52a1\u8fdb\u6765\u5c31\u6267\u884c\uff0c\u7ebf\u7a0b\u6570\u91cf\u4e0d\u591f\u5c31\u521b\u5efa\uff0c\u4e0e\u524d\u9762\u4e24\u4e2a\u7684\u533a\u522b\u662f\uff1a\u7a7a\u95f2\u7684\u7ebf\u7a0b\u4f1a\u88ab\u56de\u6536\u6389\uff0c\u7a7a\u95f2\u7684\u65f6\u95f4\u662f60s\u3002\u8fd9\u4e2a\u9002\u7528\u4e8e\u6267\u884c\u5f88\u591a\u77ed\u671f\u5f02\u6b65\u7684\u5c0f\u7a0b\u5e8f\u6216\u8005\u8d1f\u8f7d\u8f83\u8f7b\u7684\u670d\u52a1\u5668\u3002"),(0,l.kt)("h3",{id:"newworkstealingpool\u62e5\u6709\u591a\u4e2a\u4efb\u52a1\u961f\u5217\u4ee5\u4fbf\u51cf\u5c11\u8fde\u63a5\u6570\u7684\u7ebf\u7a0b\u6c60"},"newWorkStealingPool:\u62e5\u6709\u591a\u4e2a\u4efb\u52a1\u961f\u5217\uff08\u4ee5\u4fbf\u51cf\u5c11\u8fde\u63a5\u6570\uff09\u7684\u7ebf\u7a0b\u6c60"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"ExecutorService executorService = Executors.newWorkStealingPool();\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public static ExecutorService newWorkStealingPool() {\n    return new ForkJoinPool(Runtime.getRuntime().availableProcessors(),\n                            ForkJoinPool.defaultForkJoinWorkerThreadFactory,\n                            null, true);\n}\n")),(0,l.kt)("p",null,"\u5982\u679c\u4e0d\u4e3b\u52a8\u8bbe\u7f6e\u5b83\u7684\u5e76\u53d1\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u4f1a\u4ee5\u5f53\u524d\u673a\u5668\u7684CPU\u5904\u7406\u5668\u4e2a\u6570\u4e3a\u7ebf\u7a0b\u4e2a\u6570\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u6c60\u4f1a\u5e76\u884c\u5904\u7406\u4efb\u52a1\uff0c\u4e0d\u80fd\u591f\u4fdd\u8bc1\u4efb\u52a1\u6267\u884c\u7684\u987a\u5e8f\u3002"),(0,l.kt)("h2",{id:"\u81ea\u5e26\u7ebf\u7a0b\u6c60\u7684\u5751"},"\u81ea\u5e26\u7ebf\u7a0b\u6c60\u7684\u5751"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Executors.newFixedThreadPool(10);\n\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\uff1a\n\u5b83\u7684\u5b9e\u73b0new ThreadPoolExecutor(10, 10, 0L, TimeUnit.MILLISECONDS,newLinkedBlockingQueue());\n\u521d\u59cb\u5316\u4e00\u4e2a\u6307\u5b9a\u7ebf\u7a0b\u6570\u7684\u7ebf\u7a0b\u6c60\uff0c\u5176\u4e2dcorePoolSize == maximumPoolSize\uff0c\u4f7f\u7528LinkedBlockingQuene\u4f5c\u4e3a\u963b\u585e\u961f\u5217\uff0c\u5f53\u7ebf\u7a0b\u6c60\u6ca1\u6709\u53ef\u6267\u884c\u4efb\u52a1\u65f6\uff0c\u4e5f\u4e0d\u4f1a\u91ca\u653e\u7ebf\u7a0b\u3002\u7531\u4e8eLinkedBlockingQuene\u7684\u7279\u6027\uff0c\u8fd9\u4e2a\u961f\u5217\u662f\u65e0\u754c\u7684\uff0c\u82e5\u6d88\u8d39\u4e0d\u8fc7\u6765\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u88ab\u4efb\u52a1\u961f\u5217\u5360\u6ee1\uff0c\u6700\u7ec8oom\uff1b"),(0,l.kt)("li",{parentName:"ol"},"Executors.newCachedThreadPool();\n\u7f13\u5b58\u7ebf\u7a0b\u6c60\uff1a\n\u5b83\u7684\u5b9e\u73b0new ThreadPoolExecutor(0,Integer.MAX_VALUE,60L, TimeUnit.SECONDS,newSynchronousQueue());\n\u521d\u59cb\u5316\u4e00\u4e2a\u53ef\u4ee5\u7f13\u5b58\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\uff0c\u9ed8\u8ba4\u7f13\u5b5860s\uff0c\u7ebf\u7a0b\u6c60\u7684\u7ebf\u7a0b\u6570\u53ef\u8fbe\u5230Integer.MAX_VALUE\uff0c\u53732147483647\uff0c\u5185\u90e8\u4f7f\u7528SynchronousQueue\u4f5c\u4e3a\u963b\u585e\u961f\u5217\uff1b\u548cnewFixedThreadPool\u521b\u5efa\u7684\u7ebf\u7a0b\u6c60\u4e0d\u540c\uff0cnewCachedThreadPool\u5728\u6ca1\u6709\u4efb\u52a1\u6267\u884c\u65f6\uff0c\u5f53\u7ebf\u7a0b\u7684\u7a7a\u95f2\u65f6\u95f4\u8d85\u8fc7keepAliveTime\uff0c\u4f1a\u81ea\u52a8\u91ca\u653e\u7ebf\u7a0b\u8d44\u6e90\uff0c\u5f53\u63d0\u4ea4\u65b0\u4efb\u52a1\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u5219\u521b\u5efa\u65b0\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u4f1a\u5bfc\u81f4\u4e00\u5b9a\u7684\u7cfb\u7edf\u5f00\u9500\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u503c\u4e86Integer.MAX_VALUE\uff0c\u4f1a\u5bfc\u81f4\u65e0\u9650\u521b\u5efa\u7ebf\u7a0b\uff1b\u6240\u4ee5\uff0c\u4f7f\u7528\u8be5\u7ebf\u7a0b\u6c60\u65f6\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\u63a7\u5236\u5e76\u53d1\u7684\u4efb\u52a1\u6570\uff0c\u5426\u5219\u521b\u5efa\u5927\u91cf\u7684\u7ebf\u7a0b\u4f1a\u5bfc\u81f4\u4e25\u91cd\u7684\u6027\u80fd\u95ee\u9898;"),(0,l.kt)("li",{parentName:"ol"},"Executors.newSingleThreadExecutor()\n\u5355\u7ebf\u7a0b\u7ebf\u7a0b\u6c60\uff1a\n\u540cnewFixedThreadPool\u7ebf\u7a0b\u6c60\u4e00\u6837\uff0c\u961f\u5217\u7528\u7684\u662fLinkedBlockingQueue\u65e0\u754c\u961f\u5217\uff0c\u53ef\u4ee5\u65e0\u9650\u7684\u5f80\u91cc\u9762\u6dfb\u52a0\u4efb\u52a1\uff0c\u76f4\u5230\u5185\u5b58\u6ea2\u51fa\uff1b")),(0,l.kt)("h1",{id:"callablefuturefuturetash\u8be6\u89e3"},"Callable\u3001Future\u3001FutureTash\u8be6\u89e3"),(0,l.kt)("p",null,"Callable\u4e0eFuture\u662f\u5728JAVA\u7684\u540e\u7eed\u7248\u672c\u4e2d\u5f15\u5165\u8fdb\u6765\u7684\uff0cCallable\u7c7b\u4f3c\u4e8eRunnable\u63a5\u53e3\uff0c\u5b9e\u73b0Callable\u63a5\u53e3\u7684\u7c7b\u4e0e\u5b9e\u73b0Runnable\u7684\u7c7b\u90fd\u662f\u53ef\u4ee5\u88ab\u7ebf\u7a0b\u6267\u884c\u7684\u4efb\u52a1\u3002"),(0,l.kt)("h2",{id:"\u4e09\u8005\u4e4b\u95f4\u7684\u5173\u7cfb"},"\u4e09\u8005\u4e4b\u95f4\u7684\u5173\u7cfb"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Callable\u662fRunnable\u5c01\u88c5\u7684\u5f02\u6b65\u8fd0\u7b97\u4efb\u52a1\u3002\nFuture\u7528\u6765\u4fdd\u5b58Callable\u5f02\u6b65\u8fd0\u7b97\u7684\u7ed3\u679c\nFutureTask\u5c01\u88c5Future\u7684\u5b9e\u4f53\u7c7b")),(0,l.kt)("h2",{id:"callable\u4e0erunnable\u7684\u533a\u522b"},"Callable\u4e0eRunnable\u7684\u533a\u522b"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Callable\u5b9a\u4e49\u7684\u65b9\u6cd5\u662fcall\uff0c\u800cRunnable\u5b9a\u4e49\u7684\u65b9\u6cd5\u662frun\u3002"),(0,l.kt)("li",{parentName:"ol"},"call\u65b9\u6cd5\u6709\u8fd4\u56de\u503c\uff0c\u800crun\u65b9\u6cd5\u662f\u6ca1\u6709\u8fd4\u56de\u503c\u7684\u3002"),(0,l.kt)("li",{parentName:"ol"},"call\u65b9\u6cd5\u53ef\u4ee5\u629b\u51fa\u5f02\u5e38\uff0c\u800crun\u65b9\u6cd5\u4e0d\u80fd\u629b\u51fa\u5f02\u5e38\u3002")),(0,l.kt)("h2",{id:"future"},"Future"),(0,l.kt)("p",null,"Future\u8868\u793a\u5f02\u6b65\u8ba1\u7b97\u7684\u7ed3\u679c\uff0c\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u5224\u65ad\u4efb\u52a1\u662f\u5426\u5b8c\u6210\u3001\u4e2d\u65ad\u4efb\u52a1\u3001\u83b7\u53d6\u4efb\u52a1\u6267\u884c\u7ed3\u679c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface Future<V> {\n\n    boolean cancel(boolean mayInterruptIfRunning);\n\n    boolean isCancelled();\n\n    boolean isDone();\n\n    V get() throws InterruptedException, ExecutionException;\n\n    V get(long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n}\n")),(0,l.kt)("h2",{id:"futuretask\u5b9e\u73b0\u4e86future\u63a5\u53e3"},"FutureTask\u5b9e\u73b0\u4e86Future\u63a5\u53e3"),(0,l.kt)("p",null,"\u53ef\u53d6\u6d88\u7684\u5f02\u6b65\u8ba1\u7b97\uff0c\u6b64\u7c7b\u63d0\u4f9b\u4e86\u5bf9Future\u7684\u57fa\u672c\u5b9e\u73b0\uff0c\u4ec5\u5728\u8ba1\u7b97\u5b8c\u6210\u65f6\u624d\u80fd\u83b7\u53d6\u7ed3\u679c\uff0c\u5982\u679c\u8ba1\u7b97\u5c1a\u672a\u5b8c\u6210\uff0c\u5219\u963b\u585eget\u65b9\u6cd5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class FutureTask<V> implements RunnableFuture<V>\npublic interface RunnableFuture<V> extends Runnable, Future<V>\n")),(0,l.kt)("p",null,"FutureTask\u4e0d\u4ec5\u5b9e\u73b0\u4e86Future\u63a5\u53e3\uff0c\u8fd8\u5b9e\u73b0\u4e86Runnable\u63a5\u53e3\uff0c\u6240\u4ee5\u4e0d\u4ec5\u53ef\u4ee5\u5c06FutureTask\u5f53\u6210\u4e00\u4e2a\u4efb\u52a1\u4ea4\u7ed9Executor\u6765\u6267\u884c\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7Thread\u6765\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u3002"),(0,l.kt)("h2",{id:"callable\u4e0efuturetask"},"Callable\u4e0eFutureTask"),(0,l.kt)("p",null,"\u901a\u8fc7\u8c03\u7528FutureTask\u7684\u72b6\u6001\u8bbe\u7f6e\u7684\u65b9\u6cd5\uff0c\u6f14\u793a\u4e86\u72b6\u6001\u7684\u53d8\u8fc1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class MyCallableTask implements Callable<Integer>\n{\n    @Override\n     public Integer call() throws Exception\n     {\n        System.out.println("callable do somothing");\n        Thread.sleep(5000);\n        return new Random().nextInt(100);\n        }\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'\npublic class CallableTest\n {\n     public static void main(String[] args) throws Exception\n     {\n         Callable<Integer> callable = new MyCallableTask();\n         FutureTask<Integer> future = new FutureTask<Integer>(callable);\n         Thread thread = new Thread(future);\n         thread.start();\n         Thread.sleep(100);\n         //\u5c1d\u8bd5\u53d6\u6d88\u5bf9\u6b64\u4efb\u52a1\u7684\u6267\u884c,\u5c1d\u8bd5\u53d6\u6d88\u5bf9\u4efb\u52a1\u7684\u6267\u884c\uff0c\u8be5\u65b9\u6cd5\u5982\u679c\u7531\u4e8e\u4efb\u52a1\u5df2\u5b8c\u6210\u3001\u5df2\u53d6\u6d88\u5219\u8fd4\u56defalse\uff0c\u5982\u679c\u80fd\u591f\u53d6\u6d88\u8fd8\u672a\u5b8c\u6210\u7684\u4efb\u52a1\uff0c\u5219\u8fd4\u56detrue\uff0c\u8be5DEMO\u4e2d\u7531\u4e8e\u4efb\u52a1\u8fd8\u5728\u4f11\u7720\u72b6\u6001\uff0c\u6240\u4ee5\u53ef\u4ee5\u53d6\u6d88\u6210\u529f\u3002\n         future.cancel(true);\n         //\u5224\u65ad\u4efb\u52a1\u53d6\u6d88\u662f\u5426\u6210\u529f\uff1a\u5982\u679c\u5728\u4efb\u52a1\u6b63\u5e38\u5b8c\u6210\u524d\u5c06\u5176\u53d6\u6d88\uff0c\u5219\u8fd4\u56detrue\n         System.out.println("future is cancel:" + future.isCancelled());\n         if(!future.isCancelled())\n         {\n            System.out.println("future is cancelled");\n         }\n         //\u5224\u65ad\u4efb\u52a1\u662f\u5426\u5b8c\u6210\uff1a\u5982\u679c\u4efb\u52a1\u5b8c\u6210\uff0c\u5219\u8fd4\u56detrue\uff0c\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\u90fd\u5c5e\u4e8e\u4efb\u52a1\u5b8c\u6210\uff1a\u6b63\u5e38\u7ec8\u6b62\u3001\u5f02\u5e38\u6216\u8005\u53d6\u6d88\u800c\u5b8c\u6210\u3002\u6211\u4eec\u7684DEMO\u4e2d\uff0c\u4efb\u52a1\u662f\u7531\u4e8e\u53d6\u6d88\u800c\u5bfc\u81f4\u5b8c\u6210\n         System.out.println("future is done:" + future.isDone());\n         if(!future.isDone())\n         {\n             //\u83b7\u53d6\u5f02\u6b65\u7ebf\u7a0b\u6267\u884c\u7684\u7ed3\u679c\uff0c\u6211\u8fd9\u4e2aDEMO\u4e2d\u6ca1\u6709\u6267\u884c\u5230\u8fd9\u91cc\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cfuture.get\u65b9\u6cd5\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c \u76f4\u5230\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u8fd4\u56de\u7ed3\u679c\u4e3a\u6b62\n            System.out.println("future get=" + future.get());\n         }else{\n             //\u4efb\u52a1\u5df2\u5b8c\u6210\n             System.out.println("task is done");\n         }\n     }\n }\n')),(0,l.kt)("p",null,"\u6267\u884c\u7ed3\u679c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"callable do somothing\nfuture is cancel:true\nfuture is done:true\ntask is done\n")),(0,l.kt)("h2",{id:"callable\u4e0efuture"},"Callable\u4e0eFuture"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class CallableThread  implements Callable<String>{\n    @Override\n    public String call() throws Exception{\n        System.out.println("\u8fdb\u5165Call\u65b9\u6cd5\uff0c\u5f00\u59cb\u4f11\u7720\uff0c\u4f11\u7720\u65f6\u95f4\u4e3a\uff1a" +\n                System.currentTimeMillis());\n        Thread.sleep(10000);\n        return "\u4eca\u5929\u505c\u7535";\n    }\n    public static void main(String[] args) throws Exception{\n        ExecutorService es = Executors.newSingleThreadExecutor();\n        Callable<String> call = new CallableThread();\n        Future<String> fu = es.submit(call);\n        es.shutdown();\n        Thread.sleep(5000);\n        System.out.println("\u4e3b\u7ebf\u7a0b\u4f11\u77205\u79d2\uff0c\u5f53\u524d\u65f6\u95f4" + System.currentTimeMillis());\n        String str = fu.get();\n        System.out.println("Future\u5df2\u62ff\u5230\u6570\u636e\uff0cstr=" + str + ";\u5f53\u524d\u65f6\u95f4\u4e3a\uff1a" +\n                System.currentTimeMillis());\n    }\n\n}\n')),(0,l.kt)("p",null,"\u6267\u884c\u7ed3\u679c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"\u8fdb\u5165Call\u65b9\u6cd5\uff0c\u5f00\u59cb\u4f11\u7720\uff0c\u4f11\u7720\u65f6\u95f4\u4e3a\uff1a1647855113947\n\u4e3b\u7ebf\u7a0b\u4f11\u77205\u79d2\uff0c\u5f53\u524d\u65f6\u95f41647855118948\nFuture\u5df2\u62ff\u5230\u6570\u636e\uff0cstr=\u4eca\u5929\u505c\u7535;\u5f53\u524d\u65f6\u95f4\u4e3a\uff1a1647855123948\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u7684future\u662f\u76f4\u63a5\u6254\u5230\u7ebf\u7a0b\u6c60\u91cc\u9762\u53bb\u6267\u884c\u7684\u3002\u7531\u4e8e\u8981\u6253\u5370\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\uff0c\u6240\u4ee5\u4ece\u6267\u884c\u7ed3\u679c\u6765\u770b\uff0c\u4e3b\u7ebf\u7a0b\u867d\u7136\u4f11\u7720\u4e865s\uff0c\u4f46\u662f\u4eceCall\u65b9\u6cd5\u6267\u884c\u5230\u62ff\u5230\u4efb\u52a1\u7684\u7ed3\u679c\uff0c\u8fd9\u4e2d\u95f4\u7684\u65f6\u95f4\u5dee\u6b63\u597d\u662f10s\uff0c\u8bf4\u660eget\u65b9\u6cd5\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u76f4\u5230\u4efb\u52a1\u5b8c\u6210\u3002"),(0,l.kt)("p",null,"\u901a\u8fc7FutureTask\u4e5f\u53ef\u4ee5\u8fbe\u5230\u540c\u6837\u6548\u679c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class CallableThread implements Callable<String> {\n    @Override\n    public String call() throws Exception {\n        System.out.println("\u8fdb\u5165Call\u65b9\u6cd5\uff0c\u5f00\u59cb\u4f11\u7720\uff0c\u4f11\u7720\u65f6\u95f4\u4e3a\uff1a" +\n                System.currentTimeMillis());\n        Thread.sleep(10000);\n        return "\u4eca\u5929\u505c\u7535";\n    }\n\n    public static void main(String[] args) throws Exception {\n        ExecutorService es = Executors.newSingleThreadExecutor();\n        Callable<String> call = new CallableThread();\n        FutureTask<String> task = new FutureTask<String>(call);\n        es.submit(task);\n        es.shutdown();\n        Thread.sleep(5000);\n        System.out.println("\u4e3b\u7ebf\u7a0b\u7b49\u5f855\u79d2\uff0c\u5f53\u524d\u65f6\u95f4\u4e3a\uff1a" + System.currentTimeMillis());\n        String str = task.get();\n        System.out.println("Future\u5df2\u62ff\u5230\u6570\u636e\uff0cstr=" + str + ";\u5f53\u524d\u65f6\u95f4\u4e3a\uff1a" +\n                System.currentTimeMillis());\n    }\n}\n')),(0,l.kt)("p",null,"\u4ee5\u4e0a\u7684\u7ec4\u5408\u53ef\u4ee5\u7ed9\u6211\u4eec\u5e26\u6765\u8fd9\u6837\u7684\u4e00\u4e9b\u53d8\u5316\uff1a\n\u5982\u6709\u4e00\u79cd\u573a\u666f\u4e2d\uff0c\u65b9\u6cd5A\u8fd4\u56de\u4e00\u4e2a\u6570\u636e\u9700\u898110s,A\u65b9\u6cd5\u540e\u9762\u7684\u4ee3\u7801\u8fd0\u884c\u9700\u898120s\uff0c\u4f46\u662f\u8fd920s\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u6709\u540e\u976210s\u4f9d\u8d56\u4e8e\u65b9\u6cd5A\u6267\u884c\u7684\u7ed3\u679c\u3002\u5982\u679c\u4e0e\u4ee5\u5f80\u4e00\u6837\u91c7\u7528\u540c\u6b65\u7684\u65b9\u5f0f\uff0c\u52bf\u5fc5\u4f1a\u670910s\u7684\u65f6\u95f4\u88ab\u6d6a\u8d39\uff0c\u5982\u679c\u91c7\u7528\u524d\u9762\u4e24\u79cd\u7ec4\u5408\uff0c\u5219\u6548\u7387\u4f1a\u63d0\u9ad8\uff1a\n1\u3001\u5148\u628aA\u65b9\u6cd5\u7684\u5185\u5bb9\u653e\u5230Callable\u5b9e\u73b0\u7c7b\u7684call()\u65b9\u6cd5\u4e2d\n2\u3001\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u901a\u8fc7\u7ebf\u7a0b\u6c60\u6267\u884cA\u4efb\u52a1\n3\u3001\u6267\u884c\u540e\u9762\u65b9\u6cd5\u4e2d10\u79d2\u4e0d\u4f9d\u8d56\u65b9\u6cd5A\u8fd0\u884c\u7ed3\u679c\u7684\u4ee3\u7801\n4\u3001\u83b7\u53d6\u65b9\u6cd5A\u7684\u8fd0\u884c\u7ed3\u679c\uff0c\u6267\u884c\u540e\u9762\u65b9\u6cd5\u4e2d10\u79d2\u4f9d\u8d56\u65b9\u6cd5A\u8fd0\u884c\u7ed3\u679c\u7684\u4ee3\u7801\n\u8fd9\u6837\u4ee3\u7801\u6267\u884c\u6548\u7387\u4e00\u4e0b\u5b50\u5c31\u63d0\u9ad8\u4e86\uff0c\u7a0b\u5e8f\u4e0d\u5fc5\u5361\u5728A\u65b9\u6cd5\u5904\u3002"),(0,l.kt)("h1",{id:"java\u591a\u7ebf\u7a0b\u5b89\u5168\u673a\u5236"},"java\u591a\u7ebf\u7a0b\u5b89\u5168\u673a\u5236"),(0,l.kt)("p",null,"\u7ebf\u7a0b\u5b89\u5168\u7684\u5b9a\u4e49\u5c31\u662f\uff1a\u5982\u679c\u7ebf\u7a0b\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u4ea7\u751f\u5171\u4eab\u8d44\u6e90\u7684\u51b2\u7a81\u5c31\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,l.kt)("h2",{id:"\u4e92\u65a5\u540c\u6b65\u9501\u60b2\u89c2\u9501"},"\u4e92\u65a5\u540c\u6b65\u9501\uff08\u60b2\u89c2\u9501\uff09"),(0,l.kt)("p",null,"1\uff09Synchorized\uff0c\u7531\u8bed\u8a00\u7ea7\u522b\u5b9e\u73b0\u7684\u4e92\u65a5\u540c\u6b65\u9501\n2\uff09ReentrantLock\uff0c\u662fAPI\u5c42\u9762\u7684\u4e92\u65a5\u540c\u6b65\u9501\uff0c\u9700\u8981\u7a0b\u5e8f\u81ea\u5df1\u6253\u5f00\u5e76\u5728finally\u4e2d\u5173\u95ed\u9501"),(0,l.kt)("p",null,"ReentrantLock\u4f60",(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\u66f4\u52a0\u7075\u6d3b\u4f53\u73b0\u5728\u4e09\u4e2a\u65b9\u9762\uff0c\u7b49\u5f85\u53ef\u4e2d\u65ad\uff0c\u516c\u5e73\u9501\u4ee5\u53ca\u7ed1\u5b9a\u591a\u4e2a\u6761\u4ef6"),(0,l.kt)("p",null,"\u200b\t\t\u4e92\u65a5\u540c\u6b65\u9501\u5c31\u662f\u4ee5\u4e92\u65a5\u7684\u624b\u6bb5\u8fbe\u5230\u987a\u5e8f\u8bbf\u95ee\u7684\u76ee\u7684\u3002\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u5f88\u591a\u4e92\u65a5\u673a\u5236\u6bd4\u5982\u4fe1\u53f7\u91cf\uff0c\u4e92\u65a5\u91cf\uff0c\u4e34\u754c\u533a\u8d44\u6e90\u7b49\u6765\u63a7\u5236\u5728\u67d0\u4e00\u4e2a\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u6216\u8005\u4e00\u7ec4\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u8d44\u6e90\u3002\u4e92\u65a5\u540c\u6b65\u9501\u90fd\u662f\u53ef\u91cd\u5165\u9501\uff0c\u597d\u5904\u662f\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u4f1a\u6b7b\u9501\u3002\u4f46\u662f\u56e0\u4e3a\u6d89\u53ca\u5230\u6838\u5fc3\u6001\u548c\u7528\u6237\u6001\u7684\u5207\u6362\uff0c\u56e0\u6b64\u6bd4\u8f83\u6d88\u8017\u6027\u80fd\u3002"),(0,l.kt)("h2",{id:"\u975e\u963b\u585e\u540c\u6b65\u9501"},"\u975e\u963b\u585e\u540c\u6b65\u9501"),(0,l.kt)("p",null,"\u539f\u5b50\u7c7b\uff08CAS\uff09\uff1a\n\u975e\u963b\u585e\u540c\u6b65\u9501\u4e5f\u53eb\u4e50\u89c2\u9501\uff0c\u76f8\u6bd4\u60b2\u89c2\u9501\u6765\u8bf4\uff0c\u5b83\u4f1a\u5148\u8fdb\u884c\u8d44\u6e90\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u66f4\u65b0\uff0c\u7136\u540e\u6839\u636e\u4e0e\u4e3b\u5b58\u4e2d\u65e7\u503c\u7684\u5bf9\u6bd4\u6765\u786e\u5b9a\u5728\u6b64\u671f\u95f4\u662f\u5426\u6709\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u5171\u4eab\u8d44\u6e90\u8fdb\u884c\u4e86\u66f4\u65b0\uff0c\u5982\u679c\u65e7\u503c\u4e0e\u671f\u671b\u503c\u76f8\u540c\uff0c\u5c31\u8ba4\u4e3a\u6ca1\u6709\u66f4\u65b0\uff0c\u53ef\u4ee5\u628a\u65b0\u503c\u5199\u56de\u5185\u5b58\uff0c\u5426\u5219\u5c31\u4e00\u76f4\u91cd\u8bd5\u76f4\u5230\u6210\u529f\u3002\u5b83\u7684\u5b9e\u73b0\u65b9\u5f0f\u4f9d\u8d56\u4e8e\u5904\u7406\u5668\u7684\u673a\u5668\u6307\u4ee4\uff1aCAS\uff08Compare And Swap\uff09"),(0,l.kt)("p",null,"\u975e\u963b\u585e\u9501\u662f\u4e0d\u53ef\u91cd\u5165\u7684\uff0c\u5426\u5219\u4f1a\u9020\u6210\u6b7b\u9501\u3002"),(0,l.kt)("h2",{id:"\u65e0\u540c\u6b65\u65b9\u6848"},"\u65e0\u540c\u6b65\u65b9\u6848"),(0,l.kt)("p",null,"1\uff09\u53ef\u91cd\u5165\u4ee3\u7801\n\u5728\u6267\u884c\u7684\u4efb\u4f55\u65f6\u523b\u90fd\u53ef\u4ee5\u4e2d\u65ad-\u91cd\u5165\u6267\u884c\u800c\u4e0d\u4f1a\u4ea7\u751f\u51b2\u7a81\u3002\u7279\u70b9\u5c31\u662f\u4e0d\u4f1a\u4f9d\u8d56\u5806\u4e0a\u7684\u5171\u4eab\u8d44\u6e90\n2\uff09ThreadLocal/Volaitile\n\u7ebf\u7a0b\u672c\u5730\u7684\u53d8\u91cf\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e00\u4efd\u5171\u4eab\u53d8\u91cf\u7684\u62f7\u8d1d\uff0c\u5355\u72ec\u8fdb\u884c\u5904\u7406\u3002"),(0,l.kt)("p",null,"3\uff09\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\n\u5982\u679c\u4e00\u4e2a\u5171\u4eab\u8d44\u6e90\u4e00\u5b9a\u8981\u88ab\u591a\u7ebf\u7a0b\u5171\u4eab\uff0c\u53ef\u4ee5\u5c3d\u91cf\u8ba9\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u6240\u6709\u7684\u5904\u7406\u64cd\u4f5c\uff0c\u6bd4\u5982\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u5f0f\u4e2d\uff0c\u4e00\u822c\u4f1a\u8ba9\u4e00\u4e2a\u6d88\u8d39\u8005\u5b8c\u6210\u5bf9\u961f\u5217\u4e0a\u8d44\u6e90\u7684\u6d88\u8d39\u3002\u5178\u578b\u7684\u5e94\u7528\u662f\u57fa\u4e8e\u8bf7\u6c42-\u5e94\u7b54\u6a21\u5f0f\u7684web\u670d\u52a1\u5668\u7684\u8bbe\u8ba1"),(0,l.kt)("h1",{id:"volatile\u539f\u7406\u53ca\u4f7f\u7528\u573a\u666f"},"Volatile\u539f\u7406\u53ca\u4f7f\u7528\u573a\u666f"),(0,l.kt)("h2",{id:"volatile\u539f\u7406"},"Volatile\u539f\u7406"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u53d8\u91cf\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\uff0cJVM \u4f1a\u5411\u5904\u7406\u5668\u53d1\u9001\u4e00\u6761 Lock \u524d\u7f00\u7684\u6307\u4ee4\uff0c\u5c06\u8fd9\u4e2a\u53d8\u91cf\u6240\u5728\u7f13\u5b58\u884c\u7684\u6570\u636e\u5199\u4f1a\u5230\u7cfb\u7edf\u5185\u5b58\u3002\nLock \u524d\u7f00\u6307\u4ee4\u5b9e\u9645\u4e0a\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5185\u5b58\u5c4f\u969c\uff08\u4e5f\u6210\u5185\u5b58\u6805\u680f\uff09\uff0c\u5b83\u786e\u4fdd\u6307\u4ee4\u91cd\u6392\u5e8f\u65f6\u4e0d\u4f1a\u628a\u5176 \u540e\u9762\u7684\u6307\u4ee4\u6392\u5230\u5185\u5b58\u5c4f\u969c\u4e4b\u524d\u7684\u4f4d\u7f6e\uff0c\u4e5f\u4e0d\u4f1a\u628a\u524d\u9762\u7684\u6307\u4ee4\u6392\u5230\u5185\u5b58\u5c4f\u969c\u7684\u540e\u9762\uff1b\u5373\u5728\u6267\u884c\u5230\u5185 \u5b58\u5c4f\u969c\u8fd9\u53e5\u6307\u4ee4\u65f6\uff0c\u5728\u5b83\u524d\u9762\u7684\u64cd\u4f5c\u5df2\u7ecf\u5168\u90e8\u5b8c\u6210\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220321194359566.png?raw=true",alt:"image-20220321194359566"})),(0,l.kt)("h2",{id:"volatile\u9002\u7528\u573a\u666f"},"Volatile\u9002\u7528\u573a\u666f"),(0,l.kt)("h3",{id:"\u72b6\u6001\u6807\u5fd7"},"\u72b6\u6001\u6807\u5fd7"),(0,l.kt)("p",null,"\u200b\t\t\u7528\u4e8e\u6307\u793a\u53d1\u751f\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u4e00\u6b21\u6027\u4e8b\u4ef6\uff0c\u4f8b\u5982\u5b8c\u6210\u521d\u59cb\u5316\u6216\u8bf7\u6c42\u505c\u673a\u3002\u7ebf\u7a0b1\u6267\u884cdoWork()\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u6709\u53e6\u5916\u7684\u7ebf\u7a0b2\u8c03\u7528\u4e86shutdown\uff0c\u6240\u4ee5boolean\u53d8\u91cf\u5fc5\u987b\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"`volatile` boolean shutdownRequested;\n\n...\n\n public void shutdown() {\n    shutdownRequested = true;\n }\n\n public void doWork() {\n     while (!shutdownRequested) {\n    // do stuff\n     }\n}\n")),(0,l.kt)("p",null,"\u200b\t\t\u8fd9\u79cd\u7c7b\u578b\u7684\u72b6\u6001\u6807\u8bb0\u7684\u4e00\u4e2a\u516c\u5171\u7279\u6027\u662f\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u901a\u5e38\u53ea\u6709\u4e00\u79cd\u72b6\u6001\u8f6c\u6362"),"\uff1b shutdownRequested \u6807\u5fd7\u4ece false\u8f6c\u6362\u4e3a true \uff0c\u7136\u540e\u7a0b\u5e8f\u505c\u6b62\u3002\u8fd9\u79cd\u6a21\u5f0f\u53ef\u4ee5\u6269\u5c55\u5230\u6765\u56de\u8f6c\u6362\u7684\u72b6\u6001\u6807\u5fd7\uff0c\u4f46\u662f\u53ea\u6709\u5728\u8f6c\u6362\u5468\u671f\u4e0d\u88ab\u5bdf\u89c9\u7684\u60c5\u51b5\u4e0b\u624d\u80fd\u6269\u5c55\uff08\u4ece false \u5230 true \uff0c\u518d\u8f6c\u6362\u5230 false \uff09\u3002\u6b64\u5916\uff0c\u8fd8\u9700\u8981\u67d0\u4e9b\u539f\u5b50\u72b6\u6001\u8f6c\u6362\u673a\u5236\uff0c\u4f8b\u5982\u539f\u5b50\u53d8\u91cf\u3002"),(0,l.kt)("h3",{id:"\u4e00\u6b21\u6027\u5b89\u5168\u53d1\u5e03one-time-safe-publication"},"\u4e00\u6b21\u6027\u5b89\u5168\u53d1\u5e03\uff08one-time safe publication\uff09"),(0,l.kt)("p",null,"\u200b\t\t\u5728\u7f3a\u4e4f\u540c\u6b65\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u67d0\u4e2a\u5bf9\u8c61\u5f15\u7528\u7684\u66f4\u65b0\u503c\uff08\u7531\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5199\u5165\uff09\u548c\u8be5\u5bf9\u8c61\u72b6\u6001\u7684\u65e7\u503c\u540c\u65f6\u5b58\u5728\u3002\n\u200b\t\t\u8fd9\u5c31\u662f\u9020\u6210\u8457\u540d\u7684\u53cc\u91cd\u68c0\u67e5\u9501\u5b9a\uff08double-checked-locking\uff09\u95ee\u9898\u7684\u6839\u6e90\uff0c\u5176\u4e2d\u5bf9\u8c61\u5f15\u7528\u5728\u6ca1\u6709\u540c\u6b65\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u8bfb\u64cd\u4f5c\uff0c\u4ea7\u751f\u7684\u95ee\u9898\u662f\u60a8\u53ef\u80fd\u4f1a\u770b\u5230\u4e00\u4e2a\u66f4\u65b0\u7684\u5f15\u7528\uff0c\u4f46\u662f\u4ecd\u7136\u4f1a\u901a\u8fc7\u8be5\u5f15\u7528\u770b\u5230\u4e0d\u5b8c\u5168\u6784\u9020\u7684\u5bf9\u8c61\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u6ce8\u610f`volatile`\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\uff01\nprivate `volatile` static Singleton instace;\n\npublic static Singleton getInstance(){\n        //\u7b2c\u4e00\u6b21null\u68c0\u67e5\n        if(instance == null){\n             `synchronized`(Singleton.class) { //1\n                //\u7b2c\u4e8c\u6b21null\u68c0\u67e5\n                 if(instance == null){ //2\n                    instance = new Singleton();//3\n                }\n            }\n        }\n    return instance;\n}\n")),(0,l.kt)("p",null,"\u5982\u679c\u4e0d\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\uff0c\u5219\u56e0\u4e3a\u5185\u5b58\u6a21\u578b\u5141\u8bb8\u6240\u8c13\u7684\u201c\u65e0\u5e8f\u5199\u5165\u201d\uff0c\u53ef\u80fd\u5bfc\u81f4\u5931\u8d25\u3002\u2014\u2014",(0,l.kt)("strong",{parentName:"p"},"\u67d0\u4e2a\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u83b7\u5f97\u4e00\u4e2a\u672a\u5b8c\u5168\u521d\u59cb\u5316\u7684\u5b9e\u4f8b\u3002")),(0,l.kt)("p",null,"\u8003\u5bdf\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684 //3 \u884c\u3002\u6b64\u884c\u4ee3\u7801\u521b\u5efa\u4e86\u4e00\u4e2a Singleton \u5bf9\u8c61\u5e76\u521d\u59cb\u5316\u53d8\u91cf instance \u6765\u5f15\u7528\u6b64\u5bf9\u8c61\u3002\u8fd9\u884c\u4ee3\u7801\u7684\u95ee\u9898\u662f\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u5728Singleton \u6784\u9020\u51fd\u6570\u4f53\u6267\u884c\u4e4b\u524d\uff0c\u53d8\u91cfinstance \u53ef\u80fd\u6210\u4e3a\u975e null \u7684\uff01")),(0,l.kt)("p",null,"\u5047\u8bbe\u4e0a\u8ff0\u4ee3\u7801\u6267\u884c\u4ee5\u4e0b\u4e8b\u4ef6\u5e8f\u5217\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b 1 \u8fdb\u5165 getInstance() \u65b9\u6cd5\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7531\u4e8e instance \u4e3a null\uff0c\u7ebf\u7a0b 1 \u5728 //1 \u5904\u8fdb\u5165",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized")," \u5757\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b 1 \u524d\u8fdb\u5230 //3 \u5904\uff0c\u4f46\u5728\u6784\u9020\u51fd\u6570\u6267\u884c\u4e4b\u524d\uff0c\u4f7f\u5b9e\u4f8b\u6210\u4e3a\u975enull\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b 1 \u88ab\u7ebf\u7a0b 2 \u9884\u5360\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b 2 \u68c0\u67e5\u5b9e\u4f8b\u662f\u5426\u4e3a null\u3002\u56e0\u4e3a\u5b9e\u4f8b\u4e0d\u4e3a null\uff0c\u7ebf\u7a0b 2 \u5c06instance \u5f15\u7528\u8fd4\u56de\uff0c\u8fd4\u56de\u4e00\u4e2a\u6784\u9020\u5b8c\n\u6574\u4f46\u90e8\u5206\u521d\u59cb\u5316\u4e86\u7684Singleton \u5bf9\u8c61\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b 2 \u88ab\u7ebf\u7a0b 1 \u9884\u5360\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b 1 \u901a\u8fc7\u8fd0\u884c Singleton \u5bf9\u8c61\u7684\u6784\u9020\u51fd\u6570\u5e76\u5c06\u5f15\u7528\u8fd4\u56de\u7ed9\u5b83\uff0c\u6765\u5b8c\u6210\u5bf9\u8be5\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u3002")),(0,l.kt)("h3",{id:"\u72ec\u7acb\u89c2\u5bdfindependent-observation"},"\u72ec\u7acb\u89c2\u5bdf\uff08independent observation\uff09"),(0,l.kt)("p",null,"\u200b\t\t\u5b89\u5168\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u7684\u53e6\u4e00\u79cd\u7b80\u5355\u6a21\u5f0f\u662f\uff1a\u5b9a\u671f \u201c\u53d1\u5e03\u201d \u89c2\u5bdf\u7ed3\u679c\u4f9b\u7a0b\u5e8f\u5185\u90e8\u4f7f\u7528\u3002\u3010\u4f8b\u5982\u3011\u5047\u8bbe\u6709\u4e00\u79cd\u73af\u5883\u4f20\u611f\u5668\u80fd\u591f\u611f\u89c9\u73af\u5883\u6e29\u5ea6\u3002\u4e00\u4e2a\u540e\u53f0\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u6bcf\u9694\u51e0\u79d2\u8bfb\u53d6\u4e00\u6b21\u8be5\u4f20\u611f\u5668\uff0c\u5e76\u66f4\u65b0\u5305\u542b\u5f53\u524d\u6587\u6863\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u53d8\u91cf\u3002\u7136\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u8bfb\u53d6\u8fd9\u4e2a\u53d8\u91cf\uff0c\u4ece\u800c\u968f\u65f6\u80fd\u591f\u770b\u5230\u6700\u65b0\u7684\u6e29\u5ea6\u503c\u3002\n\u200b\t\t\u4f7f\u7528\u8be5\u6a21\u5f0f\u7684\u53e6\u4e00\u79cd\u5e94\u7528\u7a0b\u5e8f\u5c31\u662f\u6536\u96c6\u7a0b\u5e8f\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\u3010\u4f8b\u3011\u5982\u4e0b\u4ee3\u7801\u5c55\u793a\u4e86\u8eab\u4efd\u9a8c\u8bc1\u673a\u5236\u5982\u4f55\u8bb0\u5fc6\u6700\u8fd1\u4e00\u6b21\u767b\u5f55\u7684\u7528\u6237\u7684\u540d\u5b57\u3002\u5c06\u53cd\u590d\u4f7f\u7528 lastUser \u5f15\u7528\u6765\u53d1\u5e03\u503c\uff0c\u4ee5\u4f9b\u7a0b\u5e8f\u7684\u5176\u4ed6\u90e8\u5206\u4f7f\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class UserManager {\n    public `volatile` String lastUser; //\u53d1\u5e03\u7684\u4fe1\u606f\n\n    public boolean authenticate(String user, String password) {\n         boolean valid = passwordIsValid(user, password);\n         if (valid) {\n             User u = new User();\n             activeUsers.add(u);\n             lastUser = user;\n         }\n        return valid;\n    }\n}\n")),(0,l.kt)("h3",{id:"volatile-bean-\u6a21\u5f0f"},"\u201cvolatile bean\u201d \u6a21\u5f0f"),(0,l.kt)("p",null,"\u200b\t\t",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," bean \u6a21\u5f0f\u7684\u57fa\u672c\u539f\u7406\u662f\uff1a\u5f88\u591a\u6846\u67b6\u4e3a\u6613\u53d8\u6570\u636e\u7684\u6301\u6709\u8005\uff08\u4f8b\u5982 HttpSession \uff09\u63d0\u4f9b\u4e86\u5bb9\u5668\uff0c\u4f46\u662f\u653e\u5165\u8fd9\u4e9b\u5bb9\u5668\u4e2d\u7684\u5bf9\u8c61\u5fc5\u987b\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,l.kt)("p",null,"\u200b\t\t\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," bean \u6a21\u5f0f\u4e2d\uff0cJavaBean \u7684\u6240\u6709\u6570\u636e\u6210\u5458\u90fd\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u7c7b\u578b\u7684\uff0c\u5e76\u4e14 getter \u548c setter \u65b9\u6cd5\u5fc5\u987b\u975e\u5e38\u666e\u901a\u2014\u2014\u5373\u4e0d\u5305\u542b\u7ea6\u675f\uff01"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class Person {\n    private `volatile` String firstname;\n    private `volatile` String lastname;\n    private `volatile` int age;\n\n    public String getFirstname() {\n        return firstname;\n    }\n\n    public void setFirstname(String firstname) {\n        this.firstname = firstname;\n    }\n\n    public String getLastname() {\n        return lastname;\n    }\n\n    public void setLastname(String lastname) {\n        this.lastname = lastname;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n}\n")),(0,l.kt)("h3",{id:"\u5f00\u9500\u8f83\u4f4e\u7684\u8bfb\u5199\u9501\u7b56\u7565"},"\u5f00\u9500\u8f83\u4f4e\u7684\u201c\u8bfb\uff0d\u5199\u9501\u201d\u7b56\u7565"),(0,l.kt)("p",null,"\u5982\u679c\u8bfb\u64cd\u4f5c\u8fdc\u8fdc\u8d85\u8fc7\u5199\u64cd\u4f5c\uff0c\u60a8\u53ef\u4ee5\u7ed3\u5408\u4f7f\u7528\u5185\u90e8\u9501\u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u53d8\u91cf\u6765\u51cf\u5c11\u516c\u5171\u4ee3\u7801\u8def\u5f84\u7684\u5f00\u9500\u3002"),(0,l.kt)("p",null,"\u5982\u4e0b\u663e\u793a\u7684\u7ebf\u7a0b\u5b89\u5168\u7684\u8ba1\u6570\u5668\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"synchronized")," \u786e\u4fdd\u589e\u91cf\u64cd\u4f5c\u662f\u539f\u5b50\u7684\uff0c\u5e76\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u4fdd\u8bc1\u5f53\u524d\u7ed3\u679c\u7684\u53ef\u89c1\u6027\u3002\u5982\u679c\u66f4\u65b0\u4e0d\u9891\u7e41\u7684\u8bdd\uff0c\u8be5\u65b9\u6cd5\u53ef\u5b9e\u73b0\u66f4\u597d\u7684\u6027\u80fd\uff0c\u56e0\u4e3a\u8bfb\u8def\u5f84\u7684\u5f00\u9500\u4ec5\u4ec5\u6d89\u53ca",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u8bfb\u64cd\u4f5c\uff0c\u8fd9\u901a\u5e38\u8981\u4f18\u4e8e\u4e00\u4e2a\u65e0\u7ade\u4e89\u7684\u9501\u83b7\u53d6\u7684\u5f00\u9500\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class CheesyCounter {\n\n    @GuardedBy("this") private `volatile` int value;\n\n    //\u8bfb\u64cd\u4f5c\uff0c\u6ca1\u6709`synchronized`\uff0c\u63d0\u9ad8\u6027\u80fd\n    public int getValue(){\n        return value;\n    }\n    //\u5199\u64cd\u4f5c\uff0c\u5fc5\u987b`synchronized`\uff0c\u56e0\u4e3avalue++\u4e0d\u662f\u539f\u5b50\u64cd\u4f5c\n    public `synchronized` int increment(){\n        return value++;\n    }\n}\n')),(0,l.kt)("p",null,"\u4f7f\u7528\u9501\u8fdb\u884c\u6240\u6709\u53d8\u5316\u7684\u64cd\u4f5c\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u8fdb\u884c\u53ea\u8bfb\u64cd\u4f5c\u3002\n\u5176\u4e2d\uff0c\u9501\u4e00\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u503c\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"volatile")," \u5141\u8bb8\u591a\u4e2a\u7ebf\u7a0b\u6267\u884c\u8bfb\u64cd\u4f5c"),(0,l.kt)("h1",{id:"threadlocal\u539f\u7406\u53ca\u6e90\u7801\u5206\u6790"},"ThreadLocal\u539f\u7406\u53ca\u6e90\u7801\u5206\u6790"),(0,l.kt)("h2",{id:"threadlocal\u539f\u7406"},"ThreadLocal\u539f\u7406"),(0,l.kt)("p",null,"ThreadLocal\u662f\u7528\u6765\u7ef4\u62a4\u672c\u7ebf\u7a0b\u7684\u53d8\u91cf\u7684\uff0c\u5e76\u4e0d\u80fd\u89e3\u51b3\u5171\u4eab\u53d8\u91cf\u7684\u5e76\u53d1\u95ee\u9898\u3002ThreadLocal\u662f \u5404\u7ebf\u7a0b\u5c06\u503c\u5b58\u5165\u8be5\u7ebf\u7a0b\u7684map\u4e2d\uff0c\u4ee5ThreadLocal\u81ea\u8eab\u4f5c\u4e3akey\uff0c\u9700\u8981\u7528\u65f6\u83b7\u5f97\u7684\u662f\u8be5\u7ebf\u7a0b\u4e4b\u524d \u5b58\u5165\u7684\u503c\u3002\u5982\u679c\u5b58\u5165\u7684\u662f\u5171\u4eab\u53d8\u91cf\uff0c\u90a3\u53d6\u51fa\u7684\u4e5f\u662f\u5171\u4eab\u53d8\u91cf\uff0c\u5e76\u53d1\u95ee\u9898\u8fd8\u662f\u5b58\u5728\u7684\u3002"),(0,l.kt)("p",null,"ThreadLocal\u7684\u9002\u7528\u573a\u666f\n\u573a\u666f\uff1a\u6570\u636e\u5e93\u8fde\u63a5\u3001Session\u7ba1\u7406"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220322130718255.png?raw=true",alt:"image-20220322130718255"})),(0,l.kt)("h2",{id:"threadlocal\u51fa\u73b0oom"},"ThreadLocal\u51fa\u73b0OOM"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocal"),"\u53d8\u91cf\u662f\u7ef4\u62a4\u5728Thread\u5185\u90e8\u7684\uff0c\u8fd9\u6837\u7684\u8bdd\u53ea\u8981\u6211\u4eec\u7684\u7ebf\u7a0b\u4e0d\u9000\u51fa\uff0c\u5bf9\u8c61\u7684\u5f15\u7528\u5c31\u4f1a \u4e00\u76f4\u5b58\u5728\u3002\u5f53\u7ebf\u7a0b\u9000\u51fa\u65f6\uff0cThread\u7c7b\u4f1a\u8fdb\u884c\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff0c\u5176\u4e2d\u5c31\u5305\u542b",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocalMap"),"\uff0c ",(0,l.kt)("inlineCode",{parentName:"p"},"Thread"),"\u8c03\u7528exit\u65b9\u6cd5\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n* This method is called by the system to give a Thread\n* a chance to clean up before it actually exits.\n*/\nprivate void exit() {\n    if (group != null) {\n        group.threadTerminated(this);\n        group = null;\n    }\n    /* Aggressively null out all reference fields: see bug 4006245 */\n    target = null;\n    /* Speed the release of some of these resources */\n    threadLocals = null;\n    inheritableThreadLocals = null;\n    inheritedAccessControlContext = null;\n    blocker = null;\n    uncaughtExceptionHandler = null;\n}\n")),(0,l.kt)("p",null,"ThreadLocal\u5728\u6ca1\u6709\u7ebf\u7a0b\u6c60\u4f7f\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u5b58\u5728\u5185\u5b58\u6cc4\u9732\uff0c\u4f46\u662f\u5982\u679c\u4f7f\u7528\u4e86\u7ebf\u7a0b \u6c60\u7684\u8bdd\uff0c\u5c31\u4f9d\u8d56\u4e8e\u7ebf\u7a0b\u6c60\u7684\u5b9e\u73b0\uff0c\u5982\u679c\u7ebf\u7a0b\u6c60\u4e0d\u9500\u6bc1\u7ebf\u7a0b\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f1a\u5b58\u5728\u5185\u5b58\u6cc4\u9732\u3002"),(0,l.kt)("p",null,"ThreadLocal\u5e76\u4e0d\u662f\u4e00\u4e2aThread\uff0c\u800c\u662fThread\u7684\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\u3002"),(0,l.kt)("p",null,"ThreadLocal \u7684\u4f5c\u7528\u662f\u63d0\u4f9b\u7ebf\u7a0b\u5185\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u8fd9\u79cd\u53d8\u91cf\u5728\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u5185\u8d77\u4f5c\u7528\uff0c\u51cf\u5c11\u540c\u4e00\u4e2a\u7ebf\u7a0b\u5185\u591a\u4e2a\u51fd\u6570\u6216\u8005\u7ec4\u4ef6\u4e4b\u95f4\u4e00\u4e9b\u516c\u5171\u53d8\u91cf\u7684\u4f20\u9012\u7684\u590d\u6742\u5ea6\u3002"),(0,l.kt)("h2",{id:"threadlocal\u5168\u90e8\u65b9\u6cd5\u548c\u5185\u90e8\u7c7b"},"ThreadLocal\u5168\u90e8\u65b9\u6cd5\u548c\u5185\u90e8\u7c7b"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220322132705708.png?raw=true",alt:"image-20220322132705708"})),(0,l.kt)("p",null,"ThreadLocal\u516c\u6709\u65b9\u6cd5\u53ea\u6709\u56db\u4e2a\uff1aget,set,remove,withInitial"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220322132751289.png?raw=true",alt:"image-20220322132751289"})),(0,l.kt)("h2",{id:"threadlocal\u6e90\u7801\u5206\u6790"},"ThreadLocal\u6e90\u7801\u5206\u6790"),(0,l.kt)("h3",{id:"\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u5728thread\u4e2d\u7684\u4f4d\u7f6e"},"\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u5728Thread\u4e2d\u7684\u4f4d\u7f6e"),(0,l.kt)("p",null,"\u65e2\u7136\u662f\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\uff0c\u90a3\u4e48\u7406\u6240\u5f53\u7136\u5c31\u5e94\u8be5\u5b58\u50a8\u5728\u81ea\u5df1\u7684\u7ebf\u7a0b\u5bf9\u8c61\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece Thread \u7684\u6e90\u7801\u4e2d\u627e\u5230\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u5b58\u50a8\u7684\u5730\u65b9\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"publicclass Thread implements Runnable {\n    /* Make sure registerNatives is the first thing <clinit> does. */\n    private static native void registerNatives();\n    static {\n        registerNatives();\n    }\n     /* \u4e0e\u6b64\u7ebf\u7a0b\u76f8\u5173\u7684\u7ebf\u7a0b\u672c\u5730\u503c\u3002\u6b64\u6620\u5c04\u7531 ThreadLocal \u7c7b\u7ef4\u62a4\u3002 */\n    ThreadLocal.ThreadLocalMap threadLocals = null;\n    /*\n     * \u53ef\u7ee7\u627f\u7ebf\u7a0b\u4e0e\u6b64\u7ebf\u7a0b\u76f8\u5173\u7684\u672c\u5730\u503c\u3002\u6b64\u6620\u5c04\u7531 InheritableThreadLocal \u7c7b\u7ef4\u62a4\u3002\n     */\n    ThreadLocal.ThreadLocalMap inheritableThreadLocals = null;\n}\n")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u662f\u5b58\u50a8\u5728Thread\u5bf9\u8c61\u7684 threadLocals \u5c5e\u6027\u4e2d\uff0c\u800c threadLocals \u5c5e\u6027\u662f\u4e00\u4e2a ThreadLocal.ThreadLocalMap \u5bf9\u8c61\u3002ThreadLocalMap\u4e3aThreadLocal\u7684\u9759\u6001\u5185\u90e8\u7c7b:"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220322134019043.png?raw=true",alt:"image-20220322134019043"})),(0,l.kt)("h3",{id:"thread\u4e0ethreadlocalmap\u7684\u5173\u7cfb"},"Thread\u4e0eThreadLocalMap\u7684\u5173\u7cfb"),(0,l.kt)("p",null,"Thread\u548cThreadLocalMap\u7684\u5173\u7cfb\uff0c\u5148\u770b\u4e0b\u8fb9\u8fd9\u4e2a\u7b80\u5355\u7684\u56fe\uff0c\u53ef\u4ee5\u770b\u51faThread\u4e2d\u7684 threadLocals \u5c31\u662fThreadLocal\u4e2d\u7684ThreadLocalMap\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220322134321496.png?raw=true",alt:"image-20220322134321496"})),(0,l.kt)("p",null,"\u5230\u8fd9\u91cc\u5e94\u8be5\u5927\u81f4\u80fd\u591f\u611f\u53d7\u5230\u4e0a\u8ff0\u4e09\u8005\u4e4b\u95f4\u5fae\u5999\u7684\u5173\u7cfb\uff0c\u518d\u770b\u4e00\u4e2a\u590d\u6742\u70b9\u7684\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220322134805446.png?raw=true",alt:"image-20220322134805446"})),(0,l.kt)("p",null,"\u200b\t\t\u53ef\u4ee5\u770b\u51fa\u6bcf\u4e2a thread \u5b9e\u4f8b\u90fd\u6709\u4e00\u4e2a ThreadLocalMap \u3002\u5728\u4e0a\u56fe\u4e2d\u7684\u4e00\u4e2aThread\u7684\u8fd9\u4e2aThreadLocalMap\u4e2d\u5206\u522b\u5b58\u653e\u4e863\u4e2aEntry\uff0c\u9ed8\u8ba4\u4e00\u4e2aThreadLocalMap\u521d\u59cb\u5316\u4e8616\u4e2aEntry\uff0c\u6bcf\u4e00\u4e2aEntry\u5bf9\u8c61\u5b58\u653e\u7684\u662f\u4e00\u4e2aThreadLocal\u53d8\u91cf\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u200b\t\t\u518d\u7b80\u5355\u4e00\u70b9\u7684\u8bf4\u5c31\u662f\uff1a\u4e00\u4e2aThread\u4e2d\u53ea\u6709\u4e00\u4e2aThreadLocalMap\uff0c\u4e00\u4e2aThreadLocalMap\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2aThreadLocal\u5bf9\u8c61\uff0c\u5176\u4e2d\u4e00\u4e2aThreadLocal\u5bf9\u8c61\u5bf9\u5e94\u4e00\u4e2aThreadLocalMap\u4e2d\u7684\u4e00\u4e2aEntry\uff08\u4e5f\u5c31\u662f\u8bf4\uff1a\u4e00\u4e2aThread\u53ef\u4ee5\u4f9d\u9644\u6709\u591a\u4e2aThreadLocal\u5bf9\u8c61\uff09\u3002"),(0,l.kt)("h3",{id:"threadlocalmap\u4e0eweakreference"},"ThreadLocalMap\u4e0eWeakReference"),(0,l.kt)("p",null,"ThreadLocalMap \u4ece\u5b57\u9762\u4e0a\u5c31\u53ef\u4ee5\u770b\u51fa\u8fd9\u662f\u4e00\u4e2a\u4fdd\u5b58 ThreadLocal \u5bf9\u8c61\u7684map(\u5176\u5b9e\u662f\u4ee5ThreadLocal \u5bf9\u8c61\u4e3aKey)\uff0c\u4e0d\u8fc7\u662f\u7ecf\u8fc7\u4e86\u4e24\u5c42\u5305\u88c5\u7684ThreadLocal\u5bf9\u8c61\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7b2c\u4e00\u5c42\u5305\u88c5\u662f\u4f7f\u7528 WeakReference<ThreadLocal<?>> \u5c06 ThreadLocal \u5bf9\u8c61\u53d8\u6210\u4e00\u4e2a\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u7b2c\u4e8c\u5c42\u5305\u88c5\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4e13\u95e8\u7684\u7c7b Entry \u6765\u6269\u5c55 WeakReference<ThreadLocal<?>> \uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'static class ThreadLocalMap {\n\n        /**\n         * The entries in this hash map extend WeakReference, using\n         * its main ref field as the key (which is always a\n         * ThreadLocal object).  Note that null keys (i.e. entry.get()\n         * == null) mean that the key is no longer referenced, so the\n         * entry can be expunged from table.  Such entries are referred to\n         * as "stale entries" in the code that follows.\n         */\n        static class Entry extends WeakReference<ThreadLocal<?>> {\n            /** The value associated with this ThreadLocal. */\n            Object value;\n\n            Entry(ThreadLocal<?> k, Object v) {\n                super(k);\n                value = v;\n            }\n        }\n}\n')),(0,l.kt)("p",null,"\u7c7b Entry \u5f88\u663e\u7136\u662f\u4e00\u4e2a\u4fdd\u5b58map\u952e\u503c\u5bf9\u7684\u5b9e\u4f53\uff0c ThreadLocal<?> \u4e3akey, \u8981\u4fdd\u5b58\u7684\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u7684\u503c\u4e3a"),(0,l.kt)("p",null,"value \u3002 super(k) \u8c03\u7528\u7684 WeakReference \u7684\u6784\u9020\u51fd\u6570\uff0c\u8868\u793a\u5c06 ThreadLocal<?> \u5bf9\u8c61\u8f6c\u6362\u6210\u5f31\u5f15\u7528\u5bf9\u8c61\uff0c\u7528\u505akey"),(0,l.kt)("h3",{id:"threadlocalmap\u7684\u6784\u9020\u51fd\u6570"},"ThreadLocalMap\u7684\u6784\u9020\u51fd\u6570"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class ThreadLocal<T> {\n    ...\n    /**\n             * Construct a new map initially containing (firstKey, firstValue).\n             * ThreadLocalMaps are constructed lazily, so we only create\n             * one when we have at least one entry to put in it.\n             */\n    ThreadLocalMap(ThreadLocal<?> firstKey, Object firstValue) {\n        table = new Entry[INITIAL_CAPACITY];\n        int i = firstKey.threadLocalHashCode & (INITIAL_CAPACITY - 1);\n        table[i] = new Entry(firstKey, firstValue);\n        size = 1;\n        setThreshold(INITIAL_CAPACITY);\n    }\n    ...\n}\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u51fa\uff0cThreadLocalMap\u8fd9\u4e2amap\u7684\u5b9e\u73b0\u662f\u4f7f\u7528\u4e00\u4e2a\u6570\u7ec4 private Entry[] table \u6765\u4fdd\u5b58\u952e\u503c\u5bf9\u7684\u5b9e\u4f53\uff0c\u521d\u59cb\u5927\u5c0f\u4e3a16\uff0c ThreadLocalMap \u81ea\u5df1\u5b9e\u73b0\u4e86\u5982\u4f55\u4ece key \u5230 value \u7684\u6620\u5c04\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"int i = firstKey.threadLocalHashCode & (INITIAL_CAPACITY - 1);\n")),(0,l.kt)("p",null,"\u4f7f\u7528\u4e00\u4e2a static \u7684\u539f\u5b50\u5c5e\u6027 AtomicInteger nextHashCode \uff0c\u901a\u8fc7\u6bcf\u6b21\u589e\u52a0 HASH_INCREMENT =0x61c88647 \uff0c\u7136\u540e & (INITIAL_CAPACITY - 1) \u53d6\u5f97\u5728\u6570\u7ec4 private Entry[] table \u4e2d\u7684\u7d22\u5f15\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class ThreadLocal<T> {\n    /**\n     * ThreadLocals rely on per-thread linear-probe hash maps attached\n     * to each thread (Thread.threadLocals and\n     * inheritableThreadLocals).  The ThreadLocal objects act as keys,\n     * searched via threadLocalHashCode.  This is a custom hash code\n     * (useful only within ThreadLocalMaps) that eliminates collisions\n     * in the common case where consecutively constructed ThreadLocals\n     * are used by the same threads, while remaining well-behaved in\n     * less common cases.\n     */\n    private final int threadLocalHashCode = nextHashCode();\n    /**\n     * The next hash code to be given out. Updated atomically. Starts at\n     * zero.\n     */\n    private static AtomicInteger nextHashCode =\n        new AtomicInteger();\n\n    /**\n     * The difference between successively generated hash codes - turns\n     * implicit sequential thread-local IDs into near-optimally spread\n     * multiplicative hash values for power-of-two-sized tables.\n     */\n    private static final int HASH_INCREMENT = 0x61c88647;\n\n    /**\n     * Returns the next hash code.\n     */\n    private static int nextHashCode() {\n        return nextHashCode.getAndAdd(HASH_INCREMENT);\n    }\n    ...\n}\n")),(0,l.kt)("p",null,"ThreadLocalMap\u662f\u4e00\u4e2a\u7c7b\u4f3cHashMap\u7684\u96c6\u5408\uff0c\u53ea\u4e0d\u8fc7\u81ea\u5df1\u5b9e\u73b0\u4e86\u5bfb\u5740\uff0c\u4e5f\u6ca1\u6709HashMap\u4e2d\u7684put\u65b9\u6cd5\uff0c\u800c\u662fset\u65b9\u6cd5\u3002"),(0,l.kt)("h2",{id:"threadlocal\u4e2d\u7684set\u65b9\u6cd5"},"ThreadLocal\u4e2d\u7684set\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"}," /**\n     * Sets the current thread's copy of this thread-local variable\n     * to the specified value.  Most subclasses will have no need to\n     * override this method, relying solely on the {@link #initialValue}\n     * method to set the values of thread-locals.\n     *\n     * @param value the value to be stored in the current thread's copy of\n     *        this thread-local.\n     */\n    public void set(T value) {\n        Thread t = Thread.currentThread();\n        ThreadLocalMap map = getMap(t);\n        if (map != null)\n            map.set(this, value);\n        else\n            createMap(t, value);\n    }\n")),(0,l.kt)("p",null,"\u7531\u4e8e\u6bcf\u4e2athread\u5b9e\u4f8b\u90fd\u6709\u4e00\u4e2aThreadLocalMap\uff0c\u6240\u4ee5\u5728\u8fdb\u884cset\u7684\u65f6\u5019\uff0c\u9996\u5148\u6839\u636eThread.currentThread\uff08\uff09\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\uff0c\u7136\u540e\u6839\u636e\u5f53\u524d\u7ebf\u7a0bt\uff0c\u8c03\u7528getMap(t)\u83b7\u53d6ThreadLocalMap\u5bf9\u8c61\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8bbe\u7f6e\u503c\uff0cThreadLocalMap\u5bf9\u8c61\u662f\u7a7a\u503c\uff0c\u6240\u4ee5\u4f1a\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u5373\u8c03\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"createMap(t,value)\u65b9\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"void createMap(Thread t, T firstValue) {\n    t.threadLocals = new ThreadLocalMap(this, firstValue);\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"ThreadLocalMap(ThreadLocal<?> firstKey, Object firstValue) {\n    table = new Entry[INITIAL_CAPACITY];\n    int i = firstKey.threadLocalHashCode & (INITIAL_CAPACITY - 1);\n    table[i] = new Entry(firstKey, firstValue);\n    size = 1;\n    setThreshold(INITIAL_CAPACITY);\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"}," private void setThreshold(int len) {\n     threshold = len * 2 / 3;\n }\n")),(0,l.kt)("p",null,"\u5373\u662f\u8c03\u7528\u4e0a\u8ff0\u7684\u6784\u9020\u65b9\u6cd5\u8fdb\u884c\u6784\u9020\uff0c\u8fd9\u91cc\u4ec5\u4ec5\u662f\u521d\u59cb\u5316\u4e8616\u4e2a\u5143\u7d20\u7684\u5f15\u7528\u6570\u7ec4\uff0c\u5e76\u6ca1\u6709\u521d\u59cb\u531616\u4e2aEntry \u5bf9\u8c61\u3002\u800c\u662f\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u6709\u591a\u5c11\u4e2a\u7ebf\u7a0b\u5c40\u90e8\u5bf9\u8c61\u8981\u4fdd\u5b58\uff0c\u90a3\u4e48\u5c31\u521d\u59cb\u5316\u591a\u5c11\u4e2a Entry \u5bf9\u8c61\u6765\u4fdd\u5b58\u5b83\u4eec\u3002"),(0,l.kt)("h3",{id:"\u4e3a\u4ec0\u4e48\u8981\u7528threadlocalmap\u6765\u4fdd\u5b58\u7ebf\u7a0b\u5c40\u90e8\u5bf9\u8c61"},"\u4e3a\u4ec0\u4e48\u8981\u7528ThreadLocalMap\u6765\u4fdd\u5b58\u7ebf\u7a0b\u5c40\u90e8\u5bf9\u8c61"),(0,l.kt)("p",null,"\u539f\u56e0\u662f\u4e00\u4e2a\u7ebf\u7a0b\u62e5\u6709\u7684\u7684\u5c40\u90e8\u5bf9\u8c61\u53ef\u80fd\u6709\u5f88\u591a\uff0c\u8fd9\u6837\u5b9e\u73b0\u7684\u8bdd\uff0c\u90a3\u4e48\u4e0d\u7ba1\u4f60\u4e00\u4e2a\u7ebf\u7a0b\u62e5\u6709\u591a\u5c11\u4e2a\u5c40\u90e8\u53d8\u91cf\uff0c\u90fd\u662f\u4f7f\u7528\u540c\u4e00\u4e2a ThreadLocalMap \u6765\u4fdd\u5b58\u7684\uff0cThreadLocalMap \u4e2d private Entry[] table \u7684\u521d\u59cb\u5927\u5c0f\u662f16\u3002\u8d85\u8fc7\u5bb9\u91cf\u76842/3\u65f6\uff0c\u4f1a\u6269\u5bb9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n     * Sets the current thread's copy of this thread-local variable\n     * to the specified value.  Most subclasses will have no need to\n     * override this method, relying solely on the {@link #initialValue}\n     * method to set the values of thread-locals.\n     *\n     * @param value the value to be stored in the current thread's copy of\n     *        this thread-local.\n     */\n    public void set(T value) {\n        Thread t = Thread.currentThread();\n        ThreadLocalMap map = getMap(t);\n        if (map != null)\n            map.set(this, value);\n        else\n            createMap(t, value);\n    }\n")),(0,l.kt)("p",null,"\u5982\u679cmap\u4e0d\u4e3a\u7a7a\u7684\u60c5\u51b5\uff0c\u4f1a\u8c03\u7528 map.set(this, value); \u65b9\u6cd5\uff0c\u6211\u4eec\u770b\u5230\u662f\u4ee5\u5f53\u524d thread\u7684\u5f15\u7528\u4e3a key, \u83b7\u5f97ThreadLocalMap \uff0c\u7136\u540e\u8c03\u7528 map.set(this, value); \u4fdd\u5b58\u8fdb private Entry[] table :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n         * Set the value associated with key.\n         *\n         * @param key the thread local object\n         * @param value the value to be set\n         */\nprivate void set(ThreadLocal<?> key, Object value) {\n\n    // We don't use a fast path as with get() because it is at\n    // least as common to use set() to create new entries as\n    // it is to replace existing ones, in which case, a fast\n    // path would fail more often than not.\n\n    Entry[] tab = table;\n    int len = tab.length;\n    int i = key.threadLocalHashCode & (len-1);\n\n    for (Entry e = tab[i];e != null;e = tab[i = nextIndex(i, len)]) {\n        ThreadLocal<?> k = e.get();\n        if (k == key) {\n            e.value = value;\n            return;\n        }\n        if (k == null) {\n            replaceStaleEntry(key, value, i);\n            return;\n        }\n    }\n    tab[i] = new Entry(key, value);\n    int sz = ++size;\n    if (!cleanSomeSlots(i, sz) && sz >= threshold)\n        rehash();\n}\n")),(0,l.kt)("p",null,"set(T value) \u65b9\u6cd5\u4e3a\u6bcf\u4e2aThread\u5bf9\u8c61\u90fd\u521b\u5efa\u4e86\u4e00\u4e2aThreadLocalMap\uff0c\u5e76\u4e14\u5c06value\u653e\u5165ThreadLocalMap\u4e2d\uff0cThreadLocalMap\u4f5c\u4e3aThread\u5bf9\u8c61\u7684\u6210\u5458\u53d8\u91cf\u4fdd\u5b58\u3002\u90a3\u4e48\u53ef\u4ee5\u7528\u4e0b\u56fe\u6765\u8868\u793aThreadLocal\u5728\u5b58\u50a8value\u65f6\u7684\u5173\u7cfb\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220322141302353.png?raw=true",alt:"image-20220322141302353"})),(0,l.kt)("h2",{id:"threadlocal\u7684get\u65b9\u6cd5"},"ThreadLocal\u7684get\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public T get() {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null) {\n        ThreadLocalMap.Entry e = map.getEntry(this);\n        if (e != null) {\n            @SuppressWarnings("unchecked")\n            T result = (T)e.value;\n            return result;\n        }\n    }\n    return setInitialValue();\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"private Entry getEntry(ThreadLocal<?> key) {\n    int i = key.threadLocalHashCode & (table.length - 1);\n    Entry e = table[i];\n    if (e != null && e.get() == key)\n        return e;\n    else\n        return getEntryAfterMiss(key, i, e);\n}\n")),(0,l.kt)("p",null,"\u9996\u5148\u83b7\u53d6ThreadLocalMap\u5bf9\u8c61\uff0c\u7531\u4e8eThreadLocalMap\u4f7f\u7528\u7684\u5f53\u524d\u7684ThreadLocal\u4f5c\u4e3akey\uff0c\u6240\u4ee5\u4f20\u5165\u7684\u53c2\u6570\u4e3athis\uff0c\u7136\u540e\u8c03\u7528getEntry\uff08\uff09 \u65b9\u6cd5\uff0c\u901a\u8fc7\u8fd9\u4e2akey\u6784\u9020\u7d22\u5f15\uff0c\u6839\u636e\u7d22\u5f15\u53bbtable\uff08Entry\u6570\u7ec4\uff09\u4e2d\u53bb\u67e5\u627e\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\uff0c\u6839\u636e\u4e0b\u6807\u627e\u5230Entry\u5bf9\u8c61\uff0c\u7136\u540e\u5224\u65adEntry\u5bf9\u8c61e\u4e0d\u4e3a\u7a7a\u5e76\u4e14e\u7684\u5f15\u7528\u4e0e\u4f20\u5165\u7684key\u4e00\u6837\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5982\u679c\u627e\u4e0d\u5230\u5219\u8c03\u7528getEntryAfterMiss\uff08\uff09 \u65b9\u6cd5\u3002\u8c03\u7528 getEntryAfterMiss \u8868\u793a\u76f4\u63a5\u6563\u5217\u5230\u7684\u4f4d\u7f6e\u6ca1\u627e\u5230\uff0c\u90a3\u4e48\u987a\u7740hash\u8868\u9012\u589e\uff08\u5faa\u73af\uff09\u5730\u5f80\u4e0b\u627e\uff0c\u4ecei\u5f00\u59cb\uff0c\u4e00\u76f4\u5f80\u4e0b\u627e\uff0c\u76f4\u5230\u51fa\u73b0\u7a7a\u7684\u69fd\u4e3a\u6b62\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"private Entry getEntryAfterMiss(ThreadLocal<?> key, int i, Entry e) {\n    Entry[] tab = table;\n    int len = tab.length;\n    while (e != null) {\n        ThreadLocal<?> k = e.get();\n        if (k == key)\n            return e;\n        if (k == null)\n            expungeStaleEntry(i);\n        else\n            i = nextIndex(i, len);\n        e = tab[i];\n    }\n    return null;\n}\n")),(0,l.kt)("h2",{id:"threadlocal\u7684\u5185\u5b58\u56de\u6536"},"ThreadLocal\u7684\u5185\u5b58\u56de\u6536"),(0,l.kt)("p",null,"ThreadLocal\u6d89\u53ca\u5230\u7684\u4e24\u4e2a\u5c42\u9762\u7684\u5185\u5b58\u81ea\u52a8\u56de\u6536"),(0,l.kt)("h3",{id:"\u5728threadlocal\u5c42\u9762\u7684\u5185\u5b58\u56de\u6536"},"\u5728ThreadLocal\u5c42\u9762\u7684\u5185\u5b58\u56de\u6536"),(0,l.kt)("p",null,"\u200b\t\t\u5f53\u7ebf\u7a0b\u6b7b\u4ea1\u65f6\uff0c\u90a3\u4e48\u6240\u6709\u7684\u4fdd\u5b58\u5728\u7684\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u5c31\u4f1a\u88ab\u56de\u6536\uff0c\u5176\u5b9e\u8fd9\u91cc\u662f\u6307\u7ebf\u7a0bThread\u5bf9\u8c61\u4e2d\u7684\nThreadLocal.ThreadLocalMap threadLocals \u4f1a\u88ab\u56de\u6536\uff0c\u8fd9\u662f\u663e\u7136\u7684\u3002"),(0,l.kt)("h3",{id:"threadlocalmap-\u5c42\u9762\u7684\u5185\u5b58\u56de\u6536"},"ThreadLocalMap \u5c42\u9762\u7684\u5185\u5b58\u56de\u6536"),(0,l.kt)("p",null,"\u200b\t\t\u5982\u679c\u7ebf\u7a0b\u53ef\u4ee5\u6d3b\u5f88\u957f\u7684\u65f6\u95f4\uff0c\u5e76\u4e14\u8be5\u7ebf\u7a0b\u4fdd\u5b58\u7684\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u6709\u5f88\u591a(\u4e5f\u5c31\u662f Entry \u5bf9\u8c61\u5f88\u591a)\uff0c\u90a3\u4e48\u5c31\u6d89\u53ca\u5230\u5728\u7ebf\u7a0b\u7684\u751f\u547d\u671f\u5185\u5982\u4f55\u56de\u6536 ThreadLocalMap \u7684\u5185\u5b58\u4e86\uff0c\u4e0d\u7136\u7684\u8bdd\uff0cEntry\u5bf9\u8c61\u8d8a\u591a\uff0c\u90a3\u4e48ThreadLocalMap \u5c31\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u5360\u7528\u7684\u5185\u5b58\u5c31\u4f1a\u8d8a\u6765\u8d8a\u591a\uff0c\u6240\u4ee5\u5bf9\u4e8e\u5df2\u7ecf\u4e0d\u9700\u8981\u4e86\u7684\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\uff0c\u5c31\u5e94\u8be5\u6e05\u7406\u6389\u5176\u5bf9\u5e94\u7684Entry\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u200b\t\t\u4f7f\u7528\u7684\u65b9\u5f0f\u662f\uff0cEntry\u5bf9\u8c61\u7684key\u662fWeakReference \u7684\u5305\u88c5\uff0c\u5f53ThreadLocalMap \u7684 private Entry[]table \uff0c\u5df2\u7ecf\u88ab\u5360\u7528\u8fbe\u5230\u4e86\u4e09\u5206\u4e4b\u4e8c\u65f6 threshold = 2/3 (\u4e5f\u5c31\u662f\u7ebf\u7a0b\u62e5\u6709\u7684\u5c40\u90e8\u53d8\u91cf\u8d85\u8fc7\u4e8610\u4e2a) \uff0c\u5c31\u4f1a\u5c1d\u8bd5\u56de\u6536 Entry \u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 ThreadLocalMap.set\uff08\uff09 \u65b9\u6cd5\u4e2d\u6709\u4e0b\u9762\u7684\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"if (!cleanSomeSlots(i, sz) && sz >= threshold)\n    rehash();\n")),(0,l.kt)("p",null,"cleanSomeSlots \u5c31\u662f\u8fdb\u884c\u56de\u6536\u5185\u5b58\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"}," private boolean cleanSomeSlots(int i, int n) {\n     boolean removed = false;\n     Entry[] tab = table;\n     int len = tab.length;\n     do {\n         i = nextIndex(i, len);\n         Entry e = tab[i];\n         if (e != null && e.get() == null) {\n             n = len;\n             removed = true;\n             i = expungeStaleEntry(i);\n         }\n     } while ( (n >>>= 1) != 0);\n     return removed;\n }\n")),(0,l.kt)("h2",{id:"\u603b\u7ed3-1"},"\u603b\u7ed3"),(0,l.kt)("p",null,"\u200b\t\t\u901a\u8fc7\u6e90\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u72ec\u7acb\u4fee\u6539\u5c5e\u4e8e\u81ea\u5df1\u7684\u526f\u672c\u800c\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\uff0c\u4ece\u800c\u9694\u79bb\u4e86\u7ebf\u7a0b.\u907f\u514d\u4e86\u7ebf\u7a0b\u8bbf\u95ee\u5b9e\u4f8b\u53d8\u91cf\u53d1\u751f\u5b89\u5168\u95ee\u9898. \u540c\u65f6\u6211\u4eec\u4e5f\u80fd\u5f97\u51fa\u4e0b\u9762\u7684\u7ed3\u8bba\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"ThreadLocal\u53ea\u662f\u64cd\u4f5cThread\u4e2d\u7684ThreadLocalMap\u5bf9\u8c61\u7684\u96c6\u5408\uff1b"),(0,l.kt)("li",{parentName:"ol"},"ThreadLocalMap\u53d8\u91cf\u5c5e\u4e8e\u7ebf\u7a0b\u7684\u5185\u90e8\u5c5e\u6027\uff0c\u4e0d\u540c\u7684\u7ebf\u7a0b\u62e5\u6709\u5b8c\u5168\u4e0d\u540c\u7684ThreadLocalMap\u53d8\u91cf\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b\u4e2d\u7684ThreadLocalMap\u53d8\u91cf\u7684\u503c\u662f\u5728ThreadLocal\u5bf9\u8c61\u8fdb\u884cset\u6216\u8005get\u64cd\u4f5c\u65f6\u521b\u5efa\u7684\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u5f53\u524d\u7ebf\u7a0b\u7684ThreadLocalMap\u7684\u5173\u952e\u5728\u4e8e\u4f7f\u7528\u5f53\u524d\u7684ThreadLocal\u7684\u5b9e\u4f8b\u4f5c\u4e3akey\u6765\u5b58\u50a8value\u503c\uff1b"),(0,l.kt)("li",{parentName:"ol"},"ThreadLocal\u6a21\u5f0f\u81f3\u5c11\u4ece\u4e24\u4e2a\u65b9\u9762\u5b8c\u6210\u4e86\u6570\u636e\u8bbf\u95ee\u9694\u79bb\uff0c\u5373\u7eb5\u5411\u9694\u79bb(\u7ebf\u7a0b\u4e0e\u7ebf\u7a0b\u4e4b\u95f4\u7684ThreadLocalMap\u4e0d\u540c)\u548c\u6a2a\u5411\u9694\u79bb(\u4e0d\u540c\u7684ThreadLocal\u5b9e\u4f8b\u4e4b\u95f4\u7684\u4e92\u76f8\u9694\u79bb)\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u6240\u6709\u7684\u5c40\u90e8\u53d8\u91cf\u5176\u5b9e\u5b58\u50a8\u5728\u8be5\u7ebf\u7a0b\u81ea\u5df1\u7684\u540c\u4e00\u4e2amap\u5c5e\u6027\u4e2d\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b\u6b7b\u4ea1\u65f6\uff0c\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u4f1a\u81ea\u52a8\u56de\u6536\u5185\u5b58\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u662f\u901a\u8fc7\u4e00\u4e2a Entry \u4fdd\u5b58\u5728map\u4e2d\uff0c\u8be5Entry \u7684key\u662f\u4e00\u4e2a WeakReference\u5305\u88c5\u7684ThreadLocal, value\u4e3a\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\uff0ckey \u5230 value \u7684\u6620\u5c04\u662f\u901a\u8fc7\uff1aThreadLocal.threadLocalHashCode & (INITIAL_CAPACITY - 1) \u6765\u5b8c\u6210\u7684\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u5f53\u7ebf\u7a0b\u62e5\u6709\u7684\u5c40\u90e8\u53d8\u91cf\u8d85\u8fc7\u4e86\u5bb9\u91cf\u76842/3(\u6ca1\u6709\u6269\u5927\u5bb9\u91cf\u65f6\u662f10\u4e2a)\uff0c\u4f1a\u6d89\u53ca\u5230ThreadLocalMap\u4e2dEntry\u7684\u56de\u6536\uff1b")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5bf9\u4e8e\u591a\u7ebf\u7a0b\u8d44\u6e90\u5171\u4eab\u7684\u95ee\u9898\uff0c\u540c\u6b65\u673a\u5236\u91c7\u7528\u4e86\u201c\u4ee5\u65f6\u95f4\u6362\u7a7a\u95f4\u201d\u7684\u65b9\u5f0f\uff0c\u800cThreadLocal\u91c7\u7528\u4e86\u201c\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u201d\u7684\u65b9\u5f0f\u3002\u524d\u8005\u4ec5\u63d0\u4f9b\u4e00\u4efd\u53d8\u91cf\uff0c\u8ba9\u4e0d\u540c\u7684\u7ebf\u7a0b\u6392\u961f\u8bbf\u95ee\uff0c\u800c\u540e\u8005\u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u63d0\u4f9b\u4e86\u4e00\u4efd\u53d8\u91cf\uff0c\u56e0\u6b64\u53ef\u4ee5\u540c\u65f6\u8bbf\u95ee\u800c\u4e92\u4e0d\u5f71\u54cd\u3002")),(0,l.kt)("h1",{id:"synchronized\u4e0evolatile\u5bf9\u6bd4"},"Synchronized\u4e0eVolatile\u5bf9\u6bd4"),(0,l.kt)("h2",{id:"synchronized\u4e0evolatile\u7684\u533a\u522b"},"Synchronized\u4e0eVolatile\u7684\u533a\u522b"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"volatile"),"\u4e3b\u8981\u5e94\u7528\u5728\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u5b9e\u4f8b\u53d8\u91cf\u66f4\u6539\u7684\u573a\u5408\uff0c\u5237\u65b0\u4e3b\u5185\u5b58\u5171\u4eab\u53d8\u91cf\u7684\u503c\u4ece\u800c\u4f7f\u5f97\u5404\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u83b7\u5f97\u6700\u65b0\u7684\u503c\uff0c\u7ebf\u7a0b\u8bfb\u53d6\u53d8\u91cf\u7684\u503c\u9700\u8981\u4ece\u4e3b\u5b58\u4e2d\u8bfb\u53d6\uff1b",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized"),"\u5219\u662f\u9501\u5b9a\u5f53\u524d\u53d8\u91cf\uff0c\u53ea\u6709\u5f53\u524d\u7ebf\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u8be5\u53d8\u91cf\uff0c\u5176\u4ed6\u7ebf\u7a0b\u88ab\u963b\u585e\u4f4f\u3002\u53e6\u5916\uff0c",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized"),"\u8fd8\u4f1a\u521b\u5efa\u4e00\u4e2a\u5185\u5b58\u5c4f\u969c\uff0c\u5185\u5b58\u5c4f\u969c\u6307\u4ee4\u4fdd\u8bc1\u4e86\u6240\u6709CPU\u64cd\u4f5c\u7ed3\u679c\u90fd\u4f1a\u76f4\u63a5\u5237\u5230\u4e3b\u5b58\u4e2d\uff08\u5373\u91ca\u653e\u9501\u524d\uff09\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u64cd\u4f5c\u7684\u5185\u5b58\u53ef\u89c1\u6027\uff0c\u540c\u65f6\u4e5f\u4f7f\u5f97\u5148\u83b7\u5f97\u8fd9\u4e2a\u9501\u7684\u7ebf\u7a0b\u7684\u6240\u6709\u64cd\u4f5c"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"volatile"),"\u4ec5\u80fd\u4f7f\u7528\u5728\u53d8\u91cf\u7ea7\u522b\uff1b",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized"),"\u5219\u53ef\u4ee5\u4f7f\u7528\u5728\u53d8\u91cf\u3001\u65b9\u6cd5\u3001\u548c\u7c7b\u7ea7\u522b\u7684\u3002"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"volatile"),"\u4e0d\u4f1a\u9020\u6210\u7ebf\u7a0b\u7684\u963b\u585e\uff1b",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized"),"\u53ef\u80fd\u4f1a\u9020\u6210\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u6bd4\u5982\u591a\u4e2a\u7ebf\u7a0b\u4e89\u62a2",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized"),"\u9501\u5bf9\u8c61\u65f6\uff0c\u4f1a\u51fa\u73b0\u963b\u585e\u3002"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"volatile"),"\u4ec5\u80fd\u5b9e\u73b0\u53d8\u91cf\u7684\u4fee\u6539\u53ef\u89c1\u6027\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u539f\u5b50\u6027\uff1b\u800c",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized"),"\u5219\u53ef\u4ee5\u4fdd\u8bc1\u53d8\u91cf\u7684\u4fee\u6539\u53ef\u89c1\u6027\u548c\u539f\u5b50\u6027\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u83b7\u5f97\u9501\u624d\u80fd\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e34\u754c\u533a\u4e2d\u7684\u6240\u6709\u8bed\u53e5\u5168\u90e8\u5f97\u5230\u6267\u884c\u3002"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"volatile"),"\u6807\u8bb0\u7684\u53d8\u91cf\u4e0d\u4f1a\u88ab\u7f16\u8bd1\u5668\u4f18\u5316\uff0c\u53ef\u4ee5\u7981\u6b62\u8fdb\u884c\u6307\u4ee4\u91cd\u6392\uff1b",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized"),"\u6807\u8bb0\u7684\u53d8\u91cf\u53ef\u4ee5\u88ab\u7f16\u8bd1\u5668\u4f18\u5316\u3002")),(0,l.kt)("h2",{id:"synchronized\u4e0evolatile\u4e09\u5927\u6027\u8d28\u603b\u7ed3"},"Synchronized\u4e0eVolatile\u4e09\u5927\u6027\u8d28\u603b\u7ed3"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\uff1a\u5177\u6709\u539f\u5b50\u6027\uff0c\u6709\u5e8f\u6027\u548c\u53ef\u89c1\u6027\n\u7c92\u5ea6\uff1a\u5bf9\u8c61\u9501\u3001\u7c7b\u9501"),(0,l.kt)("h3",{id:"\u539f\u5b50\u6027"},"\u539f\u5b50\u6027"),(0,l.kt)("p",null,"\u539f\u5b50\u6027\u662f\u6307\u4e00\u4e2a\u64cd\u4f5c\u662f\u4e0d\u53ef\u4e2d\u65ad\u7684\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u6210\u529f\u8981\u4e48\u5168\u90e8\u6267\u884c\u5931\u8d25\uff0c\u6709\u7740\u201c\u540c\u751f\u5171\u6b7b\u201d\u7684\u611f\u89c9\u3002\u5373\u4f7f\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e00\u8d77\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u64cd\u4f5c\u4e00\u65e6\u5f00\u59cb\uff0c\u5c31\u4e0d\u4f1a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u6240\u5e72\u6270\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"int a = 10; //1\na++; //2\nint b=a; //3\na = a+1; //4")),(0,l.kt)("p",null,"\u4e0a\u9762\u8fd9\u56db\u4e2a\u8bed\u53e5\u4e2d\u53ea\u6709\u7b2c1\u4e2a\u8bed\u53e5\u662f\u539f\u5b50\u64cd\u4f5c\uff0c\u5c0610\u8d4b\u503c\u7ed9\u7ebf\u7a0b\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cfa,\u800c\u8bed\u53e52\uff08a++\uff09\uff0c\u5b9e\u9645\u4e0a\u5305\u542b\u4e86\u4e09\u4e2a\u64cd\u4f5c\uff1a1. \u8bfb\u53d6\u53d8\u91cfa\u7684\u503c\uff1b2\uff1a\u5bf9a\u8fdb\u884c\u52a0\u4e00\u7684\u64cd\u4f5c\uff1b3.\u5c06\u8ba1\u7b97\u540e\u7684\u503c\u518d\u8d4b\u503c\u7ed9\u53d8\u91cfa\uff0c\u800c\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u65e0\u6cd5\u6784\u6210\u539f\u5b50\u64cd\u4f5c\u3002\u5bf9\u8bed\u53e53,4\u7684\u5206\u6790\u540c\u7406\u53ef\u5f97\u8fd9\u4e24\u6761\u8bed\u53e5\u4e0d\u5177\u5907\u539f\u5b50\u6027\u3002"),(0,l.kt)("p",null,"java\u5185\u5b58\u6a21\u578b\u4e2d\u5b9a\u4e49\u4e868\u79cd\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u7684\uff0c\u4e0d\u53ef\u518d\u5206\u7684\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"lock(\u9501\u5b9a)\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u53d8\u91cf\u6807\u8bc6\u4e3a\u4e00\u4e2a\u7ebf\u7a0b\u72ec\u5360\u7684\u72b6\u6001\uff1b"),(0,l.kt)("li",{parentName:"ol"},"unlock(\u89e3\u9501):\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u5904\u4e8e\u9501\u5b9a\u72b6\u6001\u7684\u53d8\u91cf\u91ca\u653e\u51fa\u6765\uff0c\u91ca\u653e\u540e\u7684\u53d8\u91cf\u624d\u53ef\u4ee5\u88ab\u5176\u4ed6\u7ebf\u7a0b\u9501\u5b9a"),(0,l.kt)("li",{parentName:"ol"},"read\uff08\u8bfb\u53d6\uff09\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4ece\u4e3b\u5185\u5b58\u4f20\u8f93\u5230\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5185\u5b58\u4e2d\uff0c\u4ee5\u4fbf\u540e\u9762\u7684load\u52a8\u4f5c\u4f7f\u7528\uff1b"),(0,l.kt)("li",{parentName:"ol"},"load\uff08\u8f7d\u5165\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628aread\u64cd\u4f5c\u4ece\u4e3b\u5185\u5b58\u4e2d\u5f97\u5230\u7684\u53d8\u91cf\u503c\u653e\u5165\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\u526f\u672c"),(0,l.kt)("li",{parentName:"ol"},"use\uff08\u4f7f\u7528\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u5de5\u4f5c\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9012\u7ed9\u6267\u884c\u5f15\u64ce\uff0c\u6bcf\u5f53\u865a\u62df\u673a\u9047\u5230\u4e00\u4e2a\u9700\u8981\u4f7f\u7528\u5230\u53d8\u91cf\u7684\u503c\u7684\u5b57\u8282\u7801\u6307\u4ee4\u65f6\u5c06\u4f1a\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\uff1b"),(0,l.kt)("li",{parentName:"ol"},"assign\uff08\u8d4b\u503c\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u4ece\u6267\u884c\u5f15\u64ce\u63a5\u6536\u5230\u7684\u503c\u8d4b\u7ed9\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u6bcf\u5f53\u865a\u62df\u673a\u9047\u5230\u4e00\u4e2a\u7ed9\u53d8\u91cf\u8d4b\u503c\u7684\u5b57\u8282\u7801\u6307\u4ee4\u65f6\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\uff1b"),(0,l.kt)("li",{parentName:"ol"},"store\uff08\u5b58\u50a8\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u5de5\u4f5c\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9001\u7ed9\u4e3b\u5185\u5b58\u4e2d\u4ee5\u4fbf\u968f\u540e\u7684write\u64cd\u4f5c\u4f7f\u7528\uff1b"),(0,l.kt)("li",{parentName:"ol"},"write\uff08\u64cd\u4f5c\uff09\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628astore\u64cd\u4f5c\u4ece\u5de5\u4f5c\u5185\u5b58\u4e2d\u5f97\u5230\u7684\u53d8\u91cf\u7684\u503c\u653e\u5165\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\u4e2d\u3002")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"synchronized"))),(0,l.kt)("p",null,"\u4e0a\u9762\u4e00\u5171\u6709\u516b\u6761\u539f\u5b50\u64cd\u4f5c\uff0c\u5176\u4e2d\u516d\u6761\u53ef\u4ee5\u6ee1\u8db3\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u8bbf\u95ee\u8bfb\u5199\u5177\u5907\u539f\u5b50\u6027\uff0c\u8fd8\u5269\u4e0block\u548cunlock\u4e24\u6761\u539f\u5b50\u64cd\u4f5c\u3002\u5982\u679c\u6211\u4eec\u9700\u8981\u66f4\u5927\u8303\u56f4\u7684\u539f\u5b50\u6027\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4f7f\u7528lock\u548cunlock\u539f\u5b50\u64cd\u4f5c\u3002\u5c3d\u7ba1jvm\u6ca1\u6709\u628alock\u548cunlock\u5f00\u653e\u7ed9\u6211\u4eec\u4f7f\u7528\uff0c\u4f46jvm\u4ee5\u66f4\u9ad8\u5c42\u6b21\u7684\u6307\u4ee4monitorenter\u548cmonitorexit\u6307\u4ee4\u5f00\u653e\u7ed9\u6211\u4eec\u4f7f\u7528\uff0c\u53cd\u5e94\u5230java\u4ee3\u7801\u4e2d\u5c31\u662f---",(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\u5173\u952e\u5b57\uff0c\u4e5f\u5c31\u662f\u8bf4",(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\u6ee1\u8db3\u539f\u5b50\u6027\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"volatile"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class VolatileExample {\n    private static `volatile` int counter = 0;\n\n    public static void main(String[] args) {\n        for (int i = 0; i < 10; i++) {\n            Thread thread = new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    for (int i = 0; i < 10000; i++)\n                        counter++;\n                }\n            });\n            thread.start();\n        }\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(counter);\n    }\n}\n")),(0,l.kt)("p",null,"\u5f00\u542f10\u4e2a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u81ea\u52a010000\u6b21\uff0c\u5982\u679c\u4e0d\u51fa\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684\u95ee\u9898\u6700\u7ec8\u7684\u7ed3\u679c\u5e94\u8be5\u5c31\u662f\uff1a10*10000= 100000;\u53ef\u662f\u8fd0\u884c\u591a\u6b21\u90fd\u662f\u5c0f\u4e8e100000\u7684\u7ed3\u679c\uff0c\u95ee\u9898\u5728\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5728\u524d\u9762\u8bf4\u8fc7counter++\u8fd9\u5e76\u4e0d\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff0c\u5305\u542b\u4e86\u4e09\u4e2a\u6b65\u9aa4\uff1a1.\u8bfb\u53d6\u53d8\u91cfcounter\u7684\u503c\uff1b2.\u5bf9counter\u52a0\u4e00\uff1b3.\u5c06\u65b0\u503c\u8d4b\u503c\u7ed9\u53d8\u91cfcounter\u3002\u5982\u679c\u7ebf\u7a0bA\u8bfb\u53d6counter\u5230\u5de5\u4f5c\u5185\u5b58\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8fd9\u4e2a\u503c\u5df2\u7ecf\u505a\u4e86\u81ea\u589e\u64cd\u4f5c\u540e\uff0c\u90a3\u4e48\u7ebf\u7a0bA\u7684\u8fd9\u4e2a\u503c\u81ea\u7136\u800c\u7136\u5c31\u662f\u4e00\u4e2a\u8fc7\u671f\u7684\u503c\uff0c\u56e0\u6b64\uff0c\u603b\u7ed3\u679c\u5fc5\u7136\u4f1a\u662f\u5c0f\u4e8e100000\u7684\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u8ba9",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5fc5\u987b\u7b26\u5408\u4ee5\u4e0b\u4e24\u6761\u89c4\u5219\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u8fd0\u7b97\u7ed3\u679c\u5e76\u4e0d\u4f9d\u8d56\u4e8e\u53d8\u91cf\u7684\u5f53\u524d\u503c\uff0c\u6216\u8005\u80fd\u591f\u786e\u4fdd\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u53d8\u91cf\u7684\u503c\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u53d8\u91cf\u4e0d\u9700\u8981\u4e0e\u5176\u4ed6\u7684\u72b6\u6001\u53d8\u91cf\u5171\u540c\u53c2\u4e0e\u4e0d\u53d8\u7ea6\u675f")),(0,l.kt)("h3",{id:"\u6709\u5e8f\u6027"},"\u6709\u5e8f\u6027"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"synchronized"))),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\u8bed\u4e49\u8868\u793a\u9501\u5728\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u7531\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u83b7\u53d6\uff0c\u5f53\u9501\u88ab\u5360\u7528\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ea\u80fd\u7b49\u5f85\u3002\u56e0\u6b64\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\u8bed\u4e49\u5c31\u8981\u6c42\u7ebf\u7a0b\u5728\u8bbf\u95ee\u8bfb\u5199\u5171\u4eab\u53d8\u91cf\u65f6\u53ea\u80fd\u201c\u4e32\u884c\u201d\u6267\u884c\uff0c\u56e0\u6b64",(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\u5177\u6709\u6709\u5e8f\u6027\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"volatile"))),(0,l.kt)("p",null,"\u5982\u679c\u5728\u672c\u7ebf\u7a0b\u5185\u89c2\u5bdf\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u6709\u5e8f\u7684\uff1b\u5982\u679c\u5728\u4e00\u4e2a\u7ebf\u7a0b\u89c2\u5bdf\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u65e0\u5e8f\u7684\u3002\u5728\u5355\u4f8b\u6a21\u5f0f\u7684\u5b9e\u73b0\u4e0a\u6709\u4e00\u79cd\u53cc\u91cd\u68c0\u9a8c\u9501\u5b9a\u7684\u65b9\u5f0f\uff08Double-checkedLocking\uff09\u3002\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class Singleton {\n    private Singleton() {\n    }\n\n    private `volatile` static Singleton instance;\n\n    public Singleton getInstance() {\n        if (instance == null) {\n            `synchronized` (Singleton.class) {\n                if (instance == null) {\n                    instance = new Singleton();\n                }\n            }\n        }\n        return instance;\n    }\n}\n")),(0,l.kt)("p",null,"\u6211\u4eec\u5148\u6765\u5206\u6790\u4e00\u4e0b\u4e0d\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u7684\u60c5\u51b5\uff0c\u6709\u95ee\u9898\u7684\u8bed\u53e5\u662f\u8fd9\u6761\uff1a"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"instance = new Singleton();")),(0,l.kt)("p",null,"\u8fd9\u6761\u8bed\u53e5\u5b9e\u9645\u4e0a\u5305\u542b\u4e86\u4e09\u4e2a\u64cd\u4f5c\uff1a1.\u5206\u914d\u5bf9\u8c61\u7684\u5185\u5b58\u7a7a\u95f4\uff1b2.\u521d\u59cb\u5316\u5bf9\u8c61\uff1b3.\u8bbe\u7f6einstance\u6307\u5411\u521a\u5206\u914d\u7684\n\u5185\u5b58\u5730\u5740\u3002\u4f46\u7531\u4e8e\u5b58\u5728\u91cd\u6392\u5e8f\u7684\u95ee\u9898\uff0c\u53ef\u80fd\u6709\u4ee5\u4e0b\u7684\u6267\u884c\u987a\u5e8f\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220321192329291.png?raw=true",alt:"image-20220321192329291"})),(0,l.kt)("p",null,"\u200b\t\t\u5982\u679c2\u548c3\u8fdb\u884c\u4e86\u91cd\u6392\u5e8f\u7684\u8bdd\uff0c\u7ebf\u7a0bB\u8fdb\u884c\u5224\u65adif(instance==null)\u65f6\u5c31\u4f1a\u4e3atrue\uff0c\u800c\u5b9e\u9645\u4e0a\u8fd9\u4e2ainstance\u5e76\u6ca1\u6709\u521d\u59cb\u5316\u6210\u529f\uff0c\u663e\u800c\u6613\u89c1\u5bf9\u7ebf\u7a0bB\u6765\u8bf4\u4e4b\u540e\u7684\u64cd\u4f5c\u5c31\u4f1a\u662f\u9519\u5f97\u3002\u800c\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u4fee\u9970\u7684\u8bdd\u5c31\u53ef\u4ee5\u7981\u6b622\u548c3\u64cd\u4f5c\u91cd\u6392\u5e8f\uff0c\u4ece\u800c\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u3002",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"volatile"),"\u5305\u542b\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u7684\u8bed\u4e49\uff0c\u5176\u5177\u6709\u6709\u5e8f\u6027"),"\u3002"),(0,l.kt)("h3",{id:"\u53ef\u89c1\u6027"},"\u53ef\u89c1\u6027"),(0,l.kt)("p",null,"\u200b\t\t\u53ef\u89c1\u6027\u662f\u6307\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u53d8\u91cf\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u80fd\u591f\u7acb\u5373\u5f97\u77e5\u8fd9\u4e2a\u4fee\u6539\u3002\u901a\u8fc7\u4e4b\u524d\u5bf9synchronzed\u5185\u5b58\u8bed\u4e49\u8fdb\u884c\u4e86\u5206\u6790\uff0c\u5f53\u7ebf\u7a0b\u83b7\u53d6\u9501\u65f6\u4f1a\u4ece\u4e3b\u5185\u5b58\u4e2d\u83b7\u53d6\u5171\u4eab\u53d8\u91cf\u7684\u6700\u65b0\u503c\uff0c\u91ca\u653e\u9501\u7684\u65f6\u5019\u4f1a\u5c06\u5171\u4eab\u53d8\u91cf\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d\u3002\u4ece\u800c\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"synchronized"),"\u5177\u6709\u53ef\u89c1\u6027\u3002\u540c\u6837\u7684\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u5206\u6790\u4e2d\uff0c\u4f1a\u901a\u8fc7\u5728\u6307\u4ee4\u4e2d\u6dfb\u52a0lock\u6307\u4ee4\uff0c\u4ee5\u5b9e\u73b0\u5185\u5b58\u53ef\u89c1\u6027\u3002\u56e0\u6b64, ",(0,l.kt)("inlineCode",{parentName:"p"},"volatile"),"\u5177\u6709\u53ef\u89c1\u6027"))}d.isMDXComponent=!0}}]);