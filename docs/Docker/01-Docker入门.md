# Docker入门
# 初始Docker

## 什么是Docker

微服务虽然具备各种各样的优势，但服务的拆分通用给部署带来了很大的麻烦。

- 分布式系统中，依赖的组件非常多，不同组件之间部署时往往会产生一些冲突。
- 在数百上千台服务中重复部署，环境不一定一致，会遇到各种问题

### 应用部署的环境问题

大型项目组件较多，运行环境也较为复杂，部署时会碰到一些问题：

- 依赖关系复杂，容易出现兼容性问题
- 开发、测试、生产环境有差异

例如一个项目中，部署时需要依赖于`node.js`、`Redis`、`RabbitMQ`、`MySQL`等，这些服务部署时所需要的函数库、依赖项各不相同，甚至会有冲突。给部署带来了极大的困难。

### Docker解决依赖兼容问题

`Docker`为了解决依赖的兼容问题的，采用了两个手段：

- 将应用的`Libs（函数库）`、`Deps（依赖）`、配置与应用一起打包
- 将每个应用放到一个隔离**容器**去运行，避免互相干扰

### Docker解决操作系统环境差异

![image-20220209143143083](https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220209143143083.png?raw=true)

结构包括：

- 计算机硬件：例如CPU、内存、磁盘等
- 系统内核：所有Linux发行版的内核都是Linux，例如`CentOS`、`Ubuntu`、`Fedora`等。内核可以与计算机硬件交互，对外提供**内核指令**，用于操作计算机硬件。
- 系统应用：操作系统本身提供的应用、函数库。这些函数库是对内核指令的封装，使用更加方便。

应用于计算机交互的流程如下：

1）应用调用操作系统应用（函数库），实现各种功能

2）系统函数库是对内核指令集的封装，会调用内核指令

3）内核指令操作计算机硬件

**Docker如何解决不同系统环境的问题？**

- Docker将用户程序与所需要调用的系统(比如Ubuntu)函数库一起打包
- Docker运行到不同操作系统时，直接基于打包的函数库，借助于操作系统的Linux内核来运行

### Docker的优势

- 可以将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意Linux操作系统
- 运行时利用沙箱机制形成隔离容器，各个应用互不干扰
- 启动、移除都可以通过一行命令完成，方便快捷

## Docker和虚拟机的区别

`虚拟机`是在操作系统中**模拟**硬件设备，然后运行另一个操作系统，比如在 Windows 系统里面运行 `Ubuntu` 系统，这样就可以运行任意的`Ubuntu`应用了。

`Docker`仅仅是封装函数库，并没有模拟完整的操作系统，

![image-20220209144927973](https://github.com/BlackMe2327/cloudimages27/blob/main/img/image-20220209144927973.png?raw=true)

| 特性     | Docker   | 虚拟机   |
| -------- | -------- | -------- |
| 性能     | 接近原生 | 性能较差 |
| 硬盘占用 | MB       | GB       |
| 启动     | 秒级     | 分钟级   |

Docker和虚拟机的差异：

- docker是一个系统进程；虚拟机是在操作系统中的操作系统

- docker体积小、启动速度快、性能好；虚拟机体积大、启动速度慢、性能一般

## Docker架构

### 镜像和容器

**镜像（Image）**：Docker将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。

**容器（Container）**：镜像中的应用程序运行后形成的进程就是**容器**，只是Docker会给容器进程做隔离，对外不可见。

**镜像**，就是把一个应用在硬盘上的文件、及其运行环境、部分系统函数库文件一起打包形成的文件包。这个文件包是只读的。

**容器**，就是将这些文件中编写的程序、函数加载到内存中允许，形成进程，只不过要隔离起来。因此一个镜像可以启动多次，形成多个容器进程。

### DockerHub

- `DockerHub`是一个官方的Docker镜像的托管平台。这样的平台称为Docker Registry。

- 国内也有类似于`DockerHub` 的公开服务，比如[阿里云镜像库](https://cr.console.aliyun.com/)等。

我们既可以将自己的镜像共享到`DockerHub`,另一方面也可以从`DockerHub`拉取镜像。

### Docker架构

Docker是一个CS架构的程序，由两部分组成：

- 服务端(server)：Docker守护进程，负责处理Docker指令，管理镜像、容器等

- 客户端(client)：通过命令或RestAPI向Docker服务端发送指令。可以在本地或远程向服务端发送指令。





